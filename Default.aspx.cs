using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;
using System.Timers;





public partial class _Default : System.Web.UI.Page
{
    public string message = "";
  
    protected void Page_Load(object sender, EventArgs e)
    {

        Response.Expires = -1;
        Response.Buffer = true;
        Response.ExpiresAbsolute = DateTime.Now.AddDays(-1d);
        Response.Expires = -1500;
      
        //Response.CacheControl = "no-cache";
        //Session["compcode"] = "HT001";
        //Session["username"] = "ankur";
       
        ////
        message = "Classified Booking Will Closed at 4pm. Please Booked Ad Fastly.";

        if (Session["center"] != null)
        {
            message = getMessage(Session["center"].ToString());
        }
        Ajax.Utility.RegisterTypeForAjax(typeof(_Default));

        if (Session["compcode"] != null)
        {
            hiddencompcode.Value = Session["compcode"].ToString();
            hiddenuserid.Value = Session["userid"].ToString();
            //dateformat = Session["dateformat"].ToString();
            //hiddendateformat.Value = Session["dateformat"].ToString();
            //UserLabel.Value = Session["Username"].ToString();
            //hiddenauto.Value = Session["autogenerated"].ToString();
            hiddenusername.Value = Session["username"].ToString();
            hiddencompuser.Value = Session["userhome"].ToString();
            hiddenadmin.Value = Session["Admin"].ToString();
            hiddencompname.Value= Session["comp_name"].ToString();
            hdndispauditbk.Value=Session["DispAuditBooking"].ToString();
            if (Session["center"] != null)
                hiddencenter.Value = Session["center"].ToString();
            else
                hiddencenter.Value = "0";
            if (Session["centername"] != null)
                hiddencentername.Value = Session["centername"].ToString();
            if (Session["datetimeNow"] == null)
            {
                string dateformat = Session["dateformat"].ToString();
                dateformat = dateformat.Replace("mm", "MM");
                Session["datetimeNow"] = System.DateTime.Now.ToString(dateformat) + " " + System.DateTime.Now.ToLocalTime().ToShortTimeString();
            }
            hiddendatetime.Value = Session["datetimeNow"].ToString();
        }
        else
        {
            //Response.Redirect("http://localhost/NewAdbooking/login.aspx");
            //Response.Redirect("logout.aspx");
            //Response.Write("<script>window.parent.location=\"login.aspx\";</script>");
            //li.Text = "<script>window.parent.location=\"login.aspx\";</script>";
            Response.Redirect("login.aspx");
            return;
        }

      
        

    }
    protected void Leftbar1_Load(object sender, EventArgs e)
    {

    }

   
    //[Ajax.AjaxMethod]
    //public DataSet chkpermissionagency(string userid)
    //{
        
    //        NewAdbooking.Classes.pop per = new NewAdbooking.Classes.pop();
    //        DataSet ds = new DataSet();
    //        ds = per.checkPrevuser(userid);
    //        return ds;

    //}
    [Ajax.AjaxMethod]
    public DataSet givepermision(string userid, string compcode, string formname)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            //NewAdbooking.Classes.Master per = new NewAdbooking.Classes.Master();
            //ds = per.givepermission(userid, compcode, formname);
            //return ds;
            /* cha*/
        }
        else if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            // deletepermition_new.deletepermition_new_p
            NewAdbooking.classesoracle.reportconfirm per = new NewAdbooking.classesoracle.reportconfirm();
            ds = per.givepermission(userid, compcode, formname);
            return ds;
            /* cha*/
        }
        else
        {
            NewAdbooking.classmysql.Master per = new NewAdbooking.classmysql.Master();
            ds = per.givepermission(userid, compcode, formname);
            
        }
        return ds;
    }

    public string getMessage(string center)
    {
        DataSet ds = new DataSet();
        string nmessage = "";
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.login per = new NewAdbooking.Classes.login();
            ds = per.getMessageCenterWise(center);
            //return ds;
            /* cha*/
        }
        else if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.login per = new NewAdbooking.classesoracle.login();
            ds = per.getMessageCenterWise(center);
        }
        if (ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
        {
            nmessage = ds.Tables[0].Rows[0].ItemArray[0].ToString();
        }
        return nmessage;
    }

   
}
