using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

public partial class GRID : System.Web.UI.Page
{
    int i = 0;
    int j = 0;
    string auditors_comment="";
    protected void Timer1_Tick(object sender, EventArgs e)
    {
        lblTime.Text = DateTime.Now.ToString("dd-MMM-yy hh:mm:ss");
    }
    protected void Page_Load(object sender, EventArgs e)
    {
      
        Response.Expires = -1;
        Response.Buffer = true;
        Response.ExpiresAbsolute = DateTime.Now.AddDays(-1d);
        Response.Expires = -1500;
        lblTime.Text = DateTime.Now.ToString("dd-MMM-yy hh:mm:ss");
        //Response.CacheControl = "no-cache";
        //Session["compcode"] = "HT001";
        //Session["username"] = "ankur";
        Ajax.Utility.RegisterTypeForAjax(typeof(GRID));

        if (Session["compcode"] != null)
        {
            hiddencompcode.Value = Session["compcode"].ToString();
            hiddenuserid.Value = Session["userid"].ToString();
            //dateformat = Session["dateformat"].ToString();
            //hiddendateformat.Value = Session["dateformat"].ToString();
            //UserLabel.Value = Session["Username"].ToString();
            //hiddenauto.Value = Session["autogenerated"].ToString();
            hiddenusername.Value = Session["username"].ToString();
            hiddencompuser.Value = Session["userhome"].ToString();
            hiddenadmin.Value = Session["Admin"].ToString();
            hiddencompname.Value = Session["comp_name"].ToString();
            hiddencenter.Value = Session["center"].ToString();
        }
        else
        {
            //Response.Redirect("http://localhost/NewAdbooking/login.aspx");
            //Response.Redirect("logout.aspx");
            //Response.Write("<script>window.parent.location=\"login.aspx\";</script>");
            //li.Text = "<script>window.parent.location=\"login.aspx\";</script>";
            Response.Redirect("login.aspx");
            return;
        }

        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.fill_auditgrid abc = new NewAdbooking.Classes.fill_auditgrid();
            ds = abc.bindgrid(Session["dateformat"].ToString(), "", "", "", "CL0", "", hiddencenter.Value, "", hiddenuserid.Value, Session["compcode"].ToString());
        }
        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.fill_auditgrid abc = new NewAdbooking.classesoracle.fill_auditgrid();
                ds = abc.bindgrid(Session["dateformat"].ToString(), "", "", "", "CL0", "", hiddencenter.Value, "", hiddenuserid.Value, Session["compcode"].ToString());
            }
            else
            {
                NewAdbooking.classmysql.login abc = new NewAdbooking.classmysql.login();
                ds = abc.bindgrid(Session["dateformat"].ToString(), "", "", "", "CL0", "", hiddencenter.Value, "", hiddenuserid.Value, Session["compcode"].ToString());
            }

        Session["RowLen"] = ds.Tables[0].Rows.Count;
        DataGrid1.DataSource = ds;
        DataGrid1.DataBind();


        DataSet ds1 = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.fill_auditgrid abc = new NewAdbooking.Classes.fill_auditgrid();
            ds1 = abc.bindgrid(Session["dateformat"].ToString(), "", "", "", "DI0", "", hiddencenter.Value, "", hiddenuserid.Value, Session["compcode"].ToString());
        }
        else if(ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.fill_auditgrid abc = new NewAdbooking.classesoracle.fill_auditgrid();
            ds1 = abc.bindgrid(Session["dateformat"].ToString(), "", "", "", "DI0", "", hiddencenter.Value, "", hiddenuserid.Value, Session["compcode"].ToString());
        }
        else{
            NewAdbooking.classmysql.login abc = new NewAdbooking.classmysql.login();
            ds1 = abc.bindgrid(Session["dateformat"].ToString(), "", "", "", "DI0", "", hiddencenter.Value, "", hiddenuserid.Value, Session["compcode"].ToString());
        }

        Session["RowLen"] = ds1.Tables[0].Rows.Count;
        DataGrid2.DataSource = ds1;
        DataGrid2.DataBind();

    }

    protected void DataGrid1_ItemDataBound(object sender, DataGridItemEventArgs e)
    {
        if (e.Item.ItemType == ListItemType.Item || e.Item.ItemType == ListItemType.AlternatingItem)
        {
            i = i + 1;
            e.Item.Cells[0].Text = i.ToString();

            auditors_comment = e.Item.Cells[3].Text;
            if (auditors_comment.IndexOf("~") > 0)
            {
                e.Item.Cells[3].CssClass = "font_aditya";
            }
        }




        
    }
    protected void DataGrid2_ItemDataBound(object sender, DataGridItemEventArgs e)
    {
        if (e.Item.ItemType == ListItemType.Item || e.Item.ItemType == ListItemType.AlternatingItem)
        {
            j = j + 1;
            e.Item.Cells[0].Text = j.ToString();
            auditors_comment = e.Item.Cells[3].Text;
            if (auditors_comment.IndexOf("~") > 0)
            {
                e.Item.Cells[3].CssClass = "font_aditya";
            }
        }



    }
  
}
