using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

public partial class VarientMaster : System.Web.UI.Page
{
    string formname = "VarientMaster";
    static int FlagStatus, fpnl, flag;
    static string saveormodify;
    string message;
    static DataSet executesubpro = new DataSet();
    static string exesubcode, exesubname, exesubalias, exeprosubdes;
    string compcode, userid;
 
    protected void Page_Load(object sender, EventArgs e)
    {
         Response.Expires = -1;
        if (Session["compcode"] != null)
        {
            hiddencompcode.Value = Session["compcode"].ToString();
            hiddenuserid.Value = Session["userid"].ToString();
            hiddenauto.Value = Session["autogenerated"].ToString();
            compcode = hiddencompcode.Value;
            userid = hiddenuserid.Value;

        }

        else
        {
            //Response.Redirect("login.aspx");
            Response.Write("<script>window.parent.location=\"login.aspx\";</script>");
            return;

        }


     //   formname = "VarientMaster";

        DataSet ds = new DataSet();
        ds.ReadXml(Server.MapPath("XML/button.xml"));
        btnNew.ImageUrl = ds.Tables[0].Rows[0].ItemArray[0].ToString();
        btnSave.ImageUrl = ds.Tables[0].Rows[0].ItemArray[1].ToString();
        btnModify.ImageUrl = ds.Tables[0].Rows[0].ItemArray[2].ToString();
        btnQuery.ImageUrl = ds.Tables[0].Rows[0].ItemArray[3].ToString();
        btnExecute.ImageUrl = ds.Tables[0].Rows[0].ItemArray[4].ToString();
        btnCancel.ImageUrl = ds.Tables[0].Rows[0].ItemArray[5].ToString();
        btnfirst.ImageUrl = ds.Tables[0].Rows[0].ItemArray[6].ToString();
        btnprevious.ImageUrl = ds.Tables[0].Rows[0].ItemArray[7].ToString();
        btnnext.ImageUrl = ds.Tables[0].Rows[0].ItemArray[8].ToString();
        btnlast.ImageUrl = ds.Tables[0].Rows[0].ItemArray[9].ToString();
        btnDelete.ImageUrl = ds.Tables[0].Rows[0].ItemArray[10].ToString();
        btnExit.ImageUrl = ds.Tables[0].Rows[0].ItemArray[11].ToString();

        DataSet ds1 = new DataSet();
        ds1.ReadXml(Server.MapPath("XML/VarientMaster.xml"));
        lbbrandcode.Text = ds1.Tables[0].Rows[0].ItemArray[0].ToString();
        lbvarientcode.Text = ds1.Tables[0].Rows[0].ItemArray[1].ToString();
        lbvarientname.Text = ds1.Tables[0].Rows[0].ItemArray[2].ToString();
        lbvarientalias.Text = ds1.Tables[0].Rows[0].ItemArray[3].ToString();

        drpbrand.Enabled = false;
        txtvarientcode.Enabled = false;
        txtvarientname.Enabled = false;
        txtvarientalias.Enabled = false;

      //  mandatory();


        hiddenauto.Value = Session["autogenerated"].ToString();

        //if (Session["autogenerated"].ToString() == "1")
        //{

        //    txtvarientcode .Enabled = false;

        //}
        
        Ajax.Utility.RegisterTypeForAjax(typeof(VarientMaster));
           
        hiddenusername.Value = Session["Username"].ToString();

        if (!Page.IsPostBack)
        {
            bindproduct();
            getbuttoncheck(formname);

          //  btnNew.Attributes.Add("OnClick", "javascript:return newclick();");
            btnSave.Attributes.Add("onclick", "javascript:return saveproductsubcode();");
            btnExit.Attributes.Add("ONClick", "javascript:return exitclick();");
            txtvarientname.Attributes.Add("OnBlur", "javascript:return autoornot();");
            btnQuery.Attributes.Add("OnClick", "javascript:return chkquery();");
            btnDelete.Attributes.Add("onclick", "return confirm ('Are you sure you wish to delete this?')");

           // btnQuery.Attributes.Add("OnClick", "javascript:return chkquery1();");

        
        }
        if (btnNew.Enabled == false)
            btnNew.ImageUrl = ds.Tables[1].Rows[0].ItemArray[0].ToString();
        if (btnSave.Enabled == false)
            btnSave.ImageUrl = ds.Tables[1].Rows[0].ItemArray[1].ToString();
        if (btnModify.Enabled == false)
            btnModify.ImageUrl = ds.Tables[1].Rows[0].ItemArray[2].ToString();
        if (btnQuery.Enabled == false)
            btnQuery.ImageUrl = ds.Tables[1].Rows[0].ItemArray[3].ToString();
        if (btnExecute.Enabled == false)
            btnExecute.ImageUrl = ds.Tables[1].Rows[0].ItemArray[4].ToString();
        if (btnCancel.Enabled == false)
            btnCancel.ImageUrl = ds.Tables[1].Rows[0].ItemArray[5].ToString();
        if (btnfirst.Enabled == false)
            btnfirst.ImageUrl = ds.Tables[1].Rows[0].ItemArray[6].ToString();
        if (btnprevious.Enabled == false)
            btnprevious.ImageUrl = ds.Tables[1].Rows[0].ItemArray[7].ToString();
        if (btnnext.Enabled == false)
            btnnext.ImageUrl = ds.Tables[1].Rows[0].ItemArray[8].ToString();
        if (btnlast.Enabled == false)
            btnlast.ImageUrl = ds.Tables[1].Rows[0].ItemArray[9].ToString();
        if (btnDelete.Enabled == false)
            btnDelete.ImageUrl = ds.Tables[1].Rows[0].ItemArray[10].ToString();
        if (btnExit.Enabled == false)
            btnExit.ImageUrl = ds.Tables[1].Rows[0].ItemArray[11].ToString();

    }

    public void bindproduct()
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.VarientMaster bind = new NewAdbooking.Classes.VarientMaster();
            ds = bind.productdes(hiddencompcode.Value);
        }
        else
            if(ConfigurationSettings.AppSettings ["ConnectionType"].ToString ()=="orcl")
            {
                NewAdbooking.classesoracle.VarientMaster bind = new NewAdbooking.classesoracle.VarientMaster();
                ds = bind.productdes(hiddencompcode.Value);
            }
        else
        {
            NewAdbooking.classmysql.VarientMaster bind = new NewAdbooking.classmysql.VarientMaster();
            ds = bind.productdes(hiddencompcode.Value);
        }

        ListItem li = new ListItem();
        li.Text = "--Select Brand Name--";
        li.Value = "0";
        li.Selected = true;
        drpbrand.Items.Add(li);

        int x;

        for (x = 0; x < ds.Tables[0].Rows.Count; x++)
        {
            ListItem li1 = new ListItem();
            li1.Text = ds.Tables[0].Rows[x].ItemArray[1].ToString();
            li1.Value = ds.Tables[0].Rows[x].ItemArray[0].ToString();
            drpbrand.Items.Add(li1);

        }
    
    }



    protected void btnNew_Click1(object sender, EventArgs e)
    {
        pnew.Value  = "1";
        heddentext.Value = "new";

        txtvarientcode .Text = "";
        txtvarientname .Text = "";
        txtvarientalias .Text = "";
        drpbrand.SelectedValue = "0";

       // hiddenauto.Value = "1";

        saveormodify = "0";

        if (hiddenauto.Value == "1")
        {
            txtvarientcode .Enabled = false;
            
        }
        else
        {
            txtvarientcode.Enabled = true;
        }
        drpbrand.Enabled = true;
        txtvarientalias.Enabled = true;
        txtvarientname.Enabled = true;

        ScriptManager.RegisterClientScriptBlock(this, typeof(VarientMaster), "ss", "focus()", true);

        chkstatus(FlagStatus);
        btnSave.Enabled = true;
        btnNew.Enabled = false;
        btnQuery.Enabled = false;
        btnimage();
    }
    protected void btnSave_Click(object sender, EventArgs e)
    {
        pnew.Value = "0";
        string varientcode = (txtvarientcode.Text).Trim();
        string varientname = (txtvarientname.Text).Trim();
        string varientalias = (txtvarientalias.Text).Trim();
        string drpprosub = drpbrand.SelectedValue;

        if (saveormodify == "0")
        {
            DataSet ds = new DataSet();
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
            {
                NewAdbooking.Classes.VarientMaster getcode = new NewAdbooking.Classes.VarientMaster();
                ds = getcode.chkcode(varientcode, Session["compcode"].ToString());
            }
            else
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                {
                    NewAdbooking.classesoracle.VarientMaster getcode = new NewAdbooking.classesoracle.VarientMaster();
                    ds = getcode.chkcode(varientcode, Session["compcode"].ToString());

                }
                else
                {
                    NewAdbooking.classmysql.VarientMaster getcode = new NewAdbooking.classmysql.VarientMaster();
                    ds = getcode.chkcode(varientcode, Session["compcode"].ToString());
                }
            if (ds.Tables[0].Rows.Count > 0)
            {
                //message = "Please Enter The Brand Code of " + varientname + " ";
                message = "This Product Code Has Already Assigned";
                AspNetMessageBox(message);
                pnew.Value = "1";
                drpbrand.Enabled = true;
                txtvarientcode.Enabled = true;
                txtvarientname.Enabled = true;
                txtvarientalias.Enabled = true;
                txtvarientcode.Text = "";
                ScriptManager1.SetFocus(txtvarientcode);
                return;

            }
            else
            {
                DataSet di = new DataSet();
                string err = "";
                try
                {
                    if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
                    {
                        NewAdbooking.Classes.VarientMaster insertthe = new NewAdbooking.Classes.VarientMaster();
                        di = insertthe.insertedvalue(drpprosub, varientcode, varientname, varientalias, Session["compcode"].ToString(), Session["userid"].ToString());
                    }
                    else
                        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                        {
                            NewAdbooking.classesoracle.VarientMaster insertthe = new NewAdbooking.classesoracle.VarientMaster();
                            di = insertthe.insertedvalue(drpprosub, varientcode, varientname, varientalias, Session["compcode"].ToString(), Session["userid"].ToString());

                        }
                        else
                        {
                            NewAdbooking.classmysql.VarientMaster insertthe = new NewAdbooking.classmysql.VarientMaster();
                            di = insertthe.insertedvalue(drpprosub, varientcode, varientname, varientalias, Session["compcode"].ToString(), Session["userid"].ToString());
                        }
                }
                catch (Exception k1)
                {
                    err = k1.Message;
                }
                string varientcode1 = "Inserted Variant " + varientcode;
                clsconnection dconnect = new clsconnection();
                string sqldd = "insert into log_new (DATE1,USERID,PROCESSNAME,ERR_DESCRIPTION,OBJECT_PROCESS_ID,DESCRIPTION,IP) values($date,'" + HttpContext.Current.Session["UserId"] + "','Variant  ','" + err.Replace("'", "''") + "','Variant  Created','" + varientcode1;
                sqldd = sqldd + "',";
                sqldd = sqldd + "'" + Request.ServerVariables["REMOTE_ADDR"] + "')";
                dconnect.executenonquery1(sqldd);


                getbuttoncheck(formname);
                //message = "Value Saved Sucessfully ";
                //AspNetMessageBox(message);
                DataSet ds1 = new DataSet();
                ds1.ReadXml(Server.MapPath("XML/errorMessage.xml"));
                message = ds1.Tables[0].Rows[0].ItemArray[0].ToString();
                AspNetMessageBox(message);

                txtvarientalias.Text = "";
                txtvarientname.Text = "";
                txtvarientcode.Text = "";
                drpbrand.SelectedValue = "0";


                txtvarientcode.Enabled = false;
                txtvarientname.Enabled = false;
                txtvarientalias.Enabled = false;
                drpbrand.Enabled = false;
                btnimage();
                return;


            }

        }
        //for modify
        else
        {

                DataSet du = new DataSet();
                string err = "";
                try
                {
                    if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
                    {
                        NewAdbooking.Classes.VarientMaster upadte1 = new NewAdbooking.Classes.VarientMaster();
                        du = upadte1.updatepro(drpprosub, varientcode, varientname, varientalias, Session["compcode"].ToString());
                    }
                    else
                        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                        {
                            NewAdbooking.classesoracle.VarientMaster upadte1 = new NewAdbooking.classesoracle.VarientMaster();
                            du = upadte1.updatepro(drpprosub, varientcode, varientname, varientalias, Session["compcode"].ToString());

                        }

                        else
                        {
                            NewAdbooking.classmysql.VarientMaster upadte1 = new NewAdbooking.classmysql.VarientMaster();
                            du = upadte1.updatepro(drpprosub, varientcode, varientname, varientalias, Session["compcode"].ToString());
                        }
                }
                catch (Exception k2)
                {
                    err = k2.Message;
                }
                string varientcode2 = "Modified Variant " + varientcode;
                clsconnection dconnect = new clsconnection();
                string sqldd = "insert into log_new (DATE1,USERID,PROCESSNAME,ERR_DESCRIPTION,OBJECT_PROCESS_ID,DESCRIPTION,IP) values($date,'" + HttpContext.Current.Session["UserId"] + "','Variant  ','" + err.Replace("'", "''") + "','Variant  Updated','" + varientcode2;
                sqldd = sqldd + "',";
                sqldd = sqldd + "'" + Request.ServerVariables["REMOTE_ADDR"] + "')";
                dconnect.executenonquery1(sqldd);
                txtvarientalias.Enabled = false;
                txtvarientname.Enabled = false;
                txtvarientcode.Enabled = false;

                executesubpro.Tables[0].Rows[fpnl].ItemArray[0] = drpbrand.SelectedValue;
                executesubpro.Tables[0].Rows[fpnl].ItemArray[1] = txtvarientcode.Text;
                executesubpro.Tables[0].Rows[fpnl].ItemArray[2] = txtvarientname.Text;
                executesubpro.Tables[0].Rows[fpnl].ItemArray[3] = txtvarientalias.Text;
                DataSet ds = new DataSet();
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
                {
                    NewAdbooking.Classes.VarientMaster execute = new NewAdbooking.Classes.VarientMaster();
                    executesubpro = execute.prosubexecute(exeprosubdes, varientcode, exesubname, exesubalias, Session["compcode"].ToString());
                }
                else
                    if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                    {
                        NewAdbooking.classesoracle.VarientMaster execute = new NewAdbooking.classesoracle.VarientMaster();
                        executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());

                    }
                    else
                    {
                        NewAdbooking.classmysql.VarientMaster execute = new NewAdbooking.classmysql.VarientMaster();
                        executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());
                    }
                ds = executesubpro;



                updateStatus();
                if (fpnl == 0)
                {
                    btnfirst.Enabled = false;
                    btnprevious.Enabled = false;
                }
                int count = ds.Tables[0].Rows.Count;

                if (fpnl == count - 1)
                {
                    btnnext.Enabled = false;
                    btnlast.Enabled = false;
                }
                btnimage();
                ScriptManager1.SetFocus(btnModify);
                heddentext.Value = "query";
                //message = "Value Update Sucessfully ";
                //AspNetMessageBox(message);
                DataSet ds2 = new DataSet();
                ds2.ReadXml(Server.MapPath("XML/errorMessage.xml"));
                message = ds2.Tables[0].Rows[0].ItemArray[1].ToString();
                AspNetMessageBox(message);
                return;

              }
        
    }
    protected void btnModify_Click(object sender, EventArgs e)
    {
        pnew.Value = "0";
        heddentext.Value = "modify";

        
        txtvarientcode.Enabled = false;
        txtvarientname .Enabled = true;
        txtvarientalias .Enabled = true;
        drpbrand.Enabled = true;
        hiddenmodtxt.Value = txtvarientname.Text;

        saveormodify = "1";
        chkstatus(FlagStatus);
        chkstatus(FlagStatus);
        btnSave.Enabled = true;
        btnQuery.Enabled = false;
        btnimage();
        drpbrand.Enabled = false;
    }
    protected void btnQuery_Click1(object sender, EventArgs e)
    {
        pnew.Value="0";
        heddentext.Value = "query";
        txtvarientcode .Text = "";
        txtvarientname .Text = "";
        txtvarientalias .Text = "";
        drpbrand.SelectedValue = "0";

        txtvarientalias.Enabled = true;
        txtvarientcode.Enabled = true;
        txtvarientname.Enabled = true;
        drpbrand.Enabled = true;

             
        chkstatus(FlagStatus);


        btnQuery.Enabled = false;
        btnExecute.Enabled = true;
        btnSave.Enabled = false;
        btnimage();
    }
    protected void btnExecute_Click(object sender, EventArgs e)
    {
        fpnl = 0;
        pnew.Value = "0";
        //hiddenauto.Value = Session["query"].ToString();
         string varientcode = txtvarientcode .Text;
         exesubcode = varientcode;
         string varientname = txtvarientname.Text;
         exesubname = varientname;
         string prosubalias = txtvarientalias.Text;
         exesubalias = prosubalias;
         string drpprosub = drpbrand.SelectedValue;
         exeprosubdes = drpprosub;
         if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
         {
             NewAdbooking.Classes.VarientMaster execute = new NewAdbooking.Classes.VarientMaster();
             executesubpro = execute.prosubexecute(drpprosub, varientcode, varientname, prosubalias, Session["compcode"].ToString());
         }
         else
             if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
             {
                 NewAdbooking.classesoracle.VarientMaster execute = new NewAdbooking.classesoracle.VarientMaster();
                 executesubpro = execute.prosubexecute(drpprosub, varientcode, varientname, prosubalias, Session["compcode"].ToString());

             }
         else
         {

             NewAdbooking.classmysql.VarientMaster execute = new NewAdbooking.classmysql.VarientMaster();
             executesubpro = execute.prosubexecute(drpprosub, varientcode, varientname, prosubalias, Session["compcode"].ToString());
         }
         if (executesubpro.Tables[0].Rows.Count == 0)
         {
             message = "Your Search Criteria Does Not Exist";
             AspNetMessageBox(message);
              
        //   chkstatus(FlagStatus);
              updateStatus();
              getbuttoncheck(formname);
             drpbrand.SelectedValue = "0";
             txtvarientalias.Text = "";
             txtvarientcode.Text = "";
             txtvarientname.Text = "";
             btnimage();
            return;

           

         }

         else
         {
             if (drpbrand.Items.FindByValue(executesubpro.Tables[0].Rows[0].ItemArray[0].ToString()) != null)
             {
                 drpbrand.SelectedValue = executesubpro.Tables[0].Rows[0].ItemArray[0].ToString();
             }
             else
             {
                 drpbrand.SelectedValue = "0";
             }
             txtvarientcode.Text = executesubpro.Tables[0].Rows[0].ItemArray[1].ToString();
             txtvarientname.Text = executesubpro.Tables[0].Rows[0].ItemArray[2].ToString();
             txtvarientalias.Text = executesubpro.Tables[0].Rows[0].ItemArray[3].ToString();

             drpbrand.Enabled = false;
             txtvarientcode.Enabled = false;
             txtvarientname.Enabled = false;
             txtvarientalias.Enabled = false;

             //message = "Your Search Criteria Does Not Exit";
             //AspNetMessageBox(message);
         }

         updateStatus();
         btnfirst.Enabled = false;
         btnprevious.Enabled = false;
         ScriptManager1.SetFocus(btnModify);
     
         if (executesubpro.Tables[0].Rows.Count == 1)
         {
             btnfirst.Enabled = false;
             btnlast.Enabled = false;
             btnprevious.Enabled = false;
             btnnext.Enabled = false;
         }

         btnimage();

        // updateStatus();


    }
    protected void btnCancel_Click1(object sender, EventArgs e)
    {
        pnew.Value = "0";
        heddentext.Value = "cancel";
        txtvarientalias.Text = "";
        txtvarientcode .Text = "";
        txtvarientname .Text = "";
        drpbrand.SelectedValue = "0";
        hiddenauto.Value = "";

        chkstatus(FlagStatus);

        getbuttoncheck(formname);
       
        ScriptManager1.SetFocus(btnNew);
        btnSave.Enabled = false;
        txtvarientalias.Enabled = false;
        txtvarientname.Enabled = false;
        txtvarientcode.Enabled = false;
        btnimage();
    }
    protected void btnfirst_Click(object sender, EventArgs e)
    {
        fpnl = 0;

        DataSet ds = new DataSet();
        ds = executesubpro;

        if (drpbrand.Items.FindByValue(ds.Tables[0].Rows[0].ItemArray[0].ToString()) != null)
        {
            drpbrand.SelectedValue = ds.Tables[0].Rows[0].ItemArray[0].ToString();
        }
        else
        {
            drpbrand.SelectedValue = "0";
        }
        txtvarientcode .Text = ds.Tables[0].Rows[0].ItemArray[1].ToString();
        txtvarientname .Text = ds.Tables[0].Rows[0].ItemArray[2].ToString();
        txtvarientalias .Text = ds.Tables[0].Rows[0].ItemArray[3].ToString();
        

        updateStatus();

        btnfirst.Enabled = false;
        btnprevious.Enabled = false;
        btnimage();
    }
    protected void btnprevious_Click(object sender, EventArgs e)
    {
        DataSet ds = new DataSet();
        ds = executesubpro;

        // fpnl--;
        int count = ds.Tables[0].Rows.Count - 1;

        fpnl--;

        if (fpnl != -1)
        {
            if (fpnl >= 0 || fpnl <= count)
            {
                if (drpbrand.Items.FindByValue(ds.Tables[0].Rows[fpnl].ItemArray[0].ToString()) != null)
                {
                    drpbrand.SelectedValue = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
                }
                else
                {
                    drpbrand.SelectedValue = "0";
                }
                txtvarientcode .Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
                txtvarientname .Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
                txtvarientalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[3].ToString();

                updateStatus();

                btnfirst.Enabled = true;
                btnlast.Enabled = true;
                btnprevious.Enabled = true;
                btnnext.Enabled = true;
            }
            else
            {
                btnnext.Enabled = true;
                btnlast.Enabled = true;
                btnfirst.Enabled = false;
                btnprevious.Enabled = false;

            }
        }
        else
        {
            btnnext.Enabled = true;
            btnlast.Enabled = true;
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;

        }
        if (fpnl == 0)
        {
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;
            btnnext.Enabled = true;
            btnlast.Enabled = true;

        }

        btnimage();
    }
    protected void btnnext_Click(object sender, EventArgs e)
    {
        DataSet ds = new DataSet();
        ds = executesubpro;
        int count = ds.Tables[0].Rows.Count - 1;
        fpnl++;


        if (fpnl != -1 && fpnl >= 0)
        {
            if (fpnl <= count)
            {
                if (drpbrand.Items.FindByValue(ds.Tables[0].Rows[fpnl].ItemArray[0].ToString()) != null)
                {
                    drpbrand.SelectedValue = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
                }
                else
                {
                    drpbrand.SelectedValue = "0";
                }
                txtvarientcode.Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
                txtvarientname.Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
                txtvarientalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[3].ToString();

                btnfirst.Enabled = true;
                btnprevious.Enabled = true;

            }

            else
            {
                btnnext.Enabled = false;
                btnlast.Enabled = false;
                btnfirst.Enabled = true;
                btnprevious.Enabled = true;

            }
        }
        else
        {
            btnnext.Enabled = false;
            btnlast.Enabled = false;
            btnfirst.Enabled = true;
            btnprevious.Enabled = true;

        }
        if (fpnl == count)
        {
            btnnext.Enabled = false;
            btnlast.Enabled = false;
            btnfirst.Enabled = true;
            btnprevious.Enabled = true;

        }
        btnimage();
    }
    protected void btnlast_Click(object sender, EventArgs e)
    {
        DataSet ds = new DataSet();
        ds = executesubpro;
        int count = ds.Tables[0].Rows.Count;
        fpnl = count - 1;


        if (drpbrand.Items.FindByValue(ds.Tables[0].Rows[fpnl].ItemArray[0].ToString()) != null)
        {
            drpbrand.SelectedValue = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
        }
        else
        {
            drpbrand.SelectedValue = "0";
        }
        txtvarientcode .Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
        txtvarientname .Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
        txtvarientalias .Text = ds.Tables[0].Rows[fpnl].ItemArray[3].ToString();

        updateStatus();

        btnfirst.Enabled = true;
        btnprevious.Enabled = true;
        btnlast.Enabled = false;
        btnnext.Enabled = false;
        btnimage();
    }
    protected void btnDelete_Click(object sender, EventArgs e)
    {
        string varientcode = txtvarientcode.Text;
        DataSet ds1 = new DataSet();
        string err = "";
        try
        {
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
            {
                NewAdbooking.Classes.VarientMaster del = new NewAdbooking.Classes.VarientMaster();
                ds1 = del.deleteproduct(varientcode, Session["compcode"].ToString());
            }
            else
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                {
                    NewAdbooking.classesoracle.VarientMaster del = new NewAdbooking.classesoracle.VarientMaster();
                    ds1 = del.deleteproduct(varientcode, Session["compcode"].ToString());

                }
                else
                {
                    NewAdbooking.classmysql.VarientMaster del = new NewAdbooking.classmysql.VarientMaster();
                    ds1 = del.deleteproduct(varientcode, Session["compcode"].ToString());
                }
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
            {
                NewAdbooking.Classes.VarientMaster execute = new NewAdbooking.Classes.VarientMaster();
                executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());//, Session["userid"].ToString());
            }
            else
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                {
                    NewAdbooking.classesoracle.VarientMaster execute = new NewAdbooking.classesoracle.VarientMaster();
                    executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());//, Session["userid"].ToString());

                }
                else
                {
                    NewAdbooking.classmysql.VarientMaster execute = new NewAdbooking.classmysql.VarientMaster();
                    executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());//, Session["userid"].ToString());
                }
        }
        catch (Exception k3)
        {
            err = k3.Message;
        }
        string varientcode3 = "Deleted Variant " + varientcode;
        clsconnection dconnect = new clsconnection();
        string sqldd = "insert into log_new (DATE1,USERID,PROCESSNAME,ERR_DESCRIPTION,OBJECT_PROCESS_ID,DESCRIPTION,IP) values($date,'" + HttpContext.Current.Session["UserId"] + "','Variant  ','" + err.Replace("'", "''") + "','Variant  Deleted','" + varientcode3;
        sqldd = sqldd + "',";
        sqldd = sqldd + "'" + Request.ServerVariables["REMOTE_ADDR"] + "')";
        dconnect.executenonquery1(sqldd);
        int a = executesubpro.Tables[0].Rows.Count;
        if (a <= 0)
        {
            message = "There is no data";
            AspNetMessageBox(message);
            updateStatus();
            getbuttoncheck(formname);
            drpbrand.SelectedValue = "0";
            txtvarientalias.Text = "";
            txtvarientcode.Text = "";
            txtvarientname.Text = "";
            btnimage();
            return;

        }
        else if (fpnl == -1 || fpnl >= a)
        {
            DataSet ds = new DataSet();

            ds = executesubpro;
            drpbrand.SelectedValue = ds.Tables[0].Rows[0].ItemArray[0].ToString();
            txtvarientcode.Text = ds.Tables[0].Rows[0].ItemArray[1].ToString();
            txtvarientname.Text = ds.Tables[0].Rows[0].ItemArray[2].ToString();
            txtvarientalias.Text = ds.Tables[0].Rows[0].ItemArray[3].ToString();
        }

        else
        {
            DataSet ds = new DataSet();
            ds = executesubpro;
            if (drpbrand.Items.FindByValue(ds.Tables[0].Rows[fpnl].ItemArray[0].ToString()) != null)
            {
                drpbrand.SelectedValue = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
            }
            else
            {
                drpbrand.SelectedValue = "0";
            }
            txtvarientcode.Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
            txtvarientname.Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
            txtvarientalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[3].ToString();
        }
        DataSet ds3 = new DataSet();
        ds3.ReadXml(Server.MapPath("XML/errorMessage.xml"));
        message = ds3.Tables[0].Rows[0].ItemArray[2].ToString();
        AspNetMessageBox(message);
        btnimage();


      
    }
    protected void btnExit_Click(object sender, EventArgs e)
    {

    }
    public void getbuttoncheck(string formname)
    {
         DataSet butt = new DataSet();
         if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
         {
             NewAdbooking.Classes.classlibraryforbutton getpermission = new NewAdbooking.Classes.classlibraryforbutton();
             butt = getpermission.getbuttonpermission(Session["compcode"].ToString(), Session["userid"].ToString(), formname);
         }
         else

             if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
             {
                 NewAdbooking.classesoracle.classlibraryforbutton getpermission = new NewAdbooking.classesoracle.classlibraryforbutton();
                 butt = getpermission.getbuttonpermission(Session["compcode"].ToString(), Session["userid"].ToString(), formname);

             }
         else
         {
            NewAdbooking.classmysql.classlibraryforbutton getpermission = new NewAdbooking.classmysql.classlibraryforbutton();
             butt = getpermission.getbuttonpermission(Session["compcode"].ToString(), Session["userid"].ToString(), formname);
         }
        string id = butt.Tables[0].Rows[0].ItemArray[0].ToString();


        if (id != "0")
        {
            //var id = ds.Tables[0].Rows[0].button_id;



            if (id == "0" || id == "8")
            {

                FlagStatus = 0;

                btnNew.Enabled = false;
                btnQuery.Enabled = false;
                btnExecute.Enabled = false;
                btnCancel.Enabled = false;
                btnExit.Enabled = false;
                btnDelete.Enabled = false;
                btnModify.Enabled = false;

                btnSave.Enabled = false;
                btnModify.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;



                //window.location.href = 'EnterPage.aspx';
                //alert("You Are Not Authorised To See This Form");
                //FlagStatus = 0;


            }
            if (id == "1" || id == "9")
            {
                btnNew.Enabled = true;
                btnQuery.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnExecute.Enabled = false;

                btnSave.Enabled = false;
                btnModify.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                FlagStatus = 1;

            }
            if (id == "2" || id == "10")
            {

                btnNew.Enabled = false;
                btnExecute.Enabled = false;
                btnQuery.Enabled = true;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                //a//btnModify.Enabled = true;
                btnModify.Enabled = false;

                btnSave.Enabled = false;
                //a// btnfirst.Enabled = true;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExit.Enabled = true;
                FlagStatus = 2;


            }
            if (id == "3" || id == "11")
            {
                btnNew.Enabled = true;
                btnQuery.Enabled = true;
                btnExecute.Enabled = false;
                btnDelete.Enabled = false;
                btnModify.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;


                btnSave.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;

                FlagStatus = 3;



            }
            if (id == "4" || id == "12")
            {
                btnNew.Enabled = false;
                btnQuery.Enabled = true;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExecute.Enabled = false;

                btnNew.Enabled = false;
                btnExecute.Enabled = false;
                btnDelete.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;


                btnModify.Enabled = false;

                btnSave.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                FlagStatus = 4;



            }
            if (id == "5" || id == "13")
            {
                btnNew.Enabled = true;
                btnSave.Enabled = false;
                btnQuery.Enabled = true;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExecute.Enabled = false;
                btnModify.Enabled = false;
                FlagStatus = 5;


            }
            if (id == "6" || id == "14")
            {
                btnNew.Enabled = false;
                btnSave.Enabled = false;
                btnQuery.Enabled = true;
                btnModify.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExecute.Enabled = false;

                FlagStatus = 6;
            }
            if (id == "7" || id == "15")
            {
                btnNew.Enabled = true;
                btnSave.Enabled = false;
                btnQuery.Enabled = true;
                btnModify.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExecute.Enabled = false;
                FlagStatus = 7;

            }
        }




    }

    public void chkstatus(int FlagStatus)
    {
        if (FlagStatus == 0 || FlagStatus == 8)
        {
            btnNew.Enabled = false;
            btnQuery.Enabled = false;
            btnDelete.Enabled = false;
            btnSave.Enabled = false;
            btnExecute.Enabled = false;
            btnCancel.Enabled = false;
            btnModify.Enabled = false;

            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
            btnExit.Enabled = false;



        }
        if (FlagStatus == 1 || FlagStatus == 9)
        {
            btnNew.Enabled = false;
            btnQuery.Enabled = false;
            btnDelete.Enabled = false;
            btnSave.Enabled = true;
            btnExecute.Enabled = false;
            btnCancel.Enabled = true;
            btnModify.Enabled = false;

            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
            btnExit.Enabled = true;

        }
        if (FlagStatus == 2 || FlagStatus == 10)
        {
            btnExecute.Enabled = true;
            btnQuery.Enabled = false;
            btnDelete.Enabled = false;
            btnNew.Enabled = false;
            btnCancel.Enabled = true;
            btnExecute.Enabled = false;
            btnModify.Enabled = false;
            btnExit.Enabled = true;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
            btnExit.Enabled = true;


        }

        if (FlagStatus == 3 || FlagStatus == 11)
        {
            btnNew.Enabled = false;
            btnQuery.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = true;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }

        if (FlagStatus == 4 || FlagStatus == 12)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
        if (FlagStatus == 5 || FlagStatus == 13)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
        if (FlagStatus == 6 || FlagStatus == 14)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
        if (FlagStatus == 7 || FlagStatus == 15)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = true;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }


    }

    public void updateStatus()
    {
        chkstatus(FlagStatus);
        if (FlagStatus == 2 || FlagStatus == 3)
        {
            btnQuery.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnModify.Enabled = true;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;
            btnDelete.Enabled = false;
        }
        if (FlagStatus == 4)
        {
            btnDelete.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnQuery.Enabled = true;
            btnModify.Enabled = false;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;

        }
        if (FlagStatus == 5)
        {
            btnDelete.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnQuery.Enabled = true;
            btnModify.Enabled = false;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;

        }
        if (FlagStatus == 6 || FlagStatus == 7)
        {
            btnDelete.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnQuery.Enabled = true;
            btnModify.Enabled = true;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;

        }
    }

    protected void AspNetMessageBox(string strMessage)
    {
        //strMessage = adminResource.GetStringFromResource(strMessage);
        string strAlert = "";
        strAlert = "alert('" + strMessage + "')";
        ScriptManager.RegisterClientScriptBlock(this, typeof(VarientMaster), "ShowAlert", strAlert, true);
    }

    [Ajax.AjaxMethod]

    public DataSet adchkadvcode(string str ,string brand)
    {
         DataSet ds = new DataSet();
         if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
         {
             NewAdbooking.Classes.VarientMaster auto = new NewAdbooking.Classes.VarientMaster();
             ds = auto.autocode(str,brand);
             return ds;
         }

         else
             if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
             
             {
                 NewAdbooking.classesoracle.VarientMaster auto = new NewAdbooking.classesoracle.VarientMaster();
                 ds = auto.autocode(str);
                 return ds;
             }
         else
         {
             NewAdbooking.classmysql.VarientMaster auto = new NewAdbooking.classmysql.VarientMaster();
             ds = auto.autocode(str, brand);
             return ds;
         }


    }

    //private void mandatory()
    //{
    //    if (lbproductdescription.Text.IndexOf("*") >= 0)
    //    {
    //        hiddendrpproduct.Value = "1";
    //    }
    //    else
    //    {
    //        hiddendrpproduct.Value = "0";
    //    }
    //    if (lbsubprodes.Text.IndexOf("*") >= 0)
    //    {
    //        hiddensubproname.Value = "1";
    //    }
    //    else
    //    {
    //        hiddensubproname.Value = "0";
    //    }
    //    if (lbprosubcode.Text.IndexOf("*") >= 0)
    //    {
    //        hiddensubprocode.Value = "1";
    //    }
    //    else
    //    {
    //        hiddensubprocode.Value = "0";
    //    }
    //    if (lbsubalias.Text.IndexOf("*") >= 0)
    //    {
    //        hiddensubproalias.Value = "1";
    //    }
    //    else
    //    {
    //        hiddensubproalias.Value = "0";
    //    }
    //    if (Product.Text.IndexOf("*") >= 0)
    //    {
    //        hiddenproduct.Value = "1";
    //    }
    //    else
    //    {
    //        hiddenproduct.Value = "0";
    //    }
    //    if (Representative.Text.IndexOf("*") >= 0)
    //    {
    //        hiddenrep.Value = "1";
    //    }
    //    else
    //    {
    //        hiddenrep.Value = "0";
    //    }
    //    if (validfrom.Text.IndexOf("*") >= 0)
    //    {
    //        hiddenvalidfrom.Value = "1";
    //    }
    //    else
    //    {
    //        hiddenvalidfrom.Value = "0";
    //    }
    //    if (txttilldate.Text.IndexOf("*") >= 0)
    //    {
    //        hiddento.Value = "1";
    //    }
    //    else
    //    {
    //        hiddento.Value = "0";
    //    }
    //}
    protected void drpproduct_SelectedIndexChanged(object sender, EventArgs e)
    {

    }
    public void btnimage()
    {
        DataSet ds = new DataSet();
        ds.ReadXml(Server.MapPath("XML/button.xml"));
        if (btnNew.Enabled == false)
            btnNew.ImageUrl = ds.Tables[1].Rows[0].ItemArray[0].ToString();
        else
            btnNew.ImageUrl = ds.Tables[0].Rows[0].ItemArray[0].ToString();
        if (btnSave.Enabled == false)
            btnSave.ImageUrl = ds.Tables[1].Rows[0].ItemArray[1].ToString();
        else
            btnSave.ImageUrl = ds.Tables[0].Rows[0].ItemArray[1].ToString();
        if (btnModify.Enabled == false)
            btnModify.ImageUrl = ds.Tables[1].Rows[0].ItemArray[2].ToString();
        else
            btnModify.ImageUrl = ds.Tables[0].Rows[0].ItemArray[2].ToString();
        if (btnQuery.Enabled == false)
            btnQuery.ImageUrl = ds.Tables[1].Rows[0].ItemArray[3].ToString();
        else
            btnQuery.ImageUrl = ds.Tables[0].Rows[0].ItemArray[3].ToString();
        if (btnExecute.Enabled == false)
            btnExecute.ImageUrl = ds.Tables[1].Rows[0].ItemArray[4].ToString();
        else
            btnExecute.ImageUrl = ds.Tables[0].Rows[0].ItemArray[4].ToString();
        if (btnCancel.Enabled == false)
            btnCancel.ImageUrl = ds.Tables[1].Rows[0].ItemArray[5].ToString();
        else
            btnCancel.ImageUrl = ds.Tables[0].Rows[0].ItemArray[5].ToString();
        if (btnfirst.Enabled == false)
            btnfirst.ImageUrl = ds.Tables[1].Rows[0].ItemArray[6].ToString();
        else
            btnfirst.ImageUrl = ds.Tables[0].Rows[0].ItemArray[6].ToString();
        if (btnprevious.Enabled == false)
            btnprevious.ImageUrl = ds.Tables[1].Rows[0].ItemArray[7].ToString();
        else
            btnprevious.ImageUrl = ds.Tables[0].Rows[0].ItemArray[7].ToString();
        if (btnnext.Enabled == false)
            btnnext.ImageUrl = ds.Tables[1].Rows[0].ItemArray[8].ToString();
        else
            btnnext.ImageUrl = ds.Tables[0].Rows[0].ItemArray[8].ToString();
        if (btnlast.Enabled == false)
            btnlast.ImageUrl = ds.Tables[1].Rows[0].ItemArray[9].ToString();
        else
            btnlast.ImageUrl = ds.Tables[0].Rows[0].ItemArray[9].ToString();
        if (btnDelete.Enabled == false)
            btnDelete.ImageUrl = ds.Tables[1].Rows[0].ItemArray[10].ToString();
        else
            btnDelete.ImageUrl = ds.Tables[0].Rows[0].ItemArray[10].ToString();
        if (btnExit.Enabled == false)
            btnExit.ImageUrl = ds.Tables[1].Rows[0].ItemArray[11].ToString();
        else
            btnExit.ImageUrl = ds.Tables[0].Rows[0].ItemArray[11].ToString();
    }
    
}
