using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

public partial class IndustryMaster : System.Web.UI.Page
{
    string formname = "IndustryMaster";
    static int FlagStatus, fpnl;
    static string saveormodify;
    string message;
    static DataSet executepro = new DataSet();
    static string d_alias, d_name, d_code;
    static string name_modify;
    NewAdbooking.Classes.industrymaster execute = new NewAdbooking.Classes.industrymaster();
    protected void Page_Load(object sender, EventArgs e)
    {
        Response.Expires = -1;

        if (Session["compcode"] == null)
        {
            Response.Write("<script>alert(\"Your Session Has Been Expired\");window.close();</script>");
            return;
        }
        else
        {
            hiddencompcode.Value = Session["compcode"].ToString();
            hiddenuserid.Value = Session["userid"].ToString();
            hiddenauto.Value = Session["autogenerated"].ToString();
            hiddenusername.Value = Session["Username"].ToString();
        }

        formname = "IndustryMaster";

        hiddenauto.Value = Session["autogenerated"].ToString();
        if (Session["autogenerated"].ToString() == "1")
        {
            txtindustrycode.Enabled = false;
        }

        Ajax.Utility.RegisterTypeForAjax(typeof(IndustryMaster));



        DataSet objdataSetbut = new DataSet();
        objdataSetbut.ReadXml(Server.MapPath("XML/button.xml"));
        btnNew.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[0].ToString();
        btnSave.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[1].ToString();
        btnModify.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[2].ToString();
        btnQuery.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[3].ToString();
        btnExecute.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[4].ToString();
        btnCancel.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[5].ToString();
        btnfirst.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[6].ToString();
        btnprevious.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[7].ToString();
        btnnext.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[8].ToString();
        btnlast.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[9].ToString();
        btnDelete.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[10].ToString();
        btnExit.ImageUrl = objdataSetbut.Tables[0].Rows[0].ItemArray[11].ToString();

        DataSet objDataSet = new DataSet();
        // Read in the XML file
        objDataSet.ReadXml(Server.MapPath("XML/industrymaster.xml"));
        lbindustrycode.Text = objDataSet.Tables[0].Rows[0].ItemArray[0].ToString();
        lbindustryname.Text = objDataSet.Tables[0].Rows[0].ItemArray[1].ToString();
        lbindustryalias.Text = objDataSet.Tables[0].Rows[0].ItemArray[2].ToString();





        //btnNew.Focus();

        if (!Page.IsPostBack)
        {
            getbuttoncheck(formname);

            btnSave.Attributes.Add("onclick", "javascript:return saveindustry();");
            btnDelete.Attributes.Add("onclick", "return confirm('Are you sure you want to delete?');");
            btnExit.Attributes.Add("onclick", "javascript:return closeindustry();");
            txtindustryname.Attributes.Add("OnChange", "javascript:return autogen();");
            btnQuery.Attributes.Add("OnClick", "javascript:return chkquery1();");
            btnModify.Attributes.Add("OnClick", "javascript:return update1();");
        }
        btnimage();
        btnNew.Focus();
    }
    public void getbuttoncheck(string formname)
    {
        DataSet butt = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.classlibraryforbutton getpermission = new NewAdbooking.Classes.classlibraryforbutton();

            butt = getpermission.getbuttonpermission(Session["compcode"].ToString(), Session["userid"].ToString(), formname);
        }
        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.classlibraryforbutton getpermission = new NewAdbooking.classesoracle.classlibraryforbutton();

                butt = getpermission.getbuttonpermission(Session["compcode"].ToString(), Session["userid"].ToString(), formname);
            }



            else
            {
                NewAdbooking.classmysql.classlibraryforbutton getpermission = new NewAdbooking.classmysql.classlibraryforbutton();

                butt = getpermission.getbuttonpermission(Session["compcode"].ToString(), Session["userid"].ToString(), formname);

            }

        string id = butt.Tables[0].Rows[0].ItemArray[0].ToString();


        if (id != "0")
        {
            if (id == "0" || id == "8")
            {

                FlagStatus = 0;

                btnNew.Enabled = false;
                btnQuery.Enabled = false;
                btnExecute.Enabled = false;
                btnCancel.Enabled = false;
                btnExit.Enabled = false;
                btnDelete.Enabled = false;
                btnModify.Enabled = false;

                btnSave.Enabled = false;
                btnModify.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;

            }
            if (id == "1" || id == "9")
            {
                btnNew.Enabled = true;
                btnQuery.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnExecute.Enabled = false;

                btnSave.Enabled = false;
                btnModify.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                FlagStatus = 1;

            }
            if (id == "2" || id == "10")
            {

                btnNew.Enabled = false;
                btnExecute.Enabled = false;
                btnQuery.Enabled = true;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                //a//btnModify.Enabled = true;
                btnModify.Enabled = false;

                btnSave.Enabled = false;
                //a// btnfirst.Enabled = true;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExit.Enabled = true;
                FlagStatus = 2;


            }
            if (id == "3" || id == "11")
            {
                btnNew.Enabled = true;
                btnQuery.Enabled = true;
                btnExecute.Enabled = false;
                btnDelete.Enabled = false;
                btnModify.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;


                btnSave.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;

                FlagStatus = 3;



            }
            if (id == "4" || id == "12")
            {
                btnNew.Enabled = false;
                btnQuery.Enabled = true;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExecute.Enabled = false;

                btnNew.Enabled = false;
                btnExecute.Enabled = false;
                btnDelete.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;


                btnModify.Enabled = false;

                btnSave.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                FlagStatus = 4;
            }
            if (id == "5" || id == "13")
            {
                btnNew.Enabled = true;
                btnSave.Enabled = false;
                btnQuery.Enabled = true;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExecute.Enabled = false;
                btnModify.Enabled = false;
                FlagStatus = 5;


            }
            if (id == "6" || id == "14")
            {
                btnNew.Enabled = false;
                btnSave.Enabled = false;
                btnQuery.Enabled = true;
                btnModify.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExecute.Enabled = false;

                FlagStatus = 6;
            }
            if (id == "7" || id == "15")
            {
                btnNew.Enabled = true;
                btnSave.Enabled = false;
                btnQuery.Enabled = true;
                btnModify.Enabled = false;
                btnCancel.Enabled = true;
                btnExit.Enabled = true;
                btnDelete.Enabled = false;
                btnfirst.Enabled = false;
                btnnext.Enabled = false;
                btnprevious.Enabled = false;
                btnlast.Enabled = false;
                btnExecute.Enabled = false;
                FlagStatus = 7;

            }
        }
    }

    public void chkstatus(int FlagStatus)
    {
        if (FlagStatus == 0 || FlagStatus == 8)
        {
            btnNew.Enabled = false;
            btnQuery.Enabled = false;
            btnDelete.Enabled = false;
            btnSave.Enabled = false;
            btnExecute.Enabled = false;
            btnCancel.Enabled = false;
            btnModify.Enabled = false;

            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
            btnExit.Enabled = false;

        }
        if (FlagStatus == 1 || FlagStatus == 9)
        {
            btnNew.Enabled = false;
            btnQuery.Enabled = false;
            btnDelete.Enabled = false;
            btnSave.Enabled = true;
            btnExecute.Enabled = false;
            btnCancel.Enabled = true;
            btnModify.Enabled = false;

            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
            btnExit.Enabled = true;

        }
        if (FlagStatus == 2 || FlagStatus == 10)
        {
            btnExecute.Enabled = true;
            btnQuery.Enabled = false;
            btnDelete.Enabled = false;
            btnNew.Enabled = false;
            btnCancel.Enabled = true;
            btnExecute.Enabled = false;
            btnModify.Enabled = false;
            btnExit.Enabled = true;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
            btnExit.Enabled = true;


        }

        if (FlagStatus == 3 || FlagStatus == 11)
        {
            btnNew.Enabled = false;
            btnQuery.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = true;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }

        if (FlagStatus == 4 || FlagStatus == 12)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
        if (FlagStatus == 5 || FlagStatus == 13)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
        if (FlagStatus == 6 || FlagStatus == 14)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
        if (FlagStatus == 7 || FlagStatus == 15)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = true;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
    }

    public void updateStatus()
    {
        chkstatus(FlagStatus);
        if (FlagStatus == 2 || FlagStatus == 3)
        {
            btnQuery.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnModify.Enabled = true;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;
            btnDelete.Enabled = false;
        }
        if (FlagStatus == 4)
        {
            btnDelete.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnQuery.Enabled = true;
            btnModify.Enabled = false;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;

        }
        if (FlagStatus == 5)
        {
            btnDelete.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnQuery.Enabled = true;
            btnModify.Enabled = false;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;

        }
        if (FlagStatus == 6 || FlagStatus == 7)
        {
            btnDelete.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnQuery.Enabled = true;
            btnModify.Enabled = true;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;

        }
    }

    protected void btnNew_Click(object sender, EventArgs e)
    {
        pnew.Value = "1";
        txtindustrycode.Text = "";
        txtindustryname.Text = "";
        txtindustryalias.Text = "";
        query.Value = "1";
        saveormodify = "0";

        if (Session["autogenerated"].ToString() == "1")
        {
            txtindustrycode.Enabled = false;
            ScriptManager1.SetFocus(txtindustryname);
        }
        else
        {
            txtindustrycode.Enabled = true;
            ScriptManager1.SetFocus(txtindustrycode);
        }
        txtindustryname.Enabled = true;
        txtindustryalias.Enabled = true;

        chkstatus(FlagStatus);
        btnSave.Enabled = true;
        btnNew.Enabled = false;
        btnQuery.Enabled = false;
        btnCancel.Enabled = true;
        btnExit.Enabled = true;
        btnimage();

    }
    protected void btnSave_Click(object sender, EventArgs e)
    {
        pnew.Value = "0";
        string code = txtindustrycode.Text;
        string name = txtindustryname.Text;
        string alias = txtindustryalias.Text;
        query.Value = "1";
        if (saveormodify == "0")
        {
            DataSet ds = new DataSet();
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
            {
                NewAdbooking.Classes.industrymaster getcode = new NewAdbooking.Classes.industrymaster();

                ds = getcode.chkcode(code, name, Session["compcode"].ToString());
            }

            else
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                {
                    NewAdbooking.classesoracle.industrymaster getcode = new NewAdbooking.classesoracle.industrymaster();

                    ds = getcode.chkcode(code, name, Session["compcode"].ToString());
                }
                else
                {
                    NewAdbooking.classmysql.industrymaster getcode = new NewAdbooking.classmysql.industrymaster();

                    ds = getcode.chkcode(code, Session["compcode"].ToString());

                }
            if (ds.Tables[0].Rows.Count > 0)
            {
                // message = "Please Enter The Industry Code ";
                // if(txtindustrycode.Text==ds.Tables[0].Rows[0].ItemArray[0].ToString())
                //{
                message = "This Industry Code has already been assigned ";
                AspNetMessageBox(message);
                txtindustrycode.Text = "";
                ScriptManager1.SetFocus(txtindustrycode);
            }
            else if (ds.Tables[1].Rows.Count > 0)
            {
                message = "This Industry Name has already been assigned ";
                AspNetMessageBox(message);
                txtindustryname.Text = "";
                ScriptManager1.SetFocus(txtindustryname);

                return;

            }
            else
            {
                DataSet di = new DataSet();
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
                {
                    NewAdbooking.Classes.industrymaster insert = new NewAdbooking.Classes.industrymaster();

                    di = insert.insertvalue(code, name, alias, Session["compcode"].ToString(), Session["userid"].ToString());
                }

                else
                    if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                    {
                        NewAdbooking.classesoracle.industrymaster insert = new NewAdbooking.classesoracle.industrymaster();

                        di = insert.insertvalue(code, name, alias, Session["compcode"].ToString(), Session["userid"].ToString());

                    }
                    else
                    {
                        NewAdbooking.classmysql.industrymaster insert = new NewAdbooking.classmysql.industrymaster();

                        di = insert.insertvalue(code, name, alias, Session["compcode"].ToString(), Session["userid"].ToString());

                    }
                DataSet ds1 = new DataSet();
                ds1.ReadXml(Server.MapPath("XML/errorMessage.xml"));
                message = ds1.Tables[0].Rows[0].ItemArray[0].ToString();
                AspNetMessageBox(message);
                txtindustryalias.Text = "";
                txtindustryname.Text = "";
                txtindustrycode.Text = "";

                txtindustrycode.Enabled = false;
                txtindustryname.Enabled = false;
                txtindustryalias.Enabled = false;
                //  btnfirst.Enabled = false;
                //btnprevious.Enabled = false;
                // ScriptManager1.SetFocus(btnSave);
               
                getbuttoncheck(formname);
                btnimage();
                return;

            }
        }
        /////////////////for modify
        else
        {

            if (name_modify == txtindustryname.Text)
            {

                DataSet du = new DataSet();
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
                {
                    NewAdbooking.Classes.industrymaster upadte = new NewAdbooking.Classes.industrymaster();

                    du = upadte.updatevalue(code, name, alias, Session["compcode"].ToString(), Session["userid"].ToString());
                }
                else
                    if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                    {
                        NewAdbooking.classesoracle.industrymaster upadte = new NewAdbooking.classesoracle.industrymaster();

                        du = upadte.updatevalue(code, name, alias, Session["compcode"].ToString(), Session["userid"].ToString());

                    }
                    else
                    {
                        NewAdbooking.classmysql.industrymaster upadte = new NewAdbooking.classmysql.industrymaster();

                        du = upadte.updatevalue(code, name, alias, Session["compcode"].ToString(), Session["userid"].ToString());

                    }
            }
            else
            {
                DataSet ds = new DataSet();
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
                {
                    NewAdbooking.Classes.industrymaster getcode = new NewAdbooking.Classes.industrymaster();

                    ds = getcode.chkcode(code, name, Session["compcode"].ToString());
                }

                else
                    if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                    {
                        NewAdbooking.classesoracle.industrymaster getcode = new NewAdbooking.classesoracle.industrymaster();

                        ds = getcode.chkcode(code, name, Session["compcode"].ToString());
                    }
                    else
                    {
                        NewAdbooking.classmysql.industrymaster getcode = new NewAdbooking.classmysql.industrymaster();

                        ds = getcode.chkcode(code, Session["compcode"].ToString());

                    }
                if (ds.Tables[1].Rows.Count > 0)
                {
                    // message = "Please Enter The Industry Code ";
                    //if (txtindustryname.Text == ds.Tables[0].Rows[0].ItemArray[0].ToString())
                    //{
                    message = "This Industry Name has already been assigned ";
                    AspNetMessageBox(message);
                    txtindustryname.Text = "";
                    ScriptManager1.SetFocus(txtindustryname);
                    //}
                    //else
                    //{
                    //    message = "This Industry Name has already been assigned ";
                    //    AspNetMessageBox(message);
                    //    txtindustryname.Text = "";
                    //    ScriptManager1.SetFocus(txtindustryname);
                    //}
                    btnimage();
                    return;
                }

                DataSet du = new DataSet();
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
                {
                    NewAdbooking.Classes.industrymaster upadte = new NewAdbooking.Classes.industrymaster();

                    du = upadte.updatevalue(code, name, alias, Session["compcode"].ToString(), Session["userid"].ToString());
                }
                else
                    if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                    {
                        NewAdbooking.classesoracle.industrymaster upadte = new NewAdbooking.classesoracle.industrymaster();

                        du = upadte.updatevalue(code, name, alias, Session["compcode"].ToString(), Session["userid"].ToString());

                    }
                    else
                    {
                        NewAdbooking.classmysql.industrymaster upadte = new NewAdbooking.classmysql.industrymaster();

                        du = upadte.updatevalue(code, name, alias, Session["compcode"].ToString(), Session["userid"].ToString());
                    }
            }

            txtindustryalias.Enabled = false;
            txtindustryname.Enabled = false;
            txtindustrycode.Enabled = false;

            executepro.Tables[0].Rows[fpnl].ItemArray[0] = txtindustrycode.Text;
            executepro.Tables[0].Rows[fpnl].ItemArray[1] = txtindustryname.Text;
            executepro.Tables[0].Rows[fpnl].ItemArray[2] = txtindustryalias.Text;
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
            {

                NewAdbooking.Classes.industrymaster execute = new NewAdbooking.Classes.industrymaster();
                executepro = execute.executequery(d_code, d_alias, d_name, Session["compcode"].ToString());
            }

            else
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                {
                    NewAdbooking.classesoracle.industrymaster execute = new NewAdbooking.classesoracle.industrymaster();
                    executepro = execute.executequery(d_code, d_alias, d_name, Session["compcode"].ToString());
                }
                else
                {
                    NewAdbooking.classmysql.industrymaster execute = new NewAdbooking.classmysql.industrymaster();
                    executepro = execute.executequery(d_code, d_alias, d_name, Session["compcode"].ToString());

                }
            //DataSet ds = new DataSet();
            //ds = executepro;
            updateStatus();
            if (fpnl == 0)
            {
                btnfirst.Enabled = false;
                btnprevious.Enabled = false;
            }
            else if (fpnl == executepro.Tables[0].Rows.Count - 1)
            {
                btnnext.Enabled = false;
                btnlast.Enabled = false;
            }
            if (executepro.Tables[0].Rows.Count == 1)
            {
                btnfirst.Enabled = false;
                btnprevious.Enabled = false;
                btnnext.Enabled = false;
                btnlast.Enabled = false;
            }
            DataSet ds2 = new DataSet();
            ds2.ReadXml(Server.MapPath("XML/errorMessage.xml"));
            message = ds2.Tables[0].Rows[0].ItemArray[1].ToString();
            AspNetMessageBox(message);
            btnimage();
            return;
        }
    }

    protected void btnModify_Click(object sender, EventArgs e)
    {
        pnew.Value = "0";
        query.Value = "1";
        txtindustrycode.Enabled = false;
        txtindustryname.Enabled = true;
        txtindustryalias.Enabled = true;
        saveormodify = "1";

        name_modify = txtindustryname.Text;

        chkstatus(FlagStatus);

        btnSave.Enabled = true;
        btnQuery.Enabled = false;
        btnimage();
        ScriptManager1.SetFocus(txtindustryname);
        ScriptManager1.SetFocus(btnSave);
    }
    protected void btnQuery_Click(object sender, EventArgs e)
    {
        fpnl = 0;
        txtindustryalias.Text = "";
        txtindustryname.Text = "";
        txtindustrycode.Text = "";

        pnew.Value = "0";
        query.Value = "0";
        txtindustryalias.Enabled = true;
        txtindustryname.Enabled = true;
        txtindustrycode.Enabled = true;

        chkstatus(FlagStatus);

        btnQuery.Enabled = false;
        btnExecute.Enabled = true;
        btnSave.Enabled = false;
        btnimage();
        ScriptManager1.SetFocus(btnExecute);
    }
    protected void btnExecute_Click(object sender, EventArgs e)
    {
        pnew.Value = "0";

        string code = txtindustrycode.Text;
        d_code = code;
        string alias = txtindustryalias.Text;
        d_alias = alias;
        string name = txtindustryname.Text;
        d_name = name;
        query.Value = "1";
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.industrymaster chkexecute = new NewAdbooking.Classes.industrymaster();

            executepro = chkexecute.executequery(code, alias, name, Session["compcode"].ToString());
        }

        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.industrymaster chkexecute = new NewAdbooking.classesoracle.industrymaster();

                executepro = chkexecute.executequery(code, alias, name, Session["compcode"].ToString());
            }
            else
            {
                NewAdbooking.classmysql.industrymaster chkexecute = new NewAdbooking.classmysql.industrymaster();

                executepro = chkexecute.executequery(code, alias, name, Session["compcode"].ToString());

            }

        if (executepro.Tables[0].Rows.Count == 0)
        {

            message = "Your Search Produced No Results";
            AspNetMessageBox(message);
            chkstatus(FlagStatus);

            updateStatus();
            getbuttoncheck(formname);
            btnimage();
            txtindustryalias.Text = "";
            txtindustryname.Text = "";
            txtindustrycode.Text = "";
            txtindustryalias.Enabled = false;
            txtindustrycode.Enabled = false;
            txtindustryname.Enabled = false;
            btnNew.Enabled = true;
            btnModify.Enabled = false;
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;
            btnnext.Enabled = false;
            btnlast.Enabled = false;
            btnDelete.Enabled = false;
            return;
        }
        else
        {
            txtindustrycode.Text = executepro.Tables[0].Rows[0].ItemArray[0].ToString();
            txtindustryname.Text = executepro.Tables[0].Rows[0].ItemArray[1].ToString();
            txtindustryalias.Text = executepro.Tables[0].Rows[0].ItemArray[2].ToString();

            txtindustrycode.Enabled = false;
            txtindustryname.Enabled = false;
            txtindustryalias.Enabled = false;
            updateStatus();
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;
        }
        if (executepro.Tables[0].Rows.Count == 1)
        {
            btnnext.Enabled = false;
            btnlast.Enabled = false;
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;
        }
        btnimage();
        ScriptManager1.SetFocus(btnModify);
    }

    protected void btnCancel_Click(object sender, EventArgs e)
    {
        pnew.Value = "0";
        txtindustryalias.Text = "";
        txtindustrycode.Text = "";
        txtindustryname.Text = "";
        hiddenauto.Value = "";
        query.Value = "1";
        chkstatus(FlagStatus);

        getbuttoncheck(formname);

        btnSave.Enabled = false;
        txtindustryalias.Enabled = false;
        txtindustryname.Enabled = false;
        txtindustrycode.Enabled = false;
        btnimage();
        ScriptManager1.SetFocus(btnNew);
    }
    protected void btnfirst_Click(object sender, EventArgs e)
    {
        fpnl = 0;
        query.Value = "1";
        DataSet ds = new DataSet();
        ds = executepro;

        txtindustrycode.Text = ds.Tables[0].Rows[0].ItemArray[0].ToString();
        txtindustryname.Text = ds.Tables[0].Rows[0].ItemArray[1].ToString();
        txtindustryalias.Text = ds.Tables[0].Rows[0].ItemArray[2].ToString();

        updateStatus();

        btnfirst.Enabled = false;
        btnprevious.Enabled = false;
        btnimage();
        ScriptManager1.SetFocus(btnModify);
    }
    protected void btnprevious_Click(object sender, EventArgs e)
    {
        DataSet ds = new DataSet();
        ds = executepro;
        int count = ds.Tables[0].Rows.Count - 1;
        query.Value = "1";
        fpnl--;

        if (fpnl != -1)
        {
            if (fpnl >= 0 || fpnl <= count)
            {
                txtindustrycode.Text = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
                txtindustryname.Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
                txtindustryalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();

                updateStatus();

                btnfirst.Enabled = true;
                btnlast.Enabled = true;
                btnprevious.Enabled = true;
                btnnext.Enabled = true;
            }
            else
            {
                btnnext.Enabled = true;
                btnlast.Enabled = true;
                btnfirst.Enabled = false;
                btnprevious.Enabled = false;

            }
        }
        else
        {
            btnnext.Enabled = true;
            btnlast.Enabled = true;
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;

        }
        if (fpnl == 0)
        {
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;
            btnnext.Enabled = true;
            btnlast.Enabled = true;

        }
        btnimage();
        ScriptManager1.SetFocus(btnModify);
    }

    protected void btnnext_Click(object sender, EventArgs e)
    {
        DataSet ds = new DataSet();
        ds = executepro;
        int count = ds.Tables[0].Rows.Count - 1;
        fpnl++;
        query.Value = "1";
        if (fpnl != -1 && fpnl >= 0)
        {
            if (fpnl <= count)
            {
                txtindustrycode.Text = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
                txtindustryname.Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
                txtindustryalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();

                btnfirst.Enabled = true;
                btnprevious.Enabled = true;

            }

            else
            {
                btnnext.Enabled = false;
                btnlast.Enabled = false;
                btnfirst.Enabled = true;
                btnprevious.Enabled = true;

            }
        }
        else
        {
            btnnext.Enabled = false;
            btnlast.Enabled = false;
            btnfirst.Enabled = true;
            btnprevious.Enabled = true;

        }
        if (fpnl == count)
        {
            btnnext.Enabled = false;
            btnlast.Enabled = false;
            btnfirst.Enabled = true;
            btnprevious.Enabled = true;

        }
        btnimage();
        ScriptManager1.SetFocus(btnModify);
    }
    protected void btnlast_Click(object sender, EventArgs e)
    {
        DataSet ds = new DataSet();
        ds = executepro;
        int count = ds.Tables[0].Rows.Count;
        fpnl = count - 1;
        query.Value = "1";

        txtindustrycode.Text = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
        txtindustryname.Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
        txtindustryalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();

        updateStatus();

        btnfirst.Enabled = true;
        btnprevious.Enabled = true;
        btnlast.Enabled = false;
        btnnext.Enabled = false;
        btnimage();
        ScriptManager1.SetFocus(btnModify);

    }
    protected void btnDelete_Click(object sender, EventArgs e)
    {
        string code = txtindustrycode.Text;
        query.Value = "1";
        DataSet ds1 = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.industrymaster del = new NewAdbooking.Classes.industrymaster();

            ds1 = del.deletevalue(code, Session["compcode"].ToString());
        }

        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.industrymaster del = new NewAdbooking.classesoracle.industrymaster();

                ds1 = del.deletevalue(code, Session["compcode"].ToString());
            }
            else
            {
                NewAdbooking.classmysql.industrymaster del = new NewAdbooking.classmysql.industrymaster();

                ds1 = del.deletevalue(code, Session["compcode"].ToString());

            }
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {

            NewAdbooking.Classes.industrymaster execute = new NewAdbooking.Classes.industrymaster();
            executepro = execute.executequery(d_code, d_alias, d_name, Session["compcode"].ToString());
        }

        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.industrymaster execute = new NewAdbooking.classesoracle.industrymaster();
                executepro = execute.executequery(d_code, d_alias, d_name, Session["compcode"].ToString());
            }
            else
            {
                NewAdbooking.classmysql.industrymaster execute = new NewAdbooking.classmysql.industrymaster();
                executepro = execute.executequery(d_code, d_alias, d_name, Session["compcode"].ToString());

            }
        int a = executepro.Tables[0].Rows.Count;
        if (a <= 0)
        {
            if (a < 0)
            {
                message = "There Is No Data";
                AspNetMessageBox(message);
            }
            else
            {
                DataSet ds23 = new DataSet();
                ds23.ReadXml(Server.MapPath("XML/errorMessage.xml"));
                message = ds23.Tables[0].Rows[0].ItemArray[2].ToString();
                AspNetMessageBox(message);
            }
            chkstatus(FlagStatus);
           
            updateStatus();
            getbuttoncheck(formname);
            btnimage();
            txtindustryalias.Text = "";
            txtindustryname.Text = "";
            txtindustrycode.Text = "";

            return;

        }
        else if (fpnl == -1 || fpnl <= a)
        {
            DataSet ds = new DataSet();

            ds = executepro;
            txtindustrycode.Text = ds.Tables[0].Rows[0].ItemArray[0].ToString();
            txtindustryname.Text = ds.Tables[0].Rows[0].ItemArray[1].ToString();
            txtindustryalias.Text = ds.Tables[0].Rows[0].ItemArray[2].ToString();
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;
            if (a == 1)
            {
                btnnext.Enabled = false;
                btnlast.Enabled = false;
            }
            else
            {
                btnnext.Enabled = true;
                btnlast.Enabled = true;
            }
            fpnl = 0;
        }
        else
        {
            DataSet ds = new DataSet();
            ds = executepro;
            txtindustrycode.Text = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
            txtindustryname.Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
            txtindustryalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
        }
        DataSet ds3 = new DataSet();
        ds3.ReadXml(Server.MapPath("XML/errorMessage.xml"));
        message = ds3.Tables[0].Rows[0].ItemArray[2].ToString();
        AspNetMessageBox(message);
        btnimage();
    }

    protected void btnExit_Click(object sender, EventArgs e)
    {

    }
    protected void AspNetMessageBox(string strMessage)
    {
        string strAlert = "";
        strAlert = "alert('" + strMessage + "')";
        ScriptManager.RegisterClientScriptBlock(this, typeof(IndustryMaster), "ShowAlert", strAlert, true);
    }
    [Ajax.AjaxMethod]

    public DataSet adchkadvcode(string str)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.industrymaster auto = new NewAdbooking.Classes.industrymaster();

            ds = auto.autocode(str);
            return ds;
        }

        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.industrymaster auto = new NewAdbooking.classesoracle.industrymaster();
                ds = auto.autocode(str);
                return ds;
            }
            else
            {
                NewAdbooking.classmysql.industrymaster auto = new NewAdbooking.classmysql.industrymaster();

                ds = auto.autocode(str);
                return ds;
            }
    }
    public void btnimage()
    {
        DataSet ds = new DataSet();
        ds.ReadXml(Server.MapPath("XML/button.xml"));
        if (btnNew.Enabled == false)
            btnNew.ImageUrl = ds.Tables[1].Rows[0].ItemArray[0].ToString();
        else
            btnNew.ImageUrl = ds.Tables[0].Rows[0].ItemArray[0].ToString();
        if (btnSave.Enabled == false)
            btnSave.ImageUrl = ds.Tables[1].Rows[0].ItemArray[1].ToString();
        else
            btnSave.ImageUrl = ds.Tables[0].Rows[0].ItemArray[1].ToString();
        if (btnModify.Enabled == false)
            btnModify.ImageUrl = ds.Tables[1].Rows[0].ItemArray[2].ToString();
        else
            btnModify.ImageUrl = ds.Tables[0].Rows[0].ItemArray[2].ToString();
        if (btnQuery.Enabled == false)
            btnQuery.ImageUrl = ds.Tables[1].Rows[0].ItemArray[3].ToString();
        else
            btnQuery.ImageUrl = ds.Tables[0].Rows[0].ItemArray[3].ToString();
        if (btnExecute.Enabled == false)
            btnExecute.ImageUrl = ds.Tables[1].Rows[0].ItemArray[4].ToString();
        else
            btnExecute.ImageUrl = ds.Tables[0].Rows[0].ItemArray[4].ToString();
        if (btnCancel.Enabled == false)
            btnCancel.ImageUrl = ds.Tables[1].Rows[0].ItemArray[5].ToString();
        else
            btnCancel.ImageUrl = ds.Tables[0].Rows[0].ItemArray[5].ToString();
        if (btnfirst.Enabled == false)
            btnfirst.ImageUrl = ds.Tables[1].Rows[0].ItemArray[6].ToString();
        else
            btnfirst.ImageUrl = ds.Tables[0].Rows[0].ItemArray[6].ToString();
        if (btnprevious.Enabled == false)
            btnprevious.ImageUrl = ds.Tables[1].Rows[0].ItemArray[7].ToString();
        else
            btnprevious.ImageUrl = ds.Tables[0].Rows[0].ItemArray[7].ToString();
        if (btnnext.Enabled == false)
            btnnext.ImageUrl = ds.Tables[1].Rows[0].ItemArray[8].ToString();
        else
            btnnext.ImageUrl = ds.Tables[0].Rows[0].ItemArray[8].ToString();
        if (btnlast.Enabled == false)
            btnlast.ImageUrl = ds.Tables[1].Rows[0].ItemArray[9].ToString();
        else
            btnlast.ImageUrl = ds.Tables[0].Rows[0].ItemArray[9].ToString();
        if (btnDelete.Enabled == false)
            btnDelete.ImageUrl = ds.Tables[1].Rows[0].ItemArray[10].ToString();
        else
            btnDelete.ImageUrl = ds.Tables[0].Rows[0].ItemArray[10].ToString();
        if (btnExit.Enabled == false)
            btnExit.ImageUrl = ds.Tables[1].Rows[0].ItemArray[11].ToString();
        else
            btnExit.ImageUrl = ds.Tables[0].Rows[0].ItemArray[11].ToString();
    }
}

