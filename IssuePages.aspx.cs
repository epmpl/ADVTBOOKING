using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

public partial class IssuePages : System.Web.UI.Page
{
    string username, userid;
    string dateformat, id;
  //  protected DatePickerWebCtrl.DatePicker dtp;
    protected void Page_Load(object sender, EventArgs e)
    {
        Response.Expires = -1;
        Response.Buffer = true;
        Response.ExpiresAbsolute = DateTime.Now.AddDays(-1d);
        Response.Expires = -1500;
        Response.CacheControl = "no-cache";


        if (Session["compcode"] != null)
        {
            hiddencompcode.Value = Session["compcode"].ToString();
            hiddenuserid.Value = Session["userid"].ToString();
            hiddenusername.Value = Session["username"].ToString();
            hiddenauto.Value = Session["autogenerated"].ToString();
        }
        else
        {
            li.Text = "<script>window.parent.location=\"login.aspx\";</script>";

            return;
        }
       
       // dtp = new DatePickerWebCtrl.DatePicker();
       // dtp.DateType = "dd/mm/yyyy";
      //  PubDate.Controls.Add(dtp);

        DataSet objDataSet = new DataSet();
        // Read in the XML file
        objDataSet.ReadXml(Server.MapPath("XML/BookingUnit.xml"));
        lblPublicationDate.Text = objDataSet.Tables[0].Rows[0].ItemArray[0].ToString();
        lblPublication.Text = objDataSet.Tables[0].Rows[0].ItemArray[1].ToString();
        lblCenter.Text = objDataSet.Tables[0].Rows[0].ItemArray[2].ToString();
        lblEdition.Text = objDataSet.Tables[0].Rows[0].ItemArray[3].ToString();
        lblSupplement.Text = objDataSet.Tables[0].Rows[0].ItemArray[4].ToString();
        btnIssueVolume.Text = objDataSet.Tables[0].Rows[0].ItemArray[5].ToString();
        lblColorAd.Text = objDataSet.Tables[0].Rows[0].ItemArray[8].ToString();
        lblBWAd.Text = objDataSet.Tables[0].Rows[0].ItemArray[9].ToString();
        lblTotalVolume.Text = objDataSet.Tables[0].Rows[0].ItemArray[10].ToString();
        lblSelectPage.Text = objDataSet.Tables[0].Rows[0].ItemArray[6].ToString();
        btnSubmit.Text = objDataSet.Tables[0].Rows[0].ItemArray[7].ToString();

        DataSet objDataSetbu = new DataSet();
        // Read in the XML file
        objDataSetbu.ReadXml(Server.MapPath("XML/button.xml"));
        btnQuery.Text = objDataSetbu.Tables[0].Rows[0].ItemArray[3].ToString();
        btnExit.Text = objDataSetbu.Tables[0].Rows[0].ItemArray[11].ToString();

        string ss = hiddenpermission.Value;
        hiddenpermission.Value = "";
        Ajax.Utility.RegisterTypeForAjax(typeof(IssuePages));

        hiddenusername.Value = Session["Username"].ToString();

        if (Session["Username"] == null)
        {
            //Response.Redirect("login.aspx");

            Response.Write("<script>window.parent.location=\"login.aspx\";</script>");
            return;
        }
        else
        {
            username = Session["Username"].ToString();
            userid = Session["userid"].ToString();
        }
        if (!Page.IsPostBack)
        {
            btnExit.Attributes.Add("OnClick", "javascript:return exitclick();");
            btnQuery.Attributes.Add("OnClick", "javascript:return queryclick();");
            btnIssueVolume.Attributes.Add("OnClick","javascript:return Issuevolumeclick();");
            btnSubmit.Attributes.Add("OnClick", "javascript:return IssuePagesSubmitclick();");

            disable();
            addpubcode();

            addcentercode();
            addeditioncode();
            addsecpubcode();
        }
        
        DateTime da = DateTime.Now;
        string formname = "IssuePages";
        NewAdbooking.Classes.Masters checkform = new NewAdbooking.Classes.Masters();
        DataSet dz = new DataSet();
        dz = checkform.formpermission(hiddencompcode.Value, hiddenuserid.Value, formname);
        if (dz.Tables[0].Rows.Count > 0)
        {
            id = dz.Tables[0].Rows[0].ItemArray[0].ToString();
            if (id == "0" || id == "8")
            {
                hiddenpermission.Value = "zero";
                Response.Write("<script>alert('You Are Not Authorised To See This Form');</script>");
                return;
            }
        }
               
    }

    public void disable()
    {
        ddlPublication.Enabled = false;
        ddlCenter.Enabled = false;
        ddlEdition.Enabled = false;
        ddlSupplement.Enabled = false;
    }

    public void addpubcode()
    {

        NewAdbooking.Classes.Masters Pripubl = new NewAdbooking.Classes.Masters();
        ddlPublication.Items.Clear();
        DataSet ds = new DataSet();
        ds = Pripubl.Pripubcode(Session["compcode"].ToString(), Session["userid"].ToString());
        int i;
        ListItem li1;
        li1 = new ListItem();
        li1.Text = "--Select Publ Code--";
        li1.Value = "0";//objDataSet.Tables[0].Rows[i].ItemArray[0].ToString();
        li1.Selected = true;
        ddlPublication.Items.Add(li1);

        if (ds.Tables[0].Rows.Count > 0)
        {
            for (i = 0; i < ds.Tables[0].Rows.Count; i++)
            {
                ListItem li;
                li = new ListItem();
                li.Text = ds.Tables[0].Rows[i].ItemArray[0].ToString();
               // li.Value = ds.Tables[0].Rows[i].ItemArray[1].ToString();                
                ddlPublication.Items.Add(li);
            }

        }
    }

    public void addcentercode()
    {

        NewAdbooking.Classes.Masters addCenter = new NewAdbooking.Classes.Masters();
        ddlCenter.Items.Clear();
        DataSet ds = new DataSet();
        ds = addCenter.centercode(Session["compcode"].ToString(), Session["userid"].ToString());
        int i;
        ListItem li1;
        li1 = new ListItem();
        li1.Text = "--Select Center--";
        li1.Value = "0";//objDataSet.Tables[0].Rows[i].ItemArray[0].ToString();
        li1.Selected = true;
        ddlCenter.Items.Add(li1);

        if (ds.Tables[0].Rows.Count > 0)
        {
            for (i = 0; i < ds.Tables[0].Rows.Count; i++)
            {
                ListItem li;
                li = new ListItem();
                li.Text = ds.Tables[0].Rows[i].ItemArray[0].ToString();
                // li.Value = ds.Tables[0].Rows[i].ItemArray[1].ToString();                
                ddlCenter.Items.Add(li);
            }

        }
    }

    public void addeditioncode()
    {

        NewAdbooking.Classes.Masters addEdition = new NewAdbooking.Classes.Masters();
        ddlEdition.Items.Clear();
        DataSet ds = new DataSet();
        ds = addEdition.editioncode(Session["compcode"].ToString(), Session["userid"].ToString());
        int i;
        ListItem li1;
        li1 = new ListItem();
        li1.Text = "--Select Edition--";
        li1.Value = "0";//objDataSet.Tables[0].Rows[i].ItemArray[0].ToString();
        li1.Selected = true;
        ddlEdition.Items.Add(li1);

        if (ds.Tables[0].Rows.Count > 0)
        {
            for (i = 0; i < ds.Tables[0].Rows.Count; i++)
            {
                ListItem li;
                li = new ListItem();
                li.Text = ds.Tables[0].Rows[i].ItemArray[0].ToString();
                // li.Value = ds.Tables[0].Rows[i].ItemArray[1].ToString();                
                ddlEdition.Items.Add(li);
            }

        }
    }

    public void addsecpubcode()
    {

        NewAdbooking.Classes.Masters addSecpub = new NewAdbooking.Classes.Masters();
        ddlSupplement.Items.Clear();
        DataSet ds = new DataSet();
        ds = addSecpub.secpubcode(Session["compcode"].ToString(), Session["userid"].ToString());
        int i;
        ListItem li1;
        li1 = new ListItem();
        li1.Text = "--Select Supplement--";
        li1.Value = "0";//objDataSet.Tables[0].Rows[i].ItemArray[0].ToString();
        li1.Selected = true;
        ddlSupplement.Items.Add(li1);

        if (ds.Tables[0].Rows.Count > 0)
        {
            for (i = 0; i < ds.Tables[0].Rows.Count; i++)
            {
                ListItem li;
                li = new ListItem();
                li.Text = ds.Tables[0].Rows[i].ItemArray[0].ToString();
                // li.Value = ds.Tables[0].Rows[i].ItemArray[1].ToString();                
                ddlSupplement.Items.Add(li);
            }

        }
    }

    [Ajax.AjaxMethod]
    //Display booking Ad Volume  
    public DataSet bkvolume(string compcode, string pubdate, string pubcode, string centercode, string editioncode, string suppcode)
    {
        //agenname=drpparent.Text.ToString();
        NewAdbooking.Classes.getVolume bindvolume = new NewAdbooking.Classes.getVolume();
        DataSet ds = new DataSet();
        ds = bindvolume.BookedVolume(compcode, pubdate,pubcode, centercode, editioncode, suppcode);
        ////if (ds.Tables[0].Rows.Count > 0)
        ////    totalVol = ds.Tables[0].Rows[0].ItemArray[0].ToString();
       
        return ds;
    }

    

    [Ajax.AjaxMethod]

    public DataSet bkIssuePages(string compcode, string pubcode, string centercode, string editioncode, string suppcode)
    {
        NewAdbooking.Classes.getVolume bindPages = new NewAdbooking.Classes.getVolume();
        DataSet ds = new DataSet();
        ds = bindPages.BookedPages(compcode,pubcode, centercode, editioncode, suppcode);
        
        return ds;
    }

    [Ajax.AjaxMethod]

    public DataSet configIssuePages(string compcode, string userid, string pubdate, string pubcode, string centercode, string editioncode, string suppcode, int drlIssuePages)
    {
        NewAdbooking.Classes.getVolume configPages = new NewAdbooking.Classes.getVolume();
        DataSet ds = new DataSet();
        configPages.SubmitPages(compcode, userid,pubdate, pubcode, centercode, editioncode, suppcode, drlIssuePages);
        
        return ds;
    }

}
