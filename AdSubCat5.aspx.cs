using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;
using System.Data.SqlClient;

public partial class AdSubCat5 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
                      Response.Expires = -1;

                 if (Session["compcode"] == null)
                       {
                          Response.Redirect("login.aspx");
                           Response.Write("<script>window.parent.location=\"login.aspx\";</script>");
                           return;
                       }
                       ip1.Value = Request.ServerVariables["REMOTE_ADDR"];
                       hiddencomcode.Value = Session["compcode"].ToString();
                       hiddencompcode.Value = Session["compcode"].ToString();
                       hiddenuserid.Value = Session["userid"].ToString();
                       hiddenDateFormat.Value = Session["DateFormat"].ToString();
                       hiddenusername.Value = Session["Username"].ToString();
                       hiddenauto.Value = Session["autogenerated"].ToString();

        Ajax.Utility.RegisterTypeForAjax(typeof(AdSubCat5));

      

        
        DataSet objDataSetbu = new DataSet();
        //***********************************************************************//
        //*****************Code For Read the data from xml File******************//
        //*******************************For The Button**************************//
        //***********************************************************************/
        objDataSetbu.ReadXml(Server.MapPath("XML/button.xml"));
        btnNew.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[0].ToString();
        btnSave.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[1].ToString();
        btnModify.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[2].ToString();
        btnQuery.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[3].ToString();
        btnExecute.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[4].ToString();
        btnCancel.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[5].ToString();
        btnfirst.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[6].ToString();
        btnprevious.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[7].ToString();
        btnnext.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[8].ToString();
        btnlast.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[9].ToString();
        btnDelete.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[10].ToString();
        btnExit.ImageUrl = objDataSetbu.Tables[0].Rows[0].ItemArray[11].ToString();



        //********************************For Label****************************************/
        DataSet ds = new DataSet();
        ds.ReadXml(Server.MapPath("XML/AdSubCat5.xml"));
        AdCategoryName.Text=ds.Tables[0].Rows[0].ItemArray[0].ToString();
        AdCatName.Text = ds.Tables[0].Rows[0].ItemArray[1].ToString();
        AdCatCode.Text = ds.Tables[0].Rows[0].ItemArray[2].ToString();
        Alias.Text = ds.Tables[0].Rows[0].ItemArray[3].ToString();
        salesorg.Text = ds.Tables[0].Rows[0].ItemArray[4].ToString();



        btnNew.Enabled = true;
        btnNew.Focus();
       
        btnSave.Enabled = false;
        btnModify.Enabled = false;
        btnDelete.Enabled = false;
        btnQuery.Enabled = true;
        btnExecute.Enabled = false;
        btnCancel.Enabled = true;
        btnfirst.Enabled = false;
        btnprevious.Enabled = false;
        btnnext.Enabled = false;
        btnlast.Enabled = false;
        btnExit.Enabled = true;

        txtalias.Enabled = false;
        txtadcatname.Enabled = false;
       txtadcatcode.Enabled = false;
        drpadvcatcode.Enabled = false;
        if (!IsPostBack)
        {
            txtalias.Attributes.Add("OnBlur", "javascript:return uppercase1('txtalias');");
            txtadcatcode.Attributes.Add("OnBlur", "javascript:return uppercase1('txtadcatcode');");

            btnNew.Attributes.Add("OnClick", "javascript:return catnewclick();");
            btnSave.Attributes.Add("OnClick", "javascript:return catsaveclick();");
            txtadcatname.Attributes.Add("OnChange", "javascript:return autoornot();");
            btnModify.Attributes.Add("OnClick", "javascript:return catmodifyclick();");
            btnQuery.Attributes.Add("OnClick", "javascript:return catqueryclick();");
            btnExecute.Attributes.Add("OnClick", "javascript:return catexecuteclick();");
            btnfirst.Attributes.Add("OnClick", "javascript:return firstcall();");
            btnprevious.Attributes.Add("OnClick", "javascript:return previouscall();");
            btnnext.Attributes.Add("OnClick", "javascript:return catnextclick();");
            btnlast.Attributes.Add("OnClick", "javascript:return lastcall();");
            btnExit.Attributes.Add("OnClick", "javascript:return catexitclick();");
            btnDelete.Attributes.Add("OnClick", "javascript:return catdeleteclick();");
            btnCancel.Attributes.Add("OnClick", "javascript:return catcancelclick('AdSubCat5');");

            category(Session["compcode"].ToString());

        }
        if (btnNew.Enabled == false)
            btnNew.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[0].ToString();
        if (btnSave.Enabled == false)
            btnSave.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[1].ToString();
        if (btnModify.Enabled == false)
            btnModify.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[2].ToString();
        if (btnQuery.Enabled == false)
            btnQuery.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[3].ToString();
        if (btnExecute.Enabled == false)
            btnExecute.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[4].ToString();
        if (btnCancel.Enabled == false)
            btnCancel.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[5].ToString();
        if (btnfirst.Enabled == false)
            btnfirst.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[6].ToString();
        if (btnprevious.Enabled == false)
            btnprevious.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[7].ToString();
        if (btnnext.Enabled == false)
            btnnext.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[8].ToString();
        if (btnlast.Enabled == false)
            btnlast.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[9].ToString();
        if (btnDelete.Enabled == false)
            btnDelete.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[10].ToString();
        if (btnExit.Enabled == false)
            btnExit.ImageUrl = objDataSetbu.Tables[1].Rows[0].ItemArray[11].ToString();

    }
    public void category(string compcode)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.AdSubCat5 category = new NewAdbooking.Classes.AdSubCat5();
            ds = category.addcategoryname(compcode);
        }
        else if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.AdSubCat5 category = new NewAdbooking.classesoracle.AdSubCat5();
            ds = category.addcategoryname(compcode);
        }
        else
        {
            string procedureName = "Ad_Cat5_Ad_Cat5_p";
            NewAdbooking.classmysql.CommonClass obj = new NewAdbooking.classmysql.CommonClass();
            string[] parameterValueArray = new string[] { compcode };
            ds = obj.DynamicBindProcedure(procedureName, parameterValueArray);
        }
            ListItem li1;
            li1 = new ListItem();
            li1.Text = "-Select Ad Category-";
            li1.Value = "0";
            li1.Selected = true;
            drpadvcatcode.Items.Add(li1);

            int i;
            for (i = 0; i < ds.Tables[0].Rows.Count; i++)
            {
                ListItem li;
                li = new ListItem();
                li.Text = ds.Tables[0].Rows[i].ItemArray[0].ToString();
                li.Value = ds.Tables[0].Rows[i].ItemArray[1].ToString();
                drpadvcatcode.Items.Add(li);
            }
        }
       
    
    [Ajax.AjaxMethod(Ajax.HttpSessionStateRequirement.Read)]
    public DataSet savecat4(string compcode, string subcatname, string catname, string catalias, string catcode, string userid, string ip, string sapecode)
    {
        DataSet ds = new DataSet();
        string err = "";
        try
        {
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
            {
                NewAdbooking.Classes.AdSubCat5 save = new NewAdbooking.Classes.AdSubCat5();

                ds = save.savecat4(compcode, subcatname, catname, catcode, catalias, userid, sapecode);
                //   return ds;
            }
            else if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.AdSubCat5 save = new NewAdbooking.classesoracle.AdSubCat5();
                ds = save.savecat4(compcode, subcatname, catname, catcode, catalias, userid,sapecode);
                // return ds;
            }
            else
            {
                string procedureName = "Cat5_Save_Cat5_Save_p";
                NewAdbooking.classmysql.CommonClass obj = new NewAdbooking.classmysql.CommonClass();
                string[] parameterValueArray = new string[] { compcode, subcatname, catname, catalias, catcode, userid, sapecode };
                ds = obj.DynamicBindProcedure(procedureName, parameterValueArray);
            }
        }
        catch (Exception e)
        {
            err = e.Message;
        }
        string catcode1 = "Inserted Ad Sub Category5 " + catcode;
        clsconnection dconnect = new clsconnection();
        string sqldd = "insert into log_new (DATE1,USERID,PROCESSNAME,ERR_DESCRIPTION,OBJECT_PROCESS_ID,DESCRIPTION,IP) values($date,'" + HttpContext.Current.Session["UserId"] + "','Ad Sub Category5 ','" + err.Replace("'", "''") + "','Ad Sub Category5 Created','" + catcode1;
        sqldd = sqldd + "',";
        sqldd = sqldd + "'" + ip + "')";
        dconnect.executenonquery1(sqldd);
        return ds;
    }
    [Ajax.AjaxMethod(Ajax.HttpSessionStateRequirement.Read)]
    public DataSet catmodify(string compcode, string subcatname, string catname, string catcode, string catalias, string userid, string ip, string sapecode)
    {
        DataSet ds = new DataSet();
        string err = "";
        try
        {

            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
            {
                NewAdbooking.Classes.AdSubCat5 catmod = new NewAdbooking.Classes.AdSubCat5();

                ds = catmod.catmodify(compcode, subcatname, catname, catcode, catalias, userid,sapecode);
                //return ds;
            }
            else if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.AdSubCat5 catmod = new NewAdbooking.classesoracle.AdSubCat5();
                ds = catmod.catmodify(compcode, subcatname, catname, catcode, catalias, userid, sapecode);
                //return ds;
            }
            else
            {
                string procedureName = "Cat5_Modify_Cat5_Modify_p";
                NewAdbooking.classmysql.CommonClass obj = new NewAdbooking.classmysql.CommonClass();
                string[] parameterValueArray = new string[] { compcode, subcatname, catname, catcode, catalias, userid, sapecode };
                ds = obj.DynamicBindProcedure(procedureName, parameterValueArray);
            }
        }
        catch (Exception e)
        {
            err = e.Message;
        }
        string catcode2 = "Modified Ad Sub Category5 " + catcode;
        clsconnection dconnect = new clsconnection();
        string sqldd = "insert into log_new (DATE1,USERID,PROCESSNAME,ERR_DESCRIPTION,OBJECT_PROCESS_ID,DESCRIPTION,IP) values($date,'" + HttpContext.Current.Session["UserId"] + "','Ad Sub Category5 ','" + err.Replace("'", "''") + "','Ad Sub Category5 Updated','" + catcode2;
        sqldd = sqldd + "',";
        sqldd = sqldd + "'" + ip + "')";
        dconnect.executenonquery1(sqldd);
        return ds;
    }
    [Ajax.AjaxMethod]
    public DataSet catexecute1(string compcode, string subcatname, string catcode, string catname, string catalias, string userid)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.AdSubCat5 catexe = new NewAdbooking.Classes.AdSubCat5();

            ds = catexe.catexecute1(compcode, subcatname, catcode, catname, catalias, userid);
            return ds;
        }
        else if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.AdSubCat5 catexe = new NewAdbooking.classesoracle.AdSubCat5();
              ds = catexe.catexecute1(compcode, subcatname, catcode, catname, catalias, userid);
              return ds;
        }
        else
        {
            string procedureName = "Cat5_Exe1_Cat5_Exe1_p";
            NewAdbooking.classmysql.CommonClass obj = new NewAdbooking.classmysql.CommonClass();
            string[] parameterValueArray = new string[] { compcode, subcatname, catcode, catname, catalias, userid };
            ds = obj.DynamicBindProcedure(procedureName, parameterValueArray);
        }
        return ds;
    }

    //[Ajax.AjaxMethod]
    //public DataSet catfpnl()
    //{
    //    DataSet ds = new DataSet();
    //    if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
    //    {
    //        NewAdbooking.Classes.AdSubCat5 first = new NewAdbooking.Classes.AdSubCat5();

    //        ds = first.catfpnl();
    //        return ds;
    //    }
    //    else
    //    {
    //        NewAdbooking.classmysql.AdSubCat5 first = new NewAdbooking.classmysql.AdSubCat5();
    //        ds = first.catfpnl();
    //        return ds;
    //    }

    //}
    [Ajax.AjaxMethod(Ajax.HttpSessionStateRequirement.Read)]
    public void catdelete(string catcode, string ip)
    {
        DataSet ds = new DataSet();
        string err = "";
        try
        {
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
            {
                NewAdbooking.Classes.AdSubCat5 catdel = new NewAdbooking.Classes.AdSubCat5();

                ds = catdel.catdelete(catcode);
            }
            else if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.AdSubCat5 catdel = new NewAdbooking.classesoracle.AdSubCat5();

                ds = catdel.catdelete(catcode);
            }
            else
            {
                string procedureName = "CAT5_DELETE_CAT5_DELETE_P1";
                NewAdbooking.classmysql.CommonClass obj = new NewAdbooking.classmysql.CommonClass();
                string[] parameterValueArray = new string[] { catcode };
                ds = obj.DynamicBindProcedure(procedureName, parameterValueArray);
            }
        }
        catch (Exception e)
        {
            err = e.Message;
        }
        string catcode3 = "Deleted Ad Sub Category5 " + catcode;
        clsconnection dconnect = new clsconnection();
        string sqldd = "insert into log_new (DATE1,USERID,PROCESSNAME,ERR_DESCRIPTION,OBJECT_PROCESS_ID,DESCRIPTION,IP) values($date,'" + HttpContext.Current.Session["UserId"] + "','Ad Sub Category5 ','" + err.Replace("'", "''") + "','Ad Sub Category5 Deleted','" + catcode3;
        sqldd = sqldd + "',";
        sqldd = sqldd + "'" + ip + "')";
        dconnect.executenonquery1(sqldd);
    }
    [Ajax.AjaxMethod]

    public DataSet chkcatcod(string catname, string subcatname)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.AdSubCat5 Chkcatcod = new NewAdbooking.Classes.AdSubCat5();
            ds = Chkcatcod.chkcatcod(catname, subcatname);
            return ds;
        }
        else if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.AdSubCat5 Chkcatcod = new NewAdbooking.classesoracle.AdSubCat5();
            ds = Chkcatcod.chkcatcod(catname, subcatname);
            return ds;
        }
        else
        {
            NewAdbooking.classmysql.AdSubCat5 Chkcatcod = new NewAdbooking.classmysql.AdSubCat5();
            ds = Chkcatcod.chkcatcod(catname, subcatname);
            return ds;
        }
    }
    [Ajax.AjaxMethod]
    public DataSet catdauto(string str, string subcatname)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.AdSubCat5 chk = new NewAdbooking.Classes.AdSubCat5();

            ds = chk.catdauto(str, subcatname);
            return ds;
        }
        else if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.AdSubCat5 chk = new NewAdbooking.classesoracle.AdSubCat5();
            ds = chk.catdauto(str,subcatname);
            return ds;
        }
        else
        {
            NewAdbooking.classmysql.AdSubCat5 chk = new NewAdbooking.classmysql.AdSubCat5();
            ds = chk.catdauto(str, subcatname);
            return ds;
        }
    }
}
    
