using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;
//using System.Windows.Forms;

public partial class ProductSubCategory : System.Web.UI.Page
{
    string formname = "ProductSubCategory";
    static int FlagStatus, fpnl,flag;
    static string saveormodify;
    string message;
    static DataSet executesubpro = new DataSet();
    static string exesubcode, exesubname, exesubalias, exeprosubdes;
    string compcode, userid;

    protected void Page_Load(object sender, EventArgs e)
    {
        Response.Expires = -1;
        if (Session["compcode"] != null)
        {
            hiddencompcode.Value = Session["compcode"].ToString();
            hiddenuserid.Value = Session["userid"].ToString();
            hiddenauto.Value = Session["autogenerated"].ToString();
            compcode = hiddencompcode.Value;
            userid = hiddenuserid.Value;

        }

        else
        {
            //Response.Redirect("login.aspx");
            Response.Write("<script>window.parent.location=\"login.aspx\";</script>");
            return;

        }
        

        formname = "ProductSubCategory";

        DataSet ds = new DataSet();
        ds.ReadXml(Server.MapPath("XML/button.xml"));
        btnNew.ImageUrl = ds.Tables[0].Rows[0].ItemArray[0].ToString();
        btnSave.ImageUrl = ds.Tables[0].Rows[0].ItemArray[1].ToString();
        btnModify.ImageUrl = ds.Tables[0].Rows[0].ItemArray[2].ToString();
        btnQuery.ImageUrl = ds.Tables[0].Rows[0].ItemArray[3].ToString();
        btnExecute.ImageUrl = ds.Tables[0].Rows[0].ItemArray[4].ToString();
        btnCancel.ImageUrl = ds.Tables[0].Rows[0].ItemArray[5].ToString();
        btnfirst.ImageUrl = ds.Tables[0].Rows[0].ItemArray[6].ToString();
        btnprevious.ImageUrl = ds.Tables[0].Rows[0].ItemArray[7].ToString();
        btnnext.ImageUrl = ds.Tables[0].Rows[0].ItemArray[8].ToString();
        btnlast.ImageUrl = ds.Tables[0].Rows[0].ItemArray[9].ToString();
        btnDelete.ImageUrl = ds.Tables[0].Rows[0].ItemArray[10].ToString();
        btnExit.ImageUrl = ds.Tables[0].Rows[0].ItemArray[11].ToString();

        DataSet ds1 = new DataSet();
        ds1.ReadXml(Server.MapPath("XML/productsubcategory.xml"));
        lbproductdescription.Text = ds1.Tables[0].Rows[0].ItemArray[0].ToString();
        lbprosubcode.Text = ds1.Tables[0].Rows[0].ItemArray[1].ToString();
        lbsubprodes.Text = ds1.Tables[0].Rows[0].ItemArray[2].ToString();
        lbsubalias.Text = ds1.Tables[0].Rows[0].ItemArray[3].ToString();

        

        mandatory();
        btnNew.Focus();

        hiddenauto.Value = Session["autogenerated"].ToString();

        //if (Session["autogenerated"].ToString() == "1")
        //{

        //    txtprosubcode .Enabled = false;

        //}
        
        Ajax.Utility.RegisterTypeForAjax(typeof(ProductSubCategory));
           
        hiddenusername.Value = Session["Username"].ToString();

        if (!Page.IsPostBack)
        {
            bindproduct();
            getbuttoncheck(formname);
            drpproduct.Enabled = false;
            txtprosubcode.Enabled = false;
            txtprosubname.Enabled = false;
            txtalias.Enabled = false;
          //  btnNew.Attributes.Add("OnClick", "javascript:return newclick();");
            btnSave.Attributes.Add("onclick", "javascript:return saveproductsubcode();");
            btnExit.Attributes.Add("ONClick", "javascript:return exitclick();");
            txtprosubname.Attributes.Add("onchange", "javascript:return autoornot();");
            btnQuery.Attributes.Add("OnClick", "javascript:return chkquery();");
            btnDelete.Attributes.Add("onclick", "return confirm ('Are you sure you wish to delete this?')");

           // btnQuery.Attributes.Add("OnClick", "javascript:return chkquery1();");

        
        }
        if (btnNew.Enabled == false)
            btnNew.ImageUrl = ds.Tables[1].Rows[0].ItemArray[0].ToString();
        if (btnSave.Enabled == false)
            btnSave.ImageUrl = ds.Tables[1].Rows[0].ItemArray[1].ToString();
        if (btnModify.Enabled == false)
            btnModify.ImageUrl = ds.Tables[1].Rows[0].ItemArray[2].ToString();
        if (btnQuery.Enabled == false)
            btnQuery.ImageUrl = ds.Tables[1].Rows[0].ItemArray[3].ToString();
        if (btnExecute.Enabled == false)
            btnExecute.ImageUrl = ds.Tables[1].Rows[0].ItemArray[4].ToString();
        if (btnCancel.Enabled == false)
            btnCancel.ImageUrl = ds.Tables[1].Rows[0].ItemArray[5].ToString();
        if (btnfirst.Enabled == false)
            btnfirst.ImageUrl = ds.Tables[1].Rows[0].ItemArray[6].ToString();
        if (btnprevious.Enabled == false)
            btnprevious.ImageUrl = ds.Tables[1].Rows[0].ItemArray[7].ToString();
        if (btnnext.Enabled == false)
            btnnext.ImageUrl = ds.Tables[1].Rows[0].ItemArray[8].ToString();
        if (btnlast.Enabled == false)
            btnlast.ImageUrl = ds.Tables[1].Rows[0].ItemArray[9].ToString();
        if (btnDelete.Enabled == false)
            btnDelete.ImageUrl = ds.Tables[1].Rows[0].ItemArray[10].ToString();
        if (btnExit.Enabled == false)
            btnExit.ImageUrl = ds.Tables[1].Rows[0].ItemArray[11].ToString();

    }

    public void bindproduct()
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.productsubcategory bind = new NewAdbooking.Classes.productsubcategory();

            ds = bind.productdes(hiddencompcode.Value);
        }
        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.productsubcategory bind = new NewAdbooking.classesoracle.productsubcategory();

                ds = bind.productdes(hiddencompcode.Value);
            }
            else
            {
                NewAdbooking.classmysql.productsubcategory bind = new NewAdbooking.classmysql.productsubcategory();

                ds = bind.productdes(hiddencompcode.Value);

            }

            ListItem li = new ListItem();
            li.Text = "--Select Product--";
            li.Value = "0";
            li.Selected = true;
            drpproduct.Items.Add(li);

            int x;

            for (x = 0; x < ds.Tables[0].Rows.Count; x++)
            {
                ListItem li1 = new ListItem();
                li1.Text = ds.Tables[0].Rows[x].ItemArray[1].ToString();
                li1.Value = ds.Tables[0].Rows[x].ItemArray[0].ToString();
                drpproduct.Items.Add(li1);

            }
       
        
    
    }



    protected void btnNew_Click1(object sender, EventArgs e)
    {
        pnew.Value  = "1";

        txtprosubcode .Text = "";
        txtprosubname .Text = "";
        txtalias .Text = "";
        drpproduct.SelectedValue = "0";

       // hiddenauto.Value = "1";

        saveormodify = "0";

        if (hiddenauto.Value == "1")
        {
            txtprosubcode .Enabled = false;   //autogenrate
            
        }
        else
        {
            txtprosubcode.Enabled = true;   //userdefined
        }
        drpproduct.Enabled = true;
        txtalias.Enabled = true;
        txtprosubname.Enabled = true;

        ScriptManager.RegisterClientScriptBlock(this, typeof(ProductSubCategory), "ss", "focus()", true);

        chkstatus(FlagStatus);
        btnSave.Enabled = true;
        btnNew.Enabled = false;
        btnQuery.Enabled = false;
        btnimage();

    }
    protected void btnSave_Click(object sender, EventArgs e)
    {
        pnew.Value = "0";
         string prosubcode = txtprosubcode.Text.Trim();
        string prosubname = txtprosubname .Text.Trim();
        string proalias = txtalias .Text.Trim();
        string drpprosub = drpproduct.SelectedValue;

        if (saveormodify == "0")
        {
            DataSet ds = new DataSet();
            if (ConfigurationSettings.AppSettings["connectionType"].ToString() == "sql")
            {
                NewAdbooking.Classes.productsubcategory getcode = new NewAdbooking.Classes.productsubcategory();

                ds = getcode.chkcode(prosubcode, Session["compcode"].ToString());
            }

            else
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                {
                    NewAdbooking.classesoracle.productsubcategory getcode = new NewAdbooking.classesoracle.productsubcategory();

                    ds = getcode.chkcode(prosubcode, Session["compcode"].ToString());

                }
                else
                {
                    NewAdbooking.classmysql.productsubcategory getcode = new NewAdbooking.classmysql.productsubcategory();

                    ds = getcode.chkcode(prosubcode, Session["compcode"].ToString());


                }
            if (ds.Tables[0].Rows.Count > 0)
            {
                message = "This Product Code Has Already Assigned";
                AspNetMessageBox(message);
                
                return;
            }

                if (ds.Tables[0].Rows.Count < 0)
                {
                    message = "Please Enter The Product Code of " + prosubname + " ";
                    //message = "This Product Name Has Already Assigned";
                    AspNetMessageBox(message);
                    return;

                }
                else
                {
                    DataSet di = new DataSet();
                    if(ConfigurationSettings.AppSettings ["ConnectionType"].ToString ()=="sql")
                    {
                    NewAdbooking.Classes.productsubcategory insertthe = new NewAdbooking.Classes.productsubcategory();
                    
                    di = insertthe.insertedvalue(drpprosub, prosubcode, prosubname, proalias, Session["compcode"].ToString(), Session["userid"].ToString());
                    }
                    else
                        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                        {
                            NewAdbooking.classesoracle.productsubcategory insertthe = new NewAdbooking.classesoracle.productsubcategory();
                    
                    di = insertthe.insertedvalue(drpprosub, prosubcode, prosubname, proalias, Session["compcode"].ToString(), Session["userid"].ToString());
  
                        }
                        else
                        {
                            NewAdbooking.classmysql.productsubcategory insertthe = new NewAdbooking.classmysql.productsubcategory();

                            di = insertthe.insertedvalue(drpprosub, prosubcode, prosubname, proalias, Session["compcode"].ToString(), Session["userid"].ToString());
  
                        }

                    getbuttoncheck(formname);
                    //message = "Value Saved Sucessfully ";
                    //AspNetMessageBox(message);
                    DataSet ds1 = new DataSet();
                    ds1.ReadXml(Server.MapPath("XML/errorMessage.xml"));
                    message = ds1.Tables[0].Rows[0].ItemArray[0].ToString();
                    AspNetMessageBox(message);

                    txtalias.Text = "";
                    txtprosubname.Text = "";
                    txtprosubcode.Text = "";
                    drpproduct.SelectedValue = "0";


                    txtprosubcode.Enabled = false;
                    txtprosubname.Enabled = false;
                    txtalias.Enabled = false;
                    drpproduct.Enabled = false;
                    btnimage();
                    return;


                }
           
          

        }
        //for modify
        else
        {
            DataSet du = new DataSet();
            if (ConfigurationSettings.AppSettings["connectionType"].ToString() == "sql")
            {
                NewAdbooking.Classes.productsubcategory upadte1 = new NewAdbooking.Classes.productsubcategory();

                du = upadte1.updatepro(drpprosub, prosubcode, prosubname, proalias, Session["compcode"].ToString());
            }
            else
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                {
                    NewAdbooking.classesoracle.productsubcategory upadte1 = new NewAdbooking.classesoracle.productsubcategory();

                du = upadte1.updatepro(drpprosub, prosubcode, prosubname, proalias, Session["compcode"].ToString());
 
                }
                else
                {
                    NewAdbooking.classmysql.productsubcategory upadte1 = new NewAdbooking.classmysql.productsubcategory();

                du = upadte1.updatepro(drpprosub, prosubcode, prosubname, proalias, Session["compcode"].ToString());
 
                }

                txtalias.Enabled = false;
                txtprosubname.Enabled = false;
                txtprosubcode.Enabled = false;

                executesubpro.Tables[0].Rows[fpnl].ItemArray[0] = drpproduct.SelectedValue;
                executesubpro.Tables[0].Rows[fpnl].ItemArray[1] = txtprosubcode.Text;
                executesubpro.Tables[0].Rows[fpnl].ItemArray[2] = txtprosubname.Text;
                executesubpro.Tables[0].Rows[fpnl].ItemArray[3] = txtalias.Text;
                DataSet ds = new DataSet();

            if(ConfigurationSettings.AppSettings["connectionType"].ToString() == "sql")
            {
                                NewAdbooking.Classes.productsubcategory execute = new NewAdbooking.Classes.productsubcategory();
                executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());

            }
            else
                if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
                {
                    NewAdbooking.classesoracle.productsubcategory execute = new NewAdbooking.classesoracle.productsubcategory();
                executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());

                }
                else
                {
                    NewAdbooking.classmysql.productsubcategory execute = new NewAdbooking.classmysql.productsubcategory();
                executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());

                }
              
                ds = executesubpro;

                drpproduct.SelectedValue = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
                txtprosubcode.Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
                txtprosubname.Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
                txtalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[3].ToString();


                updateStatus();
               
                DataSet ds2 = new DataSet();
                ds2.ReadXml(Server.MapPath("XML/errorMessage.xml"));
                message = ds2.Tables[0].Rows[0].ItemArray[1].ToString();
                AspNetMessageBox(message);

                if (fpnl == 0)
                {
                    btnfirst.Enabled = false;
                    btnprevious.Enabled = false;
                }
                if (fpnl == executesubpro.Tables[0].Rows.Count - 1)
                {
                    btnlast.Enabled = false;
                    btnnext.Enabled = false;
                }


                btnimage();
                return;
            
          

        }
    }
    protected void btnModify_Click(object sender, EventArgs e)
    {
        pnew.Value = "0";
        txtprosubcode .Enabled = false;
        txtprosubname .Enabled = true;
        txtalias .Enabled = true;
        drpproduct.Enabled = true;

        saveormodify = "1";
        chkstatus(FlagStatus);
        chkstatus(FlagStatus);
        btnSave.Enabled = true;
        btnQuery.Enabled = false;
        btnimage();
    }
    protected void btnQuery_Click1(object sender, EventArgs e)
    {
        pnew.Value="0";
        fpnl = 0;
        txtprosubcode .Text = "";
        txtprosubname .Text = "";
        txtalias .Text = "";
        drpproduct.SelectedValue = "0";

        txtalias.Enabled = true;
        txtprosubcode.Enabled = true;
        txtprosubname.Enabled = true;
        drpproduct.Enabled = true;

             
        chkstatus(FlagStatus);


        btnQuery.Enabled = false;
        btnExecute.Enabled = true;
        btnSave.Enabled = false;
        btnimage();
        btnExecute.Focus();
    }
    protected void btnExecute_Click(object sender, EventArgs e)
    {
        pnew.Value = "0";
        //hiddenauto.Value = Session["query"].ToString();
         string prosubcode = txtprosubcode .Text;
         exesubcode = prosubcode;
         string prosubname = txtprosubname.Text;
         exesubname = prosubname;
         string prosubalias = txtalias.Text;
         exesubalias = prosubalias;
         string drpprosub = drpproduct.SelectedValue;
         exeprosubdes = drpprosub;
         if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
         {

             NewAdbooking.Classes.productsubcategory execute = new NewAdbooking.Classes.productsubcategory();
             executesubpro = execute.prosubexecute(drpprosub, prosubcode, prosubname, prosubalias, Session["compcode"].ToString());
         }
         else
             if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
             {
                 NewAdbooking.classesoracle.productsubcategory execute = new NewAdbooking.classesoracle.productsubcategory();
                 executesubpro = execute.prosubexecute(drpprosub, prosubcode, prosubname, prosubalias, Session["compcode"].ToString());
 
             }
             else
             {
                 NewAdbooking.classmysql.productsubcategory execute = new NewAdbooking.classmysql.productsubcategory();
                 executesubpro = execute.prosubexecute(drpprosub, prosubcode, prosubname, prosubalias, Session["compcode"].ToString());

             }

             if (executesubpro.Tables[0].Rows.Count == 0)
             {
                 message = "Your Search Criteria Does Not Exist";
                 AspNetMessageBox(message);

                 //   chkstatus(FlagStatus);
                 updateStatus();
                 getbuttoncheck(formname);
                 drpproduct.SelectedValue = "0";
                 txtalias.Text = "";
                 txtprosubcode.Text = "";
                 txtprosubname.Text = "";
                 btnimage();
                 return;

                

             }

             else
             {
                 if (drpproduct.Items.FindByValue(executesubpro.Tables[0].Rows[0].ItemArray[0].ToString()) != null)
                     drpproduct.SelectedValue = executesubpro.Tables[0].Rows[0].ItemArray[0].ToString();
                 else
                     drpproduct.SelectedValue = null;
                 txtprosubcode.Text = executesubpro.Tables[0].Rows[0].ItemArray[1].ToString();
                 txtprosubname.Text = executesubpro.Tables[0].Rows[0].ItemArray[2].ToString();
                 txtalias.Text = executesubpro.Tables[0].Rows[0].ItemArray[3].ToString();

                 drpproduct.Enabled = false;
                 txtprosubcode.Enabled = false;
                 txtprosubname.Enabled = false;
                 txtalias.Enabled = false;

                 //message = "Your Search Criteria Does Not Exit";
                 //AspNetMessageBox(message);
             }

             updateStatus();
             btnfirst.Enabled = false;
             btnprevious.Enabled = false;

             if (executesubpro.Tables[0].Rows.Count == 1)
             {
                 btnfirst.Enabled = false;
                 btnlast.Enabled = false;
                 btnprevious.Enabled = false;
                 btnnext.Enabled = false;
             }


             btnimage();
             // updateStatus();
     
       

    }
    protected void btnCancel_Click1(object sender, EventArgs e)
    {
        pnew.Value = "0";
        txtalias.Text = "";
        txtprosubcode .Text = "";
        txtprosubname .Text = "";
        drpproduct.SelectedValue = "0";
        hiddenauto.Value = "";

        chkstatus(FlagStatus);

        getbuttoncheck(formname);
        //btnNew.Enabled = false;
        //btnQuery.Enabled = true;
        //btnCancel.Enabled = true;
        //btnExit.Enabled = true;

        btnSave.Enabled = false;
        txtalias.Enabled = false;
        txtprosubname.Enabled = false;
        txtprosubcode.Enabled = false;
        btnNew.Focus();
        ScriptManager.RegisterClientScriptBlock(this, typeof(ProductSubCategory), "dd", "document.getElementById('btnNew').focus();", true);
        btnimage();

    }
    protected void btnfirst_Click(object sender, EventArgs e)
    {
        fpnl = 0;

        DataSet ds = new DataSet();
        ds = executesubpro;

        drpproduct.SelectedValue = ds.Tables[0].Rows[0].ItemArray[0].ToString();
        txtprosubcode .Text = ds.Tables[0].Rows[0].ItemArray[1].ToString();
        txtprosubname .Text = ds.Tables[0].Rows[0].ItemArray[2].ToString();
        txtalias .Text = ds.Tables[0].Rows[0].ItemArray[3].ToString();
        

        updateStatus();

        btnfirst.Enabled = false;
        btnprevious.Enabled = false;
        btnimage();
    }
    protected void btnprevious_Click(object sender, EventArgs e)
    {
        DataSet ds = new DataSet();
        ds = executesubpro;

        // fpnl--;
        int count = ds.Tables[0].Rows.Count - 1;

        fpnl--;

        if (fpnl != -1)
        {
            if (fpnl >= 0 || fpnl <= count)
            {

                drpproduct.SelectedValue  = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
                txtprosubcode .Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
                txtprosubname .Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
                txtalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[3].ToString();

                updateStatus();

                btnfirst.Enabled = true;
                btnlast.Enabled = true;
                btnprevious.Enabled = true;
                btnnext.Enabled = true;
            }
            else
            {
                btnnext.Enabled = true;
                btnlast.Enabled = true;
                btnfirst.Enabled = false;
                btnprevious.Enabled = false;

            }
        }
        else
        {
            btnnext.Enabled = true;
            btnlast.Enabled = true;
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;

        }
        if (fpnl == 0)
        {
            btnfirst.Enabled = false;
            btnprevious.Enabled = false;
            btnnext.Enabled = true;
            btnlast.Enabled = true;

        }

        btnimage();
    }
    protected void btnnext_Click(object sender, EventArgs e)
    {
        DataSet ds = new DataSet();
        ds = executesubpro;
        int count = ds.Tables[0].Rows.Count - 1;
        fpnl++;


        if (fpnl != -1 && fpnl >= 0)
        {
            if (fpnl <= count)
            {
                drpproduct .SelectedValue  = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
                txtprosubcode .Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
                txtprosubname .Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
                txtalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[3].ToString();

                btnfirst.Enabled = true;
                btnprevious.Enabled = true;

            }

            else
            {
                btnnext.Enabled = false;
                btnlast.Enabled = false;
                btnfirst.Enabled = true;
                btnprevious.Enabled = true;

            }
        }
        else
        {
            btnnext.Enabled = false;
            btnlast.Enabled = false;
            btnfirst.Enabled = true;
            btnprevious.Enabled = true;

        }
        if (fpnl == count)
        {
            btnnext.Enabled = false;
            btnlast.Enabled = false;
            btnfirst.Enabled = true;
            btnprevious.Enabled = true;

        }
        btnimage();
    }
    protected void btnlast_Click(object sender, EventArgs e)
    {
        DataSet ds = new DataSet();
        ds = executesubpro;
        int count = ds.Tables[0].Rows.Count;
        fpnl = count - 1;


        drpproduct.Text = ds.Tables[0].Rows[fpnl].ItemArray[0].ToString();
        txtprosubcode .Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
        txtprosubname .Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
        txtalias .Text = ds.Tables[0].Rows[fpnl].ItemArray[3].ToString();

        updateStatus();

        btnfirst.Enabled = true;
        btnprevious.Enabled = true;
        btnlast.Enabled = false;
        btnnext.Enabled = false;
        btnimage();
    }
    protected void btnDelete_Click(object sender, EventArgs e)
    {
        string prosubcode = txtprosubcode.Text;

        DataSet ds1 = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.productsubcategory del = new NewAdbooking.Classes.productsubcategory();


            ds1 = del.deleteproduct(prosubcode, Session["compcode"].ToString());

            NewAdbooking.Classes.productsubcategory execute = new NewAdbooking.Classes.productsubcategory();
            executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());//, Session["userid"].ToString());
        }
        else
            if(ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                            NewAdbooking.classesoracle .productsubcategory del = new NewAdbooking.classesoracle.productsubcategory();


            ds1 = del.deleteproduct(prosubcode, Session["compcode"].ToString());

            NewAdbooking.classesoracle.productsubcategory execute = new NewAdbooking.classesoracle.productsubcategory();
            executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());//, Session["userid"].ToString());
 
            }
            else
            {
                            NewAdbooking.classmysql .productsubcategory del = new NewAdbooking.classmysql.productsubcategory();


            ds1 = del.deleteproduct(prosubcode, Session["compcode"].ToString());

            NewAdbooking.classmysql.productsubcategory execute = new NewAdbooking.classmysql.productsubcategory();
            executesubpro = execute.prosubexecute(exeprosubdes, exesubcode, exesubname, exesubalias, Session["compcode"].ToString());//, Session["userid"].ToString());
 
            }

            int a = executesubpro.Tables[0].Rows.Count;
            if (a <= 0)
            {
                message = "There is no data";
                AspNetMessageBox(message);
                updateStatus();
                getbuttoncheck(formname);
                drpproduct.SelectedValue = "0";
                txtalias.Text = "";
                txtprosubcode.Text = "";
                txtprosubname.Text = "";
                btnimage();
                return;

            }
            else if (fpnl == -1 || fpnl >= a)
            {
                DataSet ds = new DataSet();

                ds = executesubpro;
                drpproduct.SelectedValue = ds.Tables[0].Rows[0].ItemArray[0].ToString();
                txtprosubcode.Text = ds.Tables[0].Rows[0].ItemArray[1].ToString();
                txtprosubname.Text = ds.Tables[0].Rows[0].ItemArray[2].ToString();
                txtalias.Text = ds.Tables[0].Rows[0].ItemArray[3].ToString();
            }

            else
            {
                DataSet ds = new DataSet();
                ds = executesubpro;
                drpproduct.SelectedValue = ds.Tables[0].Rows[0].ItemArray[0].ToString();
                txtprosubcode.Text = ds.Tables[0].Rows[fpnl].ItemArray[1].ToString();
                txtprosubname.Text = ds.Tables[0].Rows[fpnl].ItemArray[2].ToString();
                txtalias.Text = ds.Tables[0].Rows[fpnl].ItemArray[3].ToString();
            }
            DataSet ds3 = new DataSet();
            ds3.ReadXml(Server.MapPath("XML/errorMessage.xml"));
            message = ds3.Tables[0].Rows[0].ItemArray[2].ToString();
            AspNetMessageBox(message);
            btnimage();
        }
       
      
    
    protected void btnExit_Click(object sender, EventArgs e)
    {

    }
    public void getbuttoncheck(string formname)
    {
        DataSet butt = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.classlibraryforbutton getpermission = new NewAdbooking.Classes.classlibraryforbutton();

            butt = getpermission.getbuttonpermission(Session["compcode"].ToString(), Session["userid"].ToString(), formname);
        }
        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.classlibraryforbutton getpermission = new NewAdbooking.classesoracle.classlibraryforbutton();

                butt = getpermission.getbuttonpermission(Session["compcode"].ToString(), Session["userid"].ToString(), formname);


                }
        else
        {
            NewAdbooking.classmysql.classlibraryforbutton getpermission = new NewAdbooking.classmysql.classlibraryforbutton();

            butt = getpermission.getbuttonpermission(Session["compcode"].ToString(), Session["userid"].ToString(), formname);

        }


            string id = butt.Tables[0].Rows[0].ItemArray[0].ToString();


            if (id != "0")
            {
                //var id = ds.Tables[0].Rows[0].button_id;



                if (id == "0" || id == "8")
                {

                    FlagStatus = 0;

                    btnNew.Enabled = false;
                    btnQuery.Enabled = false;
                    btnExecute.Enabled = false;
                    btnCancel.Enabled = false;
                    btnExit.Enabled = false;
                    btnDelete.Enabled = false;
                    btnModify.Enabled = false;

                    btnSave.Enabled = false;
                    btnModify.Enabled = false;
                    btnfirst.Enabled = false;
                    btnnext.Enabled = false;
                    btnprevious.Enabled = false;
                    btnlast.Enabled = false;



                    //window.location.href = 'EnterPage.aspx';
                    //alert("You Are Not Authorised To See This Form");
                    //FlagStatus = 0;


                }
                if (id == "1" || id == "9")
                {
                    btnNew.Enabled = true;
                    btnQuery.Enabled = false;
                    btnCancel.Enabled = true;
                    btnExit.Enabled = true;
                    btnDelete.Enabled = false;
                    btnExecute.Enabled = false;

                    btnSave.Enabled = false;
                    btnModify.Enabled = false;
                    btnfirst.Enabled = false;
                    btnnext.Enabled = false;
                    btnprevious.Enabled = false;
                    btnlast.Enabled = false;
                    FlagStatus = 1;

                }
                if (id == "2" || id == "10")
                {

                    btnNew.Enabled = false;
                    btnExecute.Enabled = false;
                    btnQuery.Enabled = true;
                    btnCancel.Enabled = true;
                    btnExit.Enabled = true;
                    btnDelete.Enabled = false;
                    //a//btnModify.Enabled = true;
                    btnModify.Enabled = false;

                    btnSave.Enabled = false;
                    //a// btnfirst.Enabled = true;
                    btnfirst.Enabled = false;
                    btnnext.Enabled = false;
                    btnprevious.Enabled = false;
                    btnlast.Enabled = false;
                    btnExit.Enabled = true;
                    FlagStatus = 2;


                }
                if (id == "3" || id == "11")
                {
                    btnNew.Enabled = true;
                    btnQuery.Enabled = true;
                    btnExecute.Enabled = false;
                    btnDelete.Enabled = false;
                    btnModify.Enabled = false;
                    btnCancel.Enabled = true;
                    btnExit.Enabled = true;
                    btnDelete.Enabled = false;


                    btnSave.Enabled = false;
                    btnfirst.Enabled = false;
                    btnnext.Enabled = false;
                    btnprevious.Enabled = false;
                    btnlast.Enabled = false;

                    FlagStatus = 3;



                }
                if (id == "4" || id == "12")
                {
                    btnNew.Enabled = false;
                    btnQuery.Enabled = true;
                    btnCancel.Enabled = true;
                    btnExit.Enabled = true;
                    btnDelete.Enabled = false;
                    btnfirst.Enabled = false;
                    btnnext.Enabled = false;
                    btnprevious.Enabled = false;
                    btnlast.Enabled = false;
                    btnExecute.Enabled = false;

                    btnNew.Enabled = false;
                    btnExecute.Enabled = false;
                    btnDelete.Enabled = false;
                    btnCancel.Enabled = true;
                    btnExit.Enabled = true;


                    btnModify.Enabled = false;

                    btnSave.Enabled = false;
                    btnfirst.Enabled = false;
                    btnnext.Enabled = false;
                    btnprevious.Enabled = false;
                    btnlast.Enabled = false;
                    FlagStatus = 4;



                }
                if (id == "5" || id == "13")
                {
                    btnNew.Enabled = true;
                    btnSave.Enabled = false;
                    btnQuery.Enabled = true;
                    btnCancel.Enabled = true;
                    btnExit.Enabled = true;
                    btnDelete.Enabled = false;
                    btnfirst.Enabled = false;
                    btnnext.Enabled = false;
                    btnprevious.Enabled = false;
                    btnlast.Enabled = false;
                    btnExecute.Enabled = false;
                    btnModify.Enabled = false;
                    FlagStatus = 5;


                }
                if (id == "6" || id == "14")
                {
                    btnNew.Enabled = false;
                    btnSave.Enabled = false;
                    btnQuery.Enabled = true;
                    btnModify.Enabled = false;
                    btnCancel.Enabled = true;
                    btnExit.Enabled = true;
                    btnDelete.Enabled = false;
                    btnfirst.Enabled = false;
                    btnnext.Enabled = false;
                    btnprevious.Enabled = false;
                    btnlast.Enabled = false;
                    btnExecute.Enabled = false;

                    FlagStatus = 6;
                }
                if (id == "7" || id == "15")
                {
                    btnNew.Enabled = true;
                    btnSave.Enabled = false;
                    btnQuery.Enabled = true;
                    btnModify.Enabled = false;
                    btnCancel.Enabled = true;
                    btnExit.Enabled = true;
                    btnDelete.Enabled = false;
                    btnfirst.Enabled = false;
                    btnnext.Enabled = false;
                    btnprevious.Enabled = false;
                    btnlast.Enabled = false;
                    btnExecute.Enabled = false;
                    FlagStatus = 7;

                }
            }
      
        



    }

    public void chkstatus(int FlagStatus)
    {
        if (FlagStatus == 0 || FlagStatus == 8)
        {
            btnNew.Enabled = false;
            btnQuery.Enabled = false;
            btnDelete.Enabled = false;
            btnSave.Enabled = false;
            btnExecute.Enabled = false;
            btnCancel.Enabled = false;
            btnModify.Enabled = false;

            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
            btnExit.Enabled = false;



        }
        if (FlagStatus == 1 || FlagStatus == 9)
        {
            btnNew.Enabled = false;
            btnQuery.Enabled = false;
            btnDelete.Enabled = false;
            btnSave.Enabled = true;
            btnExecute.Enabled = false;
            btnCancel.Enabled = true;
            btnModify.Enabled = false;

            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
            btnExit.Enabled = true;

        }
        if (FlagStatus == 2 || FlagStatus == 10)
        {
            btnExecute.Enabled = true;
            btnQuery.Enabled = false;
            btnDelete.Enabled = false;
            btnNew.Enabled = false;
            btnCancel.Enabled = true;
            btnExecute.Enabled = false;
            btnModify.Enabled = false;
            btnExit.Enabled = true;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
            btnExit.Enabled = true;


        }

        if (FlagStatus == 3 || FlagStatus == 11)
        {
            btnNew.Enabled = false;
            btnQuery.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = true;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }

        if (FlagStatus == 4 || FlagStatus == 12)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
        if (FlagStatus == 5 || FlagStatus == 13)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
        if (FlagStatus == 6 || FlagStatus == 14)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = false;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }
        if (FlagStatus == 7 || FlagStatus == 15)
        {
            btnNew.Enabled = false;
            btnExecute.Enabled = false;
            btnDelete.Enabled = false;
            btnCancel.Enabled = true;
            btnExit.Enabled = true;


            btnModify.Enabled = false;

            btnSave.Enabled = true;
            btnfirst.Enabled = false;
            btnnext.Enabled = false;
            btnprevious.Enabled = false;
            btnlast.Enabled = false;
        }


    }

    public void updateStatus()
    {
        chkstatus(FlagStatus);
        if (FlagStatus == 2 || FlagStatus == 3)
        {
            btnQuery.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnModify.Enabled = true;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;
            btnDelete.Enabled = false;
        }
        if (FlagStatus == 4)
        {
            btnDelete.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnQuery.Enabled = true;
            btnModify.Enabled = false;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;

        }
        if (FlagStatus == 5)
        {
            btnDelete.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnQuery.Enabled = true;
            btnModify.Enabled = false;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;

        }
        if (FlagStatus == 6 || FlagStatus == 7)
        {
            btnDelete.Enabled = true;
            btnExecute.Enabled = false;
            btnSave.Enabled = false;
            btnQuery.Enabled = true;
            btnModify.Enabled = true;
            btnfirst.Enabled = true;
            btnnext.Enabled = true;
            btnprevious.Enabled = true;
            btnlast.Enabled = true;

        }
    }

    protected void AspNetMessageBox(string strMessage)
    {
        //strMessage = adminResource.GetStringFromResource(strMessage);
        string strAlert = "";
        strAlert = "alert('" + strMessage + "')";
        ScriptManager.RegisterClientScriptBlock(this, typeof(ProductSubCategory), "ShowAlert", strAlert, true);
    }

    [Ajax.AjaxMethod]

    public DataSet adchkadvcode(string str,string procode)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.productsubcategory auto = new NewAdbooking.Classes.productsubcategory();

            ds = auto.autocode(str);
            return ds;
        }
        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.productsubcategory auto = new NewAdbooking.classesoracle.productsubcategory();

                ds = auto.autocode(str,procode);
                return ds;
            }
        else
        {
            NewAdbooking.classmysql.productsubcategory auto = new NewAdbooking.classmysql.productsubcategory();
            ds = auto.autocode(str);
            return ds;
        }


    }

    private void mandatory()
    {
        if (lbproductdescription .Text.IndexOf("*") >= 0)
        {
            hiddendrpproduct.Value = "1";
        }
        else
        {
            hiddendrpproduct.Value = "0";
        }
        if (lbsubprodes .Text.IndexOf("*") >= 0)
        {
            hiddensubproname .Value = "1";
        }
        else
        {
            hiddensubproname.Value = "0";
        }
        if (lbprosubcode .Text.IndexOf("*") >= 0)
        {
            hiddensubprocode .Value = "1";
        }
        else
        {
            hiddensubprocode.Value = "0";
        }
        if (lbsubalias .Text.IndexOf("*") >= 0)
        {
            hiddensubproalias .Value = "1";
        }
        else
        {
            hiddensubproalias.Value = "0";
        }
        //if (Product.Text.IndexOf("*") >= 0)
        //{
        //    hiddenproduct.Value = "1";
        //}
        //else
        //{
        //    hiddenproduct.Value = "0";
        //}
        //if (Representative.Text.IndexOf("*") >= 0)
        //{
        //    hiddenrep.Value = "1";
        //}
        //else
        //{
        //    hiddenrep.Value = "0";
        //}
        //if (validfrom.Text.IndexOf("*") >= 0)
        //{
        //    hiddenvalidfrom.Value = "1";
        //}
        //else
        //{
        //    hiddenvalidfrom.Value = "0";
        //}
        //if (txttilldate.Text.IndexOf("*") >= 0)
        //{
        //    hiddento.Value = "1";
        //}
        //else
        //{
        //    hiddento.Value = "0";
        //}
    }
    protected void drpproduct_SelectedIndexChanged(object sender, EventArgs e)
    {

    }
    public void btnimage()
    {
        DataSet ds = new DataSet();
        ds.ReadXml(Server.MapPath("XML/button.xml"));
        if (btnNew.Enabled == false)
            btnNew.ImageUrl = ds.Tables[1].Rows[0].ItemArray[0].ToString();
        else
            btnNew.ImageUrl = ds.Tables[0].Rows[0].ItemArray[0].ToString();
        if (btnSave.Enabled == false)
            btnSave.ImageUrl = ds.Tables[1].Rows[0].ItemArray[1].ToString();
        else
            btnSave.ImageUrl = ds.Tables[0].Rows[0].ItemArray[1].ToString();
        if (btnModify.Enabled == false)
            btnModify.ImageUrl = ds.Tables[1].Rows[0].ItemArray[2].ToString();
        else
            btnModify.ImageUrl = ds.Tables[0].Rows[0].ItemArray[2].ToString();
        if (btnQuery.Enabled == false)
            btnQuery.ImageUrl = ds.Tables[1].Rows[0].ItemArray[3].ToString();
        else
            btnQuery.ImageUrl = ds.Tables[0].Rows[0].ItemArray[3].ToString();
        if (btnExecute.Enabled == false)
            btnExecute.ImageUrl = ds.Tables[1].Rows[0].ItemArray[4].ToString();
        else
            btnExecute.ImageUrl = ds.Tables[0].Rows[0].ItemArray[4].ToString();
        if (btnCancel.Enabled == false)
            btnCancel.ImageUrl = ds.Tables[1].Rows[0].ItemArray[5].ToString();
        else
            btnCancel.ImageUrl = ds.Tables[0].Rows[0].ItemArray[5].ToString();
        if (btnfirst.Enabled == false)
            btnfirst.ImageUrl = ds.Tables[1].Rows[0].ItemArray[6].ToString();
        else
            btnfirst.ImageUrl = ds.Tables[0].Rows[0].ItemArray[6].ToString();
        if (btnprevious.Enabled == false)
            btnprevious.ImageUrl = ds.Tables[1].Rows[0].ItemArray[7].ToString();
        else
            btnprevious.ImageUrl = ds.Tables[0].Rows[0].ItemArray[7].ToString();
        if (btnnext.Enabled == false)
            btnnext.ImageUrl = ds.Tables[1].Rows[0].ItemArray[8].ToString();
        else
            btnnext.ImageUrl = ds.Tables[0].Rows[0].ItemArray[8].ToString();
        if (btnlast.Enabled == false)
            btnlast.ImageUrl = ds.Tables[1].Rows[0].ItemArray[9].ToString();
        else
            btnlast.ImageUrl = ds.Tables[0].Rows[0].ItemArray[9].ToString();
        if (btnDelete.Enabled == false)
            btnDelete.ImageUrl = ds.Tables[1].Rows[0].ItemArray[10].ToString();
        else
            btnDelete.ImageUrl = ds.Tables[0].Rows[0].ItemArray[10].ToString();
        if (btnExit.Enabled == false)
            btnExit.ImageUrl = ds.Tables[1].Rows[0].ItemArray[11].ToString();
        else
            btnExit.ImageUrl = ds.Tables[0].Rows[0].ItemArray[11].ToString();
    }
}
