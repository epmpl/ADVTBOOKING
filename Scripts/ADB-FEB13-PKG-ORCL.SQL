\\\\\\\\\\\\\\\\9789 issue no.///////////

CREATE OR REPLACE PACKAGE HT18JULY.Currbindpreferpgld
IS
   TYPE t_account_cursor IS REF CURSOR;

   PROCEDURE currbindpreferpgld_p (
      compcode     IN       VARCHAR2,
      p_accounts   OUT      t_account_cursor
   );
END Currbindpreferpgld;
/







CREATE OR REPLACE PACKAGE BODY HT18JULY.currbindpreferpgld
IS
   PROCEDURE currbindpreferpgld_p (
      compcode     IN       VARCHAR2,
      p_accounts   OUT      t_account_cursor
   )
   AS
   BEGIN
      OPEN p_accounts FOR
         SELECT "date_format", "autogenerated", "currency_code",
                "rate_gr_code", "solo", "breakup", "blackwhitecode",
                "rostatus", "File_name", "Tfn", "Insert_breakup", "prefix",
                "suffix", "financestatus", "voucherst", "Ad_category",
                "Ro_datetime", "Vat", "Booking_status", "Cio_id",
                "Receipt_no", "uom_code", "Bgcolor_publication",
                "chkfor_valid_pubdates", "Agency_ratecode", "audit",
                "book_insert_date", "agencycomm", "rate_audit", "bill_audit",
                "billtype", "Premium_type", "copy_booking",
                "RATE_COMPANY_AGENCY", "ADDITIONAL_AGENCY_COMM",
                "AGENCY_RETAINER_COMM", "SUBEDITIONRATE", cls_billtype,
                dis_billtype, "BILLING_FORMAT", "RATE_CHECK", "ALL_PACKAGE",
                dayrate, scheme_type, disp_clsbill, receipt_format,
                cash_receipt_bill, bill_orderwslast, floor_chk, rokeycheck,
                agencycomm_seq_com, credit_recipt, disp_cashbill,
                cla_cashbill, rate_audit_pref, barcoding_allowed,
                fmg_bill_dis, bill_disp_cashbill, bill_cla_cashbill,
                backdatereceipt, rowise_cashbooking, cutofftime,
                dockit_booking, approval, back_days, cash_discount,
                cash_discounttype, "Allowed_old_date", seprate_cashier,
                cir_many_time_posting, cir_backdays_posting,
                cir_max_return_allow, cir_return_limit_allow,
                cir_no_of_chqbounce, cir_days_chqbounce, cir_return_days,
                cir_sup_order_limit, disp_billing_criteria,
                clsd_billing_criteria, max_publishdays, billno_periodicity,
                specialdisc_trans_edit, sharing_trans,
                multipackage_sel_trans, scheme_minword, trade_splcharge,
                rate_authorization, f2_record, publishad_edit_rateaudit,
                bindrevenue_center, fa_ledger_allow, clearance_type_allow,
                repeat_day_type, premium_edit, bill_generation_prior,
                publication_ho, spldisc_allowprem, bill_scheme,
                allowed_pdc_days_receipt, ad_type_manul_bill,
                outstanding_amt_criteria AS ro_outstand, genrate_cir_agcd,
                disp_auditbkg, cir_dis_auto_posting, relauthreqon,
                cir_auto_approval_unsold, cir_auto_physical_unsold,
                cir_unsold_include_inct, cir_unsold_include_insfee,
                cir_unsold_on_received_dt, agency_unblock_approval,
                unblock_approval_outside_limit, cir_bill_publwise,
                records_on_page, records_on_print, header_on_page,
                agency_required, region_required, allow_follow_dt_boook,
                crm_supply_type_paid, crm_supply_type_free,
                currency_measurement, "Space_area", editable_agency_comm,
                cancellation_charge, taxi_entry_type, approval_with,
                tds_auto_cn, tds_auto_reason, tds_db_cdp, tds_cr_cdp,
                ser_tax_auto_cn, ser_tax_auto_reason, ser_tax_db_cdp,
                ser_tax_cr_cdp, pkk_auto_cn, pkk_auto_reason, pkk_db_cdp,
                pkk_cr_cdp, bank_chg_auto_cn, bank_chg_auto_reason,
                bank_chg_db_cdp, bank_chg_cr_cdp, cir_barcode,
                cir_wieght_calc_req, gen_rct_typ, product_brand_req, ALLOWPREM_CARD_DISC_RATE,FINANCE_CADE,EXECUTIVE_PUBLICATION_VISE,EXECUTIVECREDITLIMIT,MRV_BASED_ON ,FIXED_TRANSACTION_AMT,TRADE_DIS_BASED_ON,
                CIR_POST_DIS,
    CIR_VAT_ALLOW,
    CIR_SUP_ALT_ROUTE,
    SHOW_REC_ALL_AGENCY,
    CIR_SUP_ORDER_DEC_LIMIT,
    CIR_ALLOW_HOLIDAY_SUN,
    CIR_ALLOW_HOLIDAY_MON,
    CIR_ALLOW_HOLIDAY_TUE,
    CIR_ALLOW_HOLIDAY_WED,
    CIR_ALLOW_HOLIDAY_THU,
    CIR_ALLOW_HOLIDAY_FRI,
    CIR_ALLOW_HOLIDAY_SAT,
    CRM_AUTOINFO,
    SAP_ID,
    SCHEDULING_HOURS,
    COMMON_EDITION_FOR_UNIT,
    MIN_MAX_VALIDATE_IN_CORRECTION,
	CIR_BASE_SUP_ENBL_SUPALTER,
    CIR_UCN_POCESS_IN_GROUP,
    CIR_UPDATE_ESTIMATION,
	CIR_EMAIL_SMS_IN_APPROVAL ,
    RETAIN_COMM_ON_LAST_RECDATE,
    SUPPLIMENTARY_BILL_REQ,RET_COMM_TDS_ASSEY,RET_COMM_TDS_SEC_CODE,RET_COMM_NOPAN_TDS_RATE
    
    
           FROM preferrences
          WHERE "comp_code" = compcode;
   END currbindpreferpgld_p;
END currbindpreferpgld;
/







CREATE OR REPLACE PACKAGE HT18JULY.Wesp_Updatedate
IS
PROCEDURE      Wesp_Updatedate_p(
compcode IN VARCHAR2,
userid IN VARCHAR2,
dateformat IN VARCHAR2,
code IN VARCHAR2,
curr IN VARCHAR2,
RATECODE11 IN VARCHAR2,
solo  IN VARCHAR2,
breakup VARCHAR2,
bwcode IN VARCHAR2,
rostatus IN VARCHAR2,
filename IN VARCHAR2,
tfn IN NUMBER,
insertbreak IN VARCHAR2,
prem IN VARCHAR2,
dealtype IN VARCHAR2,
pre IN VARCHAR2,
suff IN VARCHAR2,
financestatus IN  VARCHAR2,
voucherst IN VARCHAR2,
adcode IN VARCHAR2,
rodatetime IN VARCHAR2,
spacearea IN VARCHAR2,
vat IN VARCHAR2,
bookstat IN VARCHAR2,
cio_id IN VARCHAR2,
receipt_no IN VARCHAR2,
uom IN VARCHAR2,
bgcolor IN VARCHAR2,
validdate IN VARCHAR2,
agencyratecode IN VARCHAR2,
AUDIT1 IN VARCHAR2,
book_insert_date IN VARCHAR2,
agencycomm IN VARCHAR2,
rateaudit IN VARCHAR2,
billaudit IN VARCHAR2,
bill_type IN VARCHAR2,
invoice_no1 IN VARCHAR2,
copybooking IN VARCHAR2,
ratecompany IN VARCHAR2,
addagenycomm IN VARCHAR2,
agencycommlinkretainer IN VARCHAR2,
subeditionr IN VARCHAR2,
displaybilltype IN VARCHAR2,
classifiedbilltype IN VARCHAR2,
billformat IN VARCHAR2,
ratechk IN VARCHAR2,
allpkg IN VARCHAR2,
dayrate1 in varchar2,
schemetype in varchar2,
PIncludeclassi in varchar2,
receiptformat IN VARCHAR2,
v_cash_receipt in varchar2,
v_bill_orderwiselast in varchar2,
v_floor_chk in varchar2,
Unsoldflag in varchar2,
Supplystopper in  number,
drpRokeychk in varchar2,
Agencycomm_seq in varchar2,
creditreciept in varchar,
cashindisplay IN VARCHAR,
cashinclassified IN VARCHAR,
v_rate_audit_pref in varchar,
v_barcoding_allow_pref in varchar2,
v_fmgbills IN VARCHAR2,
v_billed_cashdis in varchar2,
v_billed_cashcls in varchar,
v_drpbackdate in varchar,
dockitbooking in varchar2,
allowprevbooking in varchar2,
ro_wisecashbill in varchar2,
chkval in varchar2,
approval1 in varchar2,
pckstatus in varchar2,
cash_disc in varchar2,
cash_amt in varchar2,
seperate_cashier1 in varchar2,
disp_bill in varchar2,
clas_bill in varchar2,
mantimepost in varchar2,
bkdaypost in number,
maxterutn in number,
cir_return in varchar2,
noofchkbounc in number,
noofdaychkrec in number,
retday in number,
chngsuppord in number,
max_publishday in number,
p_billno_period in varchar,
spl_trans_edit in varchar2,
spl_dis_trans_editable in varchar2,
mul_pac_sel_trans in varchar2,
shmon_minword in varchar2,
tradon_spcrg in varchar2,
rateauth     in varchar2,
f2day in number,
rateauditmodify in varchar,
bindrevenuecenter in varchar,
p_led_allow in varchar,
p_clear_allow in varchar,
repeatday in varchar,
premiumedit in varchar,
P_BILL_GENERATION in varchar,
P_PUBLICATION_CENTER in varchar,
P_allow_discount_prem IN VARCHAR,
P_SCHEME_BILLING in varchar,
P_ALLOW_PDC in varchar,
PAD_TYPE_FOR_MANUL_BILL in varchar,
RO_OUTSTAND_P IN VARCHAR2,
genrate_agency_code IN VARCHAR2,
p_dispauditbk IN VARCHAR2,
p_aotosupply  IN VARCHAR2,
p_Authorization IN VARCHAR2,
p_CIR_AUTO_APPROVAL_UNSOLD IN VARCHAR2,
p_CIR_AUTO_PHYSICAL_UNSOLD IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INCT IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INSFEE IN VARCHAR2,
p_CIR_UNSOLD_ON_RECEIVED_DT IN VARCHAR2,
p_AGENCY_UNBLOCK_APROV IN VARCHAR2,
p_UNBLOCK_APROV_OUT_LMT IN VARCHAR2,
p_CIR_BILL_PUBLWISE IN VARCHAR2,
p_paging         IN VARCHAR2,
p_print          IN VARCHAR2,
p_allowpage      IN VARCHAR2,
p_agency_req     IN VARCHAR2,
p_region_req     IN VARCHAR2,
p_ALLOW_FOLLOW_DT_BOOOK     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_PAID     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_FREE     IN VARCHAR2,
p_CURRENCY_MEASUREMENT     IN VARCHAR2,

p_EDITABLE_AGENCY_COMM      IN VARCHAR2,
p_CANCELLATION_CHARGE      IN VARCHAR2,
P_taxi_entry_type          IN VARCHAR2,
P_ApprovalWith          IN VARCHAR2,
p_Auto_TDS_Credit_Note IN VARCHAR2,
p_TDS_Reason IN VARCHAR2,
p_Debit_Account_Head IN VARCHAR2,
p_credit_Account_Head IN VARCHAR2,
p_service_tax_credit_note IN VARCHAR2,
p_Tax_Reason IN VARCHAR2,
p_Debit_Account_Service_Tax IN VARCHAR2,
p_Credit_Account_Service_Tax IN VARCHAR2,
p_Auto_Patrakar_Credit_Note IN VARCHAR2,
p_Patrakar_Reason IN VARCHAR2,
p_Debit_Account_Patrakar IN VARCHAR2,
p_Credit_Account_Patrakar IN VARCHAR2,
p_Auto_Bank_Credit_Note IN VARCHAR2,
p_Bank_Reason IN VARCHAR2,
p_Debit_Account_Bank IN VARCHAR2,
p_Credit_Account_Bank IN VARCHAR2,
P_BAR_CODE IN VARCHAR2,
P_GEN_RCT_TYP IN VARCHAR2,
P_WEIGHT_CAL IN VARCHAR2:=null,
P_misdata IN VARCHAR2:=null,
P_allowpremium IN VARCHAR2:=null,
p_financecode in varchar2:=null,
p_exepub in varchar2:=null,
p_executivecreditlimit in varchar2:=null,
--new add
P_postdis in  varchar2:=null,
P_suppdecreselimit in  varchar2:=null,
P_allowvat in  varchar2:=null,
P_alterroute in  varchar2:=null,
P_showrecptag in  varchar2:=null,
P_allowhoSUN in  varchar2:=null,
P_allowhoMON in  varchar2:=null,
P_allowhoTUE in  varchar2:=null,
P_allowhoWED in  varchar2:=null,
P_allowhoTHU in  varchar2:=null,
P_allowhoFRI in  varchar2:=null,
P_allowhoSAT in  varchar2:=null,
--new add
p_autoinfo  in  varchar2:=null,
p_sapid     in  varchar2 :=null,
p_mrv in varchar2:=null,
p_tradediscount in varchar2:=null,


p_fixedtransamt in float :=null,
p_schhr in varchar2:=null,
p_ret_after_bank IN varchar2:=null,
P_commedi_forunit  IN varchar2:=null,
P_min_max_validate_correction IN varchar2:=null,
P_basesupply_enablealteration  IN varchar2:=null,
P_UCN_PROCESS IN varchar2:=null,
P_update_estimation IN varchar2:=null,
P_email_sms_approval IN varchar2:=null,
  p_RETAIN_COMM_ON_LAST_RECDATE in varchar2 ,
     p_SUPPLIMENTARY_BILL_REQ in varchar2,
      p_tdsasseyname in varchar2,
     p_tdssecname in varchar2,
     p_tdsretname in varchar2
);
END      Wesp_Updatedate;
/
















CREATE OR REPLACE PACKAGE BODY HT18JULY.Wesp_Updatedate IS
PROCEDURE      Wesp_Updatedate_p(
compcode IN VARCHAR2,
userid IN VARCHAR2,
dateformat IN VARCHAR2,
code IN VARCHAR2,
curr IN VARCHAR2,
RATECODE11 IN VARCHAR2,
solo  IN VARCHAR2,
breakup VARCHAR2,
bwcode IN VARCHAR2,
rostatus IN VARCHAR2,
filename IN VARCHAR2,
tfn IN NUMBER,
insertbreak IN VARCHAR2,
prem IN VARCHAR2,
dealtype IN VARCHAR2,
pre IN VARCHAR2,
suff IN VARCHAR2,
financestatus IN  VARCHAR2,
voucherst IN VARCHAR2,
adcode IN VARCHAR2,
rodatetime IN VARCHAR2,
spacearea IN VARCHAR2,
vat IN VARCHAR2,
bookstat IN VARCHAR2,
cio_id IN VARCHAR2,
receipt_no IN VARCHAR2,
uom IN VARCHAR2,
bgcolor IN VARCHAR2,
validdate IN VARCHAR2,
agencyratecode IN VARCHAR2,
AUDIT1 IN VARCHAR2,
book_insert_date IN VARCHAR2,
agencycomm IN VARCHAR2,
rateaudit IN VARCHAR2,
billaudit IN VARCHAR2,
bill_type IN VARCHAR2,
invoice_no1 IN VARCHAR2,
copybooking IN VARCHAR2,
ratecompany IN VARCHAR2,
addagenycomm IN VARCHAR2,
agencycommlinkretainer IN VARCHAR2,
subeditionr IN VARCHAR2,
displaybilltype IN VARCHAR2,
classifiedbilltype IN VARCHAR2,
billformat IN VARCHAR2,
ratechk IN VARCHAR2,
allpkg IN VARCHAR2,
dayrate1 in varchar2,
schemetype in varchar2,
PIncludeclassi in varchar2,
receiptformat IN VARCHAR2,
v_cash_receipt in varchar2,
v_bill_orderwiselast in varchar2,
v_floor_chk in varchar2,
Unsoldflag in varchar2,
Supplystopper in  number,
drpRokeychk in varchar2,
Agencycomm_seq in varchar2,
creditreciept in varchar,
cashindisplay IN VARCHAR,
cashinclassified IN VARCHAR,
v_rate_audit_pref in varchar,
v_barcoding_allow_pref in varchar2,
v_fmgbills IN VARCHAR2,
v_billed_cashdis in varchar2,
v_billed_cashcls in varchar,
v_drpbackdate in varchar,
dockitbooking in varchar2,
allowprevbooking in varchar2,
ro_wisecashbill in varchar2,
chkval in varchar2,
approval1 in varchar2,
pckstatus in varchar2,
cash_disc in varchar2,
cash_amt in varchar2,
seperate_cashier1 in varchar2,
disp_bill in varchar2,
clas_bill in varchar2,
mantimepost in varchar2,
bkdaypost in number,
maxterutn in number,
cir_return in varchar2,
noofchkbounc in number,
noofdaychkrec in number,
retday in number,
chngsuppord in number,
max_publishday in number,
p_billno_period in varchar,
spl_trans_edit in varchar2,
spl_dis_trans_editable in varchar2,
mul_pac_sel_trans in varchar2,
shmon_minword in varchar2,
tradon_spcrg in varchar2,
rateauth     in varchar2,
f2day in number,
rateauditmodify in varchar,
bindrevenuecenter in varchar,
p_led_allow in varchar,
p_clear_allow in varchar,
repeatday in varchar,
premiumedit in varchar,
P_BILL_GENERATION in varchar,
P_PUBLICATION_CENTER in varchar,
P_allow_discount_prem IN VARCHAR,
P_SCHEME_BILLING in varchar,
P_ALLOW_PDC in varchar,
PAD_TYPE_FOR_MANUL_BILL in varchar,
RO_OUTSTAND_P IN VARCHAR2,
genrate_agency_code IN VARCHAR2,
p_dispauditbk IN VARCHAR2,
p_aotosupply  IN VARCHAR2,
p_Authorization IN VARCHAR2,
p_CIR_AUTO_APPROVAL_UNSOLD IN VARCHAR2,
p_CIR_AUTO_PHYSICAL_UNSOLD IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INCT IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INSFEE IN VARCHAR2,
p_CIR_UNSOLD_ON_RECEIVED_DT IN VARCHAR2,
p_AGENCY_UNBLOCK_APROV IN VARCHAR2,
p_UNBLOCK_APROV_OUT_LMT IN VARCHAR2,
p_CIR_BILL_PUBLWISE IN VARCHAR2,
p_paging         IN VARCHAR2,
p_print          IN VARCHAR2,
p_allowpage      IN VARCHAR2,
p_agency_req     IN VARCHAR2,
p_region_req     IN VARCHAR2,
p_ALLOW_FOLLOW_DT_BOOOK     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_PAID     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_FREE     IN VARCHAR2,
p_CURRENCY_MEASUREMENT     IN VARCHAR2,

p_EDITABLE_AGENCY_COMM      IN VARCHAR2,
p_CANCELLATION_CHARGE      IN VARCHAR2,
P_taxi_entry_type          IN VARCHAR2,
P_ApprovalWith          IN VARCHAR2,

p_Auto_TDS_Credit_Note IN VARCHAR2,
p_TDS_Reason IN VARCHAR2,
p_Debit_Account_Head IN VARCHAR2,
p_credit_Account_Head IN VARCHAR2,
p_service_tax_credit_note IN VARCHAR2,
p_Tax_Reason IN VARCHAR2,
p_Debit_Account_Service_Tax IN VARCHAR2,
p_Credit_Account_Service_Tax IN VARCHAR2,
p_Auto_Patrakar_Credit_Note IN VARCHAR2,
p_Patrakar_Reason IN VARCHAR2,
p_Debit_Account_Patrakar IN VARCHAR2,
p_Credit_Account_Patrakar IN VARCHAR2,
p_Auto_Bank_Credit_Note IN VARCHAR2,
p_Bank_Reason IN VARCHAR2,
p_Debit_Account_Bank IN VARCHAR2,
p_Credit_Account_Bank IN VARCHAR2,
P_BAR_CODE IN VARCHAR2,
P_GEN_RCT_TYP IN VARCHAR2,
P_WEIGHT_CAL IN VARCHAR2:=null,
P_misdata IN VARCHAR2:=null,
P_allowpremium IN VARCHAR2:=null,
p_financecode in varchar2:=null,
p_exepub in varchar2:=null,
p_executivecreditlimit in varchar2:=null,
--new add
P_postdis in  varchar2:=null,
P_suppdecreselimit in  varchar2:=null,
P_allowvat in  varchar2:=null,
P_alterroute in  varchar2:=null,
P_showrecptag in  varchar2:=null,
P_allowhoSUN in  varchar2:=null,
P_allowhoMON in  varchar2:=null,
P_allowhoTUE in  varchar2:=null,
P_allowhoWED in  varchar2:=null,
P_allowhoTHU in  varchar2:=null,
P_allowhoFRI in  varchar2:=null,
P_allowhoSAT in  varchar2:=null,
--new add
p_autoinfo  in  varchar2:=null,
p_sapid     in  varchar2 :=null,
p_mrv in varchar2:=null,
p_tradediscount in varchar2:=null,


p_fixedtransamt in float :=null,
p_schhr in varchar2:=null,
p_ret_after_bank IN varchar2:=null,
P_commedi_forunit  IN varchar2:=null,
P_min_max_validate_correction IN varchar2:=null,
P_basesupply_enablealteration  IN varchar2:=null,
P_UCN_PROCESS IN varchar2:=null,
P_update_estimation IN varchar2:=null,
P_email_sms_approval IN varchar2:=null,
  p_RETAIN_COMM_ON_LAST_RECDATE in varchar2,
     p_SUPPLIMENTARY_BILL_REQ in varchar2,
     p_tdsasseyname in varchar2,
     p_tdssecname in varchar2,
     p_tdsretname in varchar2


)AS
BEGIN
UPDATE LOGIN SET "date_format"=dateformat,
"Autogenerate"=code,"curr_code"=curr WHERE "COM_CODE"=compcode;
COMMIT;
       UPDATE PREFERRENCES SET  "autogenerated"=code,
"currency_code"=curr ,
"rate_gr_code"=RATECODE11,
"date_format"=dateformat,"solo"=solo,"breakup"=breakup,
"blackwhitecode"=bwcode,"rostatus"=rostatus,"File_name"=filename,"Tfn"=tfn,
"Insert_breakup"=insertbreak,"Premium_type"=prem,"Deal_type"=dealtype  ,
 "prefix"=pre, "suffix"=suff, "financestatus"=financestatus ,
"voucherst"=voucherst,
 "Ad_category"=adcode ,"Ro_datetime"=rodatetime
,"Space_area"=spacearea,"Vat"=vat,
 "Booking_status"=bookstat,"Cio_id"=cio_id,"Receipt_no"=receipt_no,"uom_code"=uom,
 "Bgcolor_publication"=bgcolor ,"chkfor_valid_pubdates"=validdate,
"Agency_ratecode"=agencyratecode,
 "audit"=AUDIT1,"book_insert_date"=book_insert_date,"agencycomm"=agencycomm,
 "rate_audit"=rateaudit,"bill_audit"=billaudit,"billtype"=bill_type,"invoice_no"=invoice_no1,
 "copy_booking"=copybooking,"RATE_COMPANY_AGENCY"=ratecompany,
"ADDITIONAL_AGENCY_COMM"=addagenycomm ,
 "AGENCY_RETAINER_COMM"=agencycommlinkretainer,"SUBEDITIONRATE"=subeditionr,
 "CLS_BILLTYPE"=classifiedbilltype,"DIS_BILLTYPE"=displaybilltype,"BILLING_FORMAT"=billformat,
 "RATE_CHECK"=ratechk,"ALL_PACKAGE"=allpkg,"DAYRATE"=dayrate1,"SCHEME_TYPE"=schemetype,"DISP_CLSBILL"=PIncludeclassi
 ,
 "CASH_RECEIPT_BILL"=v_cash_receipt,
"BILL_ORDERWSLAST"=v_bill_orderwiselast, "FLOOR_CHK"=v_floor_chk ,
 "UNSOLD_ENTRY_FLAG"=Unsoldflag
,"SUPPLY_STOP_PERCENTAGE"=Supplystopper,"ROKEYCHECK"=drpRokeychk ,
 "AGENCYCOMM_SEQ_COM"=Agencycomm_seq
,"CREDIT_RECIPT"=creditreciept,"DISP_CASHBILL"=cashindisplay,
 "CLA_CASHBILL"=cashinclassified,"RATE_AUDIT_PREF"=v_rate_audit_pref,"BARCODING_ALLOWED"=v_barcoding_allow_pref,
 "FMG_BILL_DIS" =v_fmgbills, "BILL_DISP_CASHBILL"=v_billed_cashdis ,
"BILL_CLA_CASHBILL"=v_billed_cashcls,"BACKDATERECEIPT"=v_drpbackdate,"DOCKIT_BOOKING"=dockitbooking,"Allowed_old_date"=allowprevbooking,"ROWISE_CASHBOOKING"=ro_wisecashbill,"CUTOFFTIME"=chkval,"APPROVAL"=approval1,"BACK_DAYS"=pckstatus
,CASH_DISCOUNT=cash_amt,CASH_DISCOUNTTYPE=cash_disc,SEPRATE_CASHIER=seperate_cashier1,
  CIR_MANY_TIME_POSTING=mantimepost, CIR_BACKDAYS_POSTING=bkdaypost,
CIR_MAX_RETURN_ALLOW=maxterutn, CIR_RETURN_LIMIT_ALLOW=cir_return,
CIR_NO_OF_CHQBOUNCE=noofchkbounc, CIR_DAYS_CHQBOUNCE=noofdaychkrec,
CIR_RETURN_DAYS=retday, CIR_SUP_ORDER_LIMIT=chngsuppord,
DISP_BILLING_CRITERIA=disp_bill,
CLSD_BILLING_CRITERIA=clas_bill,MAX_PUBLISHDAYS=max_publishday,BILLNO_PERIODICITY=p_billno_period,
  SPECIALDISC_TRANS_EDIT=spl_trans_edit,
SHARING_TRANS=spl_dis_trans_editable,
MULTIPACKAGE_SEL_TRANS=mul_pac_sel_trans,SCHEME_MINWORD=shmon_minword,
TRADE_SPLCHARGE=tradon_spcrg,RATE_AUTHORIZATION=rateauth
 ,F2_RECORD=f2day,PUBLISHAD_EDIT_RATEAUDIT=rateauditmodify,BINDREVENUE_CENTER=bindrevenuecenter,
 FA_LEDGER_ALLOW=p_led_allow
,CLEARANCE_TYPE_ALLOW=p_clear_allow,REPEAT_DAY_TYPE=repeatday,PREMIUM_EDIT=premiumedit,
BILL_GENERATION_PRIOR=P_BILL_GENERATION,PUBLICATION_HO=P_PUBLICATION_CENTER,SPLDISC_ALLOWPREM=P_allow_discount_prem,

BILL_SCHEME=P_SCHEME_BILLING,ALLOWED_PDC_DAYS_RECEIPT=P_ALLOW_PDC
,AD_TYPE_MANUL_BILL=PAD_TYPE_FOR_MANUL_BILL,OUTSTANDING_AMT_CRITERIA=RO_OUTSTAND_P,GENRATE_CIR_AGCD=genrate_agency_code,DISP_AUDITBKG=p_dispauditbk,CIR_DIS_AUTO_POSTING=p_aotosupply,RELAUTHREQON=p_Authorization,
CIR_AUTO_APPROVAL_UNSOLD=p_CIR_AUTO_APPROVAL_UNSOLD,CIR_AUTO_PHYSICAL_UNSOLD=p_CIR_AUTO_PHYSICAL_UNSOLD,CIR_UNSOLD_INCLUDE_INCT=p_CIR_UNSOLD_INCLUDE_INCT,
CIR_UNSOLD_INCLUDE_INSFEE=p_CIR_UNSOLD_INCLUDE_INSFEE,CIR_UNSOLD_ON_RECEIVED_DT=p_CIR_UNSOLD_ON_RECEIVED_DT,
AGENCY_UNBLOCK_APPROVAL=p_AGENCY_UNBLOCK_APROV,UNBLOCK_APPROVAL_OUTSIDE_LIMIT=p_UNBLOCK_APROV_OUT_LMT,CIR_BILL_PUBLWISE=p_CIR_BILL_PUBLWISE,
RECORDS_ON_PAGE = p_paging,RECORDS_ON_PRINT = p_print,HEADER_ON_PAGE =
p_allowpage,AGENCY_REQUIRED = p_agency_req,REGION_REQUIRED =
p_region_req,
ALLOW_FOLLOW_DT_BOOOK=p_ALLOW_FOLLOW_DT_BOOOK,CRM_SUPPLY_TYPE_PAID=p_CRM_SUPPLY_TYPE_PAID,CRM_SUPPLY_TYPE_FREE=p_CRM_SUPPLY_TYPE_FREE,
CURRENCY_MEASUREMENT=p_CURRENCY_MEASUREMENT,EDITABLE_AGENCY_COMM=p_EDITABLE_AGENCY_COMM,CANCELLATION_CHARGE=p_CANCELLATION_CHARGE,taxi_entry_type=P_taxi_entry_type,APPROVAL_WITH
=P_ApprovalWith , TDS_AUTO_CN=p_Auto_TDS_Credit_Note,
TDS_AUTO_REASON=p_TDS_Reason
,TDS_DB_CDP=p_Debit_Account_Head,TDS_CR_CDP=p_credit_Account_Head,SER_TAX_AUTO_CN=p_service_tax_credit_note,SER_TAX_AUTO_REASON=p_Tax_Reason,SER_TAX_DB_CDP=p_Debit_Account_Service_Tax,SER_TAX_CR_CDP=p_Credit_Account_Service_Tax,PKK_AUTO_CN=p_Auto_Patrakar_Credit_Note,PKK_AUTO_REASON=p_Patrakar_Reason
,PKK_DB_CDP=p_Debit_Account_Patrakar,PKK_CR_CDP=p_Credit_Account_Patrakar
,BANK_CHG_AUTO_CN=p_Auto_Bank_Credit_Note ,
BANK_CHG_AUTO_REASON=p_Bank_Reason
,BANK_CHG_DB_CDP=p_Debit_Account_Bank
,BANK_CHG_CR_CDP=p_Credit_Account_Bank ,


CIR_BARCODE=P_BAR_CODE, CIR_WIEGHT_CALC_REQ =P_WEIGHT_CAL, GEN_RCT_TYP
=P_GEN_RCT_TYP,PRODUCT_BRAND_REQ=P_misdata,ALLOWPREM_CARD_DISC_RATE=P_allowpremium,FINANCE_CADE=p_financecode,EXECUTIVE_PUBLICATION_VISE=p_exepub,
EXECUTIVECREDITLIMIT=p_executivecreditlimit,
FIXED_TRANSACTION_AMT=p_fixedtransamt,
TRADE_DIS_BASED_ON=p_tradediscount,


--NEW ADD
 CIR_POST_DIS=P_postdis,
 CIR_VAT_ALLOW=P_allowvat,
 CIR_SUP_ALT_ROUTE=P_alterroute,
 SHOW_REC_ALL_AGENCY=P_showrecptag,
 CIR_SUP_ORDER_DEC_LIMIT=P_suppdecreselimit,
 CIR_ALLOW_HOLIDAY_SUN=P_allowhoSUN,
 CIR_ALLOW_HOLIDAY_MON=P_allowhoMON,       
 CIR_ALLOW_HOLIDAY_TUE=P_allowhoTUE,
 CIR_ALLOW_HOLIDAY_WED=P_allowhoWED,
 CIR_ALLOW_HOLIDAY_THU=P_allowhoTHU,
 CIR_ALLOW_HOLIDAY_FRI=P_allowhoFRI,
 CIR_ALLOW_HOLIDAY_SAT=P_allowhoSAT,


CRM_AUTOINFO=p_autoinfo,
SAP_ID=p_sapid,
MRV_BASED_ON=p_mrv,
SCHEDULING_HOURS=p_schhr,ALLOW_RET_AFTER_BANK=p_ret_after_bank,
COMMON_EDITION_FOR_UNIT=P_commedi_forunit,
MIN_MAX_VALIDATE_IN_CORRECTION=P_min_max_validate_correction,
CIR_BASE_SUP_ENBL_SUPALTER=P_basesupply_enablealteration,
CIR_UCN_POCESS_IN_GROUP=P_UCN_PROCESS,
CIR_UPDATE_ESTIMATION=P_update_estimation,
CIR_EMAIL_SMS_IN_APPROVAL=P_email_sms_approval,

  RETAIN_COMM_ON_LAST_RECDATE=p_RETAIN_COMM_ON_LAST_RECDATE ,
     SUPPLIMENTARY_BILL_REQ=p_SUPPLIMENTARY_BILL_REQ ,
     RET_COMM_TDS_ASSEY=p_tdsasseyname,
     RET_COMM_TDS_SEC_CODE=p_tdssecname,
   RET_COMM_NOPAN_TDS_RATE=  p_tdsretname
 
  WHERE "comp_code"=compcode;
COMMIT;
END      Wesp_Updatedate_p;
END      Wesp_Updatedate;
/






////////////////end of issue no. 9789////////////////



/////////////////////anuj (Rajasth patrika point no 98)///////////////////////////



/* Formatted on 2013/02/18 14:34 (Formatter Plus v4.8.8) */
CREATE OR REPLACE FORCE VIEW ad_ros (unit,
                                                 idnum,
                                                 insnum,
                                                 bkdate,
                                                 priadctg,
                                                 secadctg,
                                                 colour,
                                                 pripub,
                                                 secpub,
                                                 bkfor,
                                                 insdate,
                                                 remark1,
                                                 caption,
                                                 pubsize,
                                                 pubcol,
                                                 canmiss,
                                                 sz1,
                                                 col1,
                                                 file_name,
                                                 page_no,
                                                 receipt_no,
                                                 clientname,
                                                 client_name,
                                                 pagination_id,
                                                 edition,
                                                 splpage,
                                                 st_solus,
                                                 comp_code,
                                                 userid,
                                                 lockstatus,
                                                 edition_flag,
                                                 bkcenter,
                                                 packagename,
                                                 pkgcode,
                                                 rate_code,
                                                 key_no,
                                                 page_prem,
                                                 dp_height,
                                                 dp_width,
                                                 no_of_insertion,
                                                 bill_no,
                                                 bill_date,
                                                 branchname,
                                                 audited
                                                )
AS
   SELECT x.unit AS unit, x.idnum AS idnum, x.insnum AS insnum,
          x.bkdate AS bkdate, x.priadctg AS priadctg, x.secadctg AS secadctg,
          x.colour AS colour, x.pripub AS pripub,
          NVL ((SELECT DISTINCT secpub
                           FROM ad_dummy_swap
                          WHERE idnum = x.idnum
                            AND insnum = x.insnum
                            AND bkfor = x.bkfor
                            AND edition = x.edition
                            AND insdate = x.insdate),
               x.secpub
              ) AS secpub,
          x.bkfor AS bkfor, x.insdate AS insdate, x.remark1 AS remark1,
          x.caption AS caption, x.pubsize AS pubsize, x.pubcol AS pubcol,
          x.canmiss AS canmiss, x.sz1 AS sz1, x.col1 AS col1,
          x.filename AS file_name, x.page_no AS page_no,
          x.receipt_no AS receipt_no, x.clientname AS clientname,
          x.client_name AS client_name, x.pagination_id AS pagination_id,
          x.edition AS edition, x.splpage AS splpage, x.st_solus AS st_solus,
          x.comp_code AS comp_code, x.userid AS userid,
          x.lockstatus AS lockstatus, x.edition_flag AS edition_flag,
          x.bkcenter AS bkcenter, x.packagename AS packagename,
          x.pkgcode AS pkgcode, x.rate_code AS rate_code, x.key_no AS key_no,
          x.page_prem AS page_prem, x.dealer_h dp_height, x.dealer_w dp_width,
          x.no_of_insertion, x.bill_no, x.bill_date, x.branchname,
          x.audited AS audited
     FROM (SELECT   tbl_booking_insert."Publication_Code" AS unit,
                    tbl_booking_insert."Cio_Booking_Id" AS idnum,
                    tbl_booking_insert."No_Insert" AS insnum,
                    tbl_booking_mast."date_time" AS bkdate,
                    tbl_booking_insert."Ad_Cat" AS priadctg,
                    tbl_booking_insert."Ad_Sub_Cat" AS secadctg,
                    CASE
                       WHEN tbl_booking_insert."Col_Code" = 'CO0'
                        OR tbl_booking_insert."Col_Code" = 'C'
                          THEN 'C'
                       WHEN tbl_booking_insert."Col_Code" = 'B'
                          THEN 'B'
                    END colour,
                    tbl_booking_insert."Publication_Code" AS pripub,
                    tbl_booking_insert."Supp_Code" AS secpub,
                    
                    --tbl_booking_subedition.edition AS secpub,
                    tbl_booking_insert."Pub_Cent_Code" AS bkfor,
                    tbl_booking_subedition.insertdate AS insdate,
                    tbl_booking_insert."Remarks"  AS remark1,
                    tbl_booking_insert.CAPTION AS caption,
                    tbl_booking_subedition.pub_height AS pubsize,
                    tbl_booking_subedition.pub_width AS pubcol,
                    CASE
                       WHEN tbl_booking_subedition.insertstatus =
                                                             'cancel'
                          THEN 'C'
                       WHEN tbl_booking_subedition.insertstatus =
                                                             'booked'
                          THEN 'B'
                       WHEN tbl_booking_subedition.insertstatus =
                                                      'audit by rate'
                        OR tbl_booking_subedition.insertstatus = 'audit'
                          THEN 'I'
                       WHEN tbl_booking_subedition.insertstatus = 'publish'
                          THEN 'I'
                       WHEN tbl_booking_subedition.insertstatus = 'billed'
                          THEN 'I'
                       WHEN tbl_booking_subedition.insertstatus = 'hold'
                          THEN 'H'
                    END canmiss,
                    tbl_booking_subedition.height AS sz1,
                    tbl_booking_subedition.width AS col1,
                    tbl_booking_subedition.filename,
                    TO_NUMBER (tbl_booking_subedition.page_no) AS page_no,
                    tbl_booking_mast."Receipt_no" AS receipt_no,
                    NVL
                       ((SELECT "Cust_Name"
                           FROM cust_mast
                          WHERE cust_mast."Cust_Code" =
                                                tbl_booking_mast."Client_code"),
                        tbl_booking_mast."Client_code"
                       ) AS clientname,
                    (SELECT    "Agency_Name"
                            || ' ['
                            || (SELECT "City_Name"
                                  FROM city_mst b
                                 WHERE b."City_Code" = agency_mast."City_Code")
                            || ']'
                       FROM agency_mast
                      WHERE agency_mast."Agency_Code" =
                                                tbl_booking_mast."Agency_code"
                        AND "code_subcode" =
                                            tbl_booking_mast."Agency_sub_code")
                                                               AS client_name,
                    TO_NUMBER
                             (tbl_booking_insert."Insert_Id")
                                                             AS pagination_id,
                    tbl_booking_subedition.edition AS edition,
                    
                    --tbl_booking_insert."Edition_Code" AS edition,
                    (SELECT pageheading
                       FROM advpos_prem_mast
                      WHERE "Premiumcode" =
                                     tbl_booking_insert."Premium1")
                                                                   AS splpage,
                    (SELECT "spositionradio"
                       FROM advpos_prem_mast
                      WHERE "Premiumcode" =
                                    tbl_booking_insert."Premium1")
                                                                  AS st_solus,
                    tbl_booking_insert."Comp_Code" AS comp_code,
                    tbl_booking_insert."Userid" AS userid,
                    tbl_booking_insert.lockstatus AS lockstatus,
                    'S' AS edition_flag,
                    (SELECT "pub_center"
                       FROM branch_mst
                      WHERE "Branch_Code" =
                                        tbl_booking_mast."branch")
                                                                  AS bkcenter,
                    (SELECT "Package_Name"
                       FROM combin_mast
                      WHERE "Combin_Code" =
                               tbl_booking_insert.package_code)
                                                               AS packagename,
                    tbl_booking_insert.package_code AS pkgcode,
                    tbl_booking_mast."Rate_code" AS rate_code,
                    tbl_booking_mast."Key_no" AS key_no,
                    (SELECT "Pos_Type"
                       FROM advpos_type_mast
                      WHERE "Pos_Type_Code" =
                                    tbl_booking_mast."Page_prem")
                                                                 AS page_prem,
                    tbl_booking_insert.dealer_h, tbl_booking_insert.dealer_w,
                    tbl_booking_mast."No_of_insertion" AS no_of_insertion,
                    tbl_booking_insert.bill_no AS bill_no,
                    tbl_booking_insert.bill_date AS bill_date,
                    (SELECT "Branch_Name"
                       FROM branch_mst
                      WHERE "Branch_Code" =
                                      tbl_booking_mast."branch")
                                                                AS branchname,
                    NVL (tbl_booking_mast."audit",
                         tbl_booking_mast.modified_audit
                        ) AS audited
               FROM tbl_layoutx_pref a,
                    tbl_booking_insert,
                    tbl_booking_mast,
                    tbl_booking_subedition,
                    edition_mast
              WHERE tbl_booking_insert."Cio_Booking_Id" =
                                             tbl_booking_mast."cio_booking_id"
                AND tbl_booking_mast."cio_booking_id" =
                                                  tbl_booking_subedition.cioid
                AND (   (tbl_booking_mast."Ad_type_code" = 'DI0')
                     OR (    a.allow_cd_ads = 'YES'
                         AND a.color_code = tbl_booking_insert."Col_Code"
                         AND a.uom_code = tbl_booking_mast."Uom_code"
                         AND tbl_booking_mast."Ad_type_code" = 'CL0'
                        )
                    )
                AND (   tbl_booking_mast."audit" IS NOT NULL
                     OR tbl_booking_mast.modified_audit = 'Y'
                    )
                AND a."COMP_CODE" = tbl_booking_insert."Comp_Code"
                AND tbl_booking_insert."Edition_Code" =
                                                   edition_mast."Edition_Code"
                AND edition_mast."Edition_Type" = 'Main Edition'
                AND tbl_booking_insert."Supp_Code" = 'MN'
                AND tbl_booking_insert."Insert_Id" =
                                               tbl_booking_subedition.insertid
           GROUP BY tbl_booking_insert."Publication_Code",
                    tbl_booking_insert."Cio_Booking_Id",
                    tbl_booking_insert."No_Insert",
                    tbl_booking_mast."date_time",
                    tbl_booking_insert."Ad_Cat",
                    tbl_booking_insert."Ad_Sub_Cat",
                    tbl_booking_insert."Col_Code",
                    --tbl_booking_subedition.edition,
                    tbl_booking_insert."Supp_Code",
                    tbl_booking_insert."Pub_Cent_Code",
                    tbl_booking_subedition.insertdate,
                    tbl_booking_insert."Remarks", 
                    tbl_booking_insert.CAPTION,
                    tbl_booking_subedition.height,
                    tbl_booking_subedition.width,
                    tbl_booking_subedition.insertstatus,
                    tbl_booking_subedition.pub_height,
                    tbl_booking_subedition.pub_width,
                    tbl_booking_subedition.filename,
                    -- tbl_booking_insert."Page_No",
                    tbl_booking_subedition.page_no,
                    tbl_booking_mast."Receipt_no",
                    tbl_booking_mast."Client_code",
                    tbl_booking_mast."Agency_code",
                    tbl_booking_mast."Agency_sub_code",
                    tbl_booking_insert."Insert_Id",
                    --tbl_booking_insert."Edition_Code",
                    tbl_booking_subedition.edition,
                    tbl_booking_insert."Premium1",
                    tbl_booking_insert."Comp_Code",
                    tbl_booking_insert."Userid",
                    tbl_booking_insert.lockstatus,
                    tbl_booking_mast."branch",
                    tbl_booking_insert.package_code,
                    tbl_booking_mast."Rate_code",
                    tbl_booking_mast."Key_no",
                    tbl_booking_mast."Page_prem",
                    tbl_booking_insert.dealer_h,
                    tbl_booking_insert.dealer_w,
                    tbl_booking_mast."No_of_insertion",
                    tbl_booking_insert.bill_no,
                    tbl_booking_insert.bill_date,
                    tbl_booking_mast."audit",
                    tbl_booking_mast.modified_audit
           UNION
           SELECT   tbl_booking_insert."Publication_Code" AS unit,
                    tbl_booking_insert."Cio_Booking_Id" AS idnum,
                    tbl_booking_insert."No_Insert" AS insnum,
                    tbl_booking_mast."date_time" AS bkdate,
                    tbl_booking_insert."Ad_Cat" AS priadctg,
                    tbl_booking_insert."Ad_Sub_Cat" AS secadctg,
                    CASE
                       WHEN tbl_booking_insert."Col_Code" = 'CO0'
                        OR tbl_booking_insert."Col_Code" = 'C'
                          THEN 'C'
                       WHEN tbl_booking_insert."Col_Code" = 'B'
                          THEN 'B'
                    END colour,
                    tbl_booking_insert."Publication_Code" AS pripub,
                    tbl_booking_insert."Supp_Code" AS secpub,
                    tbl_booking_insert."Pub_Cent_Code" AS bkfor,
                    tbl_booking_insert."Insert_Date" AS insdate,
                    tbl_booking_insert."Remarks"  AS remark1,
                    tbl_booking_insert.CAPTION AS caption,
                    tbl_booking_insert."Pub_Height" AS pubsize,
                    tbl_booking_insert."Pub_Width" AS pubcol,
                    CASE
                       WHEN tbl_booking_insert."Insert_Status" =
                                                             'cancel'
                          THEN 'C'
                       WHEN tbl_booking_insert."Insert_Status" =
                                                             'booked'
                          THEN 'B'
                       WHEN tbl_booking_insert."Insert_Status" =
                                                      'audit by rate'
                        OR tbl_booking_insert."Insert_Status" = 'audit'
                          THEN 'I'
                       WHEN tbl_booking_insert."Insert_Status" = 'publish'
                          THEN 'I'
                       WHEN tbl_booking_insert."Insert_Status" = 'billed'
                          THEN 'I'
                       WHEN tbl_booking_insert."Insert_Status" = 'hold'
                          THEN 'H'
                    END canmiss,
                    tbl_booking_insert."Height" AS sz1,
                    tbl_booking_insert."Width" AS col1,
                    tbl_booking_insert."File_Name",
                    TO_NUMBER (tbl_booking_insert."Page_No") AS page_no,
                    tbl_booking_mast."Receipt_no" AS receipt_no,
                    NVL
                       ((SELECT "Cust_Name"
                           FROM cust_mast
                          WHERE cust_mast."Cust_Code" =
                                                tbl_booking_mast."Client_code"),
                        tbl_booking_mast."Client_code"
                       ) AS clientname,
                    (SELECT    "Agency_Name"
                            || ' ['
                            || (SELECT "City_Name"
                                  FROM city_mst b
                                 WHERE b."City_Code" = agency_mast."City_Code")
                            || ']'
                       FROM agency_mast
                      WHERE agency_mast."Agency_Code" =
                                                tbl_booking_mast."Agency_code"
                        AND "code_subcode" =
                                            tbl_booking_mast."Agency_sub_code")
                                                               AS client_name,
                    TO_NUMBER
                             (tbl_booking_insert."Insert_Id")
                                                             AS pagination_id,
                    tbl_booking_insert."Edition_Code" AS edition,
                    (SELECT pageheading
                       FROM advpos_prem_mast
                      WHERE "Premiumcode" =
                                     tbl_booking_insert."Premium1")
                                                                   AS splpage,
                    (SELECT "spositionradio"
                       FROM advpos_prem_mast
                      WHERE "Premiumcode" =
                                    tbl_booking_insert."Premium1")
                                                                  AS st_solus,
                    tbl_booking_insert."Comp_Code" AS comp_code,
                    tbl_booking_insert."Userid" AS userid,
                    tbl_booking_insert.lockstatus AS lockstatus,
                    CASE
                       WHEN tbl_booking_insert."Supp_Code" =
                                                         'MN'
                          THEN 'M'                       ----
                       ELSE 'P'
                    END AS edition_flag,
                    (SELECT "pub_center"
                       FROM branch_mst
                      WHERE "Branch_Code" =
                                        tbl_booking_mast."branch")
                                                                  AS bkcenter,
                    (SELECT "Package_Name"
                       FROM combin_mast
                      WHERE "Combin_Code" =
                               tbl_booking_insert.package_code)
                                                               AS packagename,
                    tbl_booking_insert.package_code AS pkgcode,
                    tbl_booking_mast."Rate_code" AS rate_code,
                    tbl_booking_mast."Key_no" AS key_no,
                    (SELECT "Pos_Type"
                       FROM advpos_type_mast
                      WHERE "Pos_Type_Code" =
                                    tbl_booking_mast."Page_prem")
                                                                 AS page_prem,
                    tbl_booking_insert.dealer_h, tbl_booking_insert.dealer_w,
                    tbl_booking_mast."No_of_insertion" AS no_of_insertion,
                    tbl_booking_insert.bill_no AS bill_no,
                    tbl_booking_insert.bill_date AS bill_date,
                    (SELECT "Branch_Name"
                       FROM branch_mst
                      WHERE "Branch_Code" =
                                      tbl_booking_mast."branch")
                                                                AS branchname,
                    NVL (tbl_booking_mast."audit",
                         tbl_booking_mast.modified_audit
                        ) AS audited
               FROM tbl_layoutx_pref a,
                    tbl_booking_insert,
                    tbl_booking_mast,
                    edition_mast
              WHERE tbl_booking_insert."Cio_Booking_Id" =
                                             tbl_booking_mast."cio_booking_id"
                AND (   (tbl_booking_mast."Ad_type_code" = 'DI0')
                     OR (    a.allow_cd_ads = 'YES'
                         AND a.color_code = tbl_booking_insert."Col_Code"
                         AND a.uom_code = tbl_booking_mast."Uom_code"
                         AND tbl_booking_mast."Ad_type_code" = 'CL0'
                        )
                    )
                AND (   tbl_booking_mast."audit" IS NOT NULL
                     OR tbl_booking_mast.modified_audit = 'Y'
                    )
                AND a."COMP_CODE" = tbl_booking_insert."Comp_Code"
                AND tbl_booking_insert."Edition_Code" =
                                                   edition_mast."Edition_Code"
                AND (   edition_mast."Edition_Type" != 'Main Edition'
                     OR tbl_booking_insert."Supp_Code" != 'MN'
                    )
           GROUP BY tbl_booking_insert."Publication_Code",
                    tbl_booking_insert."Cio_Booking_Id",
                    tbl_booking_insert."No_Insert",
                    tbl_booking_mast."date_time",
                    tbl_booking_insert."Ad_Cat",
                    tbl_booking_insert."Ad_Sub_Cat",
                    tbl_booking_insert."Col_Code",
                    tbl_booking_insert."Supp_Code",
                    tbl_booking_insert."Pub_Cent_Code",
                    tbl_booking_insert."Insert_Date",
                    tbl_booking_insert."Remarks",
                    tbl_booking_insert.CAPTION,
                    tbl_booking_insert."Height",
                    tbl_booking_insert."Width",
                    tbl_booking_insert."Insert_Status",
                    tbl_booking_insert."Pub_Height",
                    tbl_booking_insert."Pub_Width",
                    tbl_booking_insert."File_Name",
                    tbl_booking_insert."Page_No",
                    tbl_booking_mast."Receipt_no",
                    tbl_booking_mast."Client_code",
                    tbl_booking_mast."Agency_code",
                    tbl_booking_mast."Agency_sub_code",
                    tbl_booking_insert."Insert_Id",
                    tbl_booking_insert."Edition_Code",
                    tbl_booking_insert."Premium1",
                    tbl_booking_insert."Comp_Code",
                    tbl_booking_insert."Userid",
                    tbl_booking_insert.lockstatus,
                    tbl_booking_mast."branch",
                    tbl_booking_insert.package_code,
                    tbl_booking_mast."Rate_code",
                    tbl_booking_mast."Key_no",
                    tbl_booking_mast."Page_prem",
                    tbl_booking_insert.dealer_h,
                    tbl_booking_insert.dealer_w,
                    tbl_booking_mast."No_of_insertion",
                    tbl_booking_insert.bill_no,
                    tbl_booking_insert.bill_date,
                    tbl_booking_mast."audit",
                    tbl_booking_mast.modified_audit
           UNION
           SELECT   tbl_booking_insert."Publication_Code" AS unit,
                    tbl_booking_insert."Cio_Booking_Id" AS idnum,
                    tbl_booking_insert."No_Insert" AS insnum,
                    tbl_booking_mast."date_time" AS bkdate,
                    tbl_booking_insert."Ad_Cat" AS priadctg,
                    tbl_booking_insert."Ad_Sub_Cat" AS secadctg,
                    CASE
                       WHEN tbl_booking_insert."Col_Code" = 'CO0'
                        OR tbl_booking_insert."Col_Code" = 'C'
                          THEN 'C'
                       WHEN tbl_booking_insert."Col_Code" = 'B'
                          THEN 'B'
                    END colour,
                    tbl_booking_insert."Publication_Code" AS pripub,
                    tbl_booking_insert."Supp_Code" AS secpub,
                    tbl_booking_insert."Pub_Cent_Code" AS bkfor,
                    tbl_booking_insert."Insert_Date" AS insdate,
                    tbl_booking_insert."Remarks"  AS remark1,
                    tbl_booking_insert.CAPTION AS caption,
                    tbl_booking_insert."Pub_Height" AS pubsize,
                    tbl_booking_insert."Pub_Width" AS pubcol,
                    CASE
                       WHEN tbl_booking_insert."Insert_Status" =
                                                             'cancel'
                          THEN 'C'
                       WHEN tbl_booking_insert."Insert_Status" =
                                                             'booked'
                          THEN 'B'
                       WHEN tbl_booking_insert."Insert_Status" =
                                                      'audit by rate'
                        OR tbl_booking_insert."Insert_Status" = 'audit'
                          THEN 'I'
                       WHEN tbl_booking_insert."Insert_Status" = 'publish'
                          THEN 'I'
                       WHEN tbl_booking_insert."Insert_Status" = 'billed'
                          THEN 'I'
                       WHEN tbl_booking_insert."Insert_Status" = 'hold'
                          THEN 'H'
                    END canmiss,
                    tbl_booking_insert."Height" AS sz1,
                    tbl_booking_insert."Width" AS col1,
                    tbl_booking_insert."File_Name",
                    TO_NUMBER (tbl_booking_insert."Page_No") AS page_no,
                    tbl_booking_mast."Receipt_no" AS receipt_no,
                    NVL
                       ((SELECT "Cust_Name"
                           FROM cust_mast
                          WHERE cust_mast."Cust_Code" =
                                                tbl_booking_mast."Client_code"),
                        tbl_booking_mast."Client_code"
                       ) AS clientname,
                    (SELECT    "Agency_Name"
                            || ' ['
                            || (SELECT "City_Name"
                                  FROM city_mst b
                                 WHERE b."City_Code" = agency_mast."City_Code")
                            || ']'
                       FROM agency_mast
                      WHERE agency_mast."Agency_Code" =
                                                tbl_booking_mast."Agency_code"
                        AND "code_subcode" =
                                            tbl_booking_mast."Agency_sub_code")
                                                               AS client_name,
                    TO_NUMBER
                             (tbl_booking_insert."Insert_Id")
                                                             AS pagination_id,
                    tbl_booking_insert."Edition_Code" AS edition,
                    (SELECT pageheading
                       FROM advpos_prem_mast
                      WHERE "Premiumcode" =
                                     tbl_booking_insert."Premium1")
                                                                   AS splpage,
                    (SELECT "spositionradio"
                       FROM advpos_prem_mast
                      WHERE "Premiumcode" =
                                    tbl_booking_insert."Premium1")
                                                                  AS st_solus,
                    tbl_booking_insert."Comp_Code" AS comp_code,
                    tbl_booking_insert."Userid" AS userid,
                    tbl_booking_insert.lockstatus AS lockstatus,
                    'M' AS edition_flag,
                    (SELECT "pub_center"
                       FROM branch_mst
                      WHERE "Branch_Code" =
                                        tbl_booking_mast."branch")
                                                                  AS bkcenter,
                    (SELECT "Package_Name"
                       FROM combin_mast
                      WHERE "Combin_Code" =
                               tbl_booking_insert.package_code)
                                                               AS packagename,
                    tbl_booking_insert.package_code AS pkgcode,
                    tbl_booking_mast."Rate_code" AS rate_code,
                    tbl_booking_mast."Key_no" AS key_no,
                    (SELECT "Pos_Type"
                       FROM advpos_type_mast
                      WHERE "Pos_Type_Code" =
                                     tbl_booking_mast."Page_prem")
                                                                  AS pos_prem,
                    tbl_booking_insert.dealer_h, tbl_booking_insert.dealer_w,
                    tbl_booking_mast."No_of_insertion" AS no_of_insertion,
                    tbl_booking_insert.bill_no AS bill_no,
                    tbl_booking_insert.bill_date AS bill_date,
                    (SELECT "Branch_Name"
                       FROM branch_mst
                      WHERE "Branch_Code" =
                                      tbl_booking_mast."branch")
                                                                AS branchname,
                    NVL (tbl_booking_mast."audit",
                         tbl_booking_mast.modified_audit
                        ) AS audited
               FROM tbl_layoutx_pref a,
                    tbl_booking_insert,
                    tbl_booking_mast,
                    edition_mast
              WHERE tbl_booking_insert."Cio_Booking_Id" =
                                             tbl_booking_mast."cio_booking_id"
                AND (   (tbl_booking_mast."Ad_type_code" = 'DI0')
                     OR (    a.allow_cd_ads = 'YES'
                         AND a.color_code = tbl_booking_insert."Col_Code"
                         AND a.uom_code = tbl_booking_mast."Uom_code"
                         AND tbl_booking_mast."Ad_type_code" = 'CL0'
                        )
                    )
                AND (   tbl_booking_mast."audit" IS NOT NULL
                     OR tbl_booking_mast.modified_audit = 'Y'
                    )
                AND a."COMP_CODE" = tbl_booking_insert."Comp_Code"
                AND tbl_booking_insert."Edition_Code" =
                                                   edition_mast."Edition_Code"
                AND (edition_mast."Edition_Type" = 'Main Edition')
           GROUP BY tbl_booking_insert."Publication_Code",
                    tbl_booking_insert."Cio_Booking_Id",
                    tbl_booking_insert."No_Insert",
                    tbl_booking_mast."date_time",
                    tbl_booking_insert."Ad_Cat",
                    tbl_booking_insert."Ad_Sub_Cat",
                    tbl_booking_insert."Col_Code",
                    tbl_booking_insert."Supp_Code",
                    tbl_booking_insert."Pub_Cent_Code",
                    tbl_booking_insert."Insert_Date",
                    tbl_booking_insert."Remarks",
                    tbl_booking_insert.CAPTION,
                    tbl_booking_insert."Height",
                    tbl_booking_insert."Width",
                    tbl_booking_insert."Insert_Status",
                    tbl_booking_insert."Pub_Height",
                    tbl_booking_insert."Pub_Width",
                    tbl_booking_insert."File_Name",
                    tbl_booking_insert."Page_No",
                    tbl_booking_mast."Receipt_no",
                    tbl_booking_mast."Client_code",
                    tbl_booking_mast."Agency_code",
                    tbl_booking_mast."Agency_sub_code",
                    tbl_booking_insert."Insert_Id",
                    tbl_booking_insert."Edition_Code",
                    tbl_booking_insert."Premium1",
                    tbl_booking_insert."Comp_Code",
                    tbl_booking_insert."Userid",
                    tbl_booking_insert.lockstatus,
                    tbl_booking_mast."branch",
                    tbl_booking_insert.package_code,
                    tbl_booking_mast."Rate_code",
                    tbl_booking_mast."Key_no",
                    tbl_booking_mast."Page_prem",
                    tbl_booking_insert.dealer_h,
                    tbl_booking_insert.dealer_w,
                    tbl_booking_mast."No_of_insertion",
                    tbl_booking_insert.bill_no,
                    tbl_booking_insert.bill_date,
                    tbl_booking_mast."audit",
                    tbl_booking_mast.modified_audit) x;

--------------------------------


CREATE OR REPLACE package websp_ViewAdBooking is
Type T_Accounts_Cursor is Ref Cursor;
procedure websp_ViewAdBooking_p(
    compcode    in varchar2,
    pubdate     in date,
    pubcode     in varchar2,
    centercode  in varchar2,
    editioncode in varchar2,
    suppcode    in varchar2,
    p_Accounts  out T_Accounts_Cursor);
end websp_ViewAdBooking;
/
CREATE OR REPLACE package body websp_ViewAdBooking is
procedure websp_ViewAdBooking_p(
    compcode    in varchar2,
    pubdate     in date,
    pubcode     in varchar2,
    centercode  in varchar2,
    editioncode in varchar2,
    suppcode    in varchar2,
    p_Accounts  out T_Accounts_Cursor)
as

begin

    open p_Accounts for
    select idnum,colour,sz1,col1,client_name,clientname,
    nvl(fetch_insert_center_printrmrk(ad_ros.comp_code,ad_ros.idnum,centercode,ad_ros.insnum,ad_ros.insdate,editioncode,'C',null),caption) caption,
    nvl(page_no,0) page_no,splpage,
    nvl(fetch_insert_center_printrmrk(ad_ros.comp_code,ad_ros.idnum, centercode,ad_ros.insnum,ad_ros.insdate,editioncode,'R',null),remark1) remark1,
    insnum,file_name,key_no
    from ad_ros where comp_code=compcode and insdate=pubdate and pripub=pubcode and
    bkfor =centercode and edition=editioncode and secpub=suppcode and canmiss not in ('C','W','H')
    order by to_number(page_no );

end websp_ViewAdBooking_p;

end websp_ViewAdBooking;
/


//////////////////////////////(anuj)////////////////////////////////////////////////////////////
