using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;

public partial class Rate_Code_Master : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

        if (Session["userid"] == null)
        {
            Response.Redirect("login.aspx");
        }
        else
        {
            hiddendateformat.Value = Session["dateformat"].ToString();
            dateformat.Value = Session["dateformat"].ToString();
            //hiddendateformat.Value = "mm/dd/yyyy";
            //dateformat.Value = "mm/dd/yyyy";
            hdncompcode.Value = Session["compcode"].ToString();
            hdncompname.Value = Session["comp_name"].ToString();
            hdnuserid.Value = Session["userid"].ToString();
            hdnunitcode.Value = Session["center"].ToString();
            hdncentername.Value = Session["centername"].ToString();
            hiddenauto.Value = Session["autogenerated"].ToString();
            if (hiddendateformat.Value == "mm/dd/yyyy")
            {
                HDN_server_date.Value = DateTime.Today.Month + "/" + DateTime.Today.Day + "/" + DateTime.Today.Year;

            }
            else if (hiddendateformat.Value == "dd/mm/yyyy")
            {
                HDN_server_date.Value = DateTime.Today.Day + "/" + DateTime.Today.Month + "/" + DateTime.Today.Year;
            }
            else
            {
                HDN_server_date.Value = DateTime.Today.Year + "/" + DateTime.Today.Month + "/" + DateTime.Today.Day;
            }


            Ajax.Utility.RegisterTypeForAjax(typeof(Rate_Code_Master));
            //btnNew.Focus();
            //btnNew.Enabled = true;
            //btnSave.Enabled = false;
            //btnQuery.Enabled = true;
            //btnModify.Enabled = false;
            //btnExecute.Enabled = false;
            //btnCancel.Enabled = true;
            //btnfirst.Enabled = false;
            //btnprevious.Enabled = false;
            //btnnext.Enabled = false;
            //btnlast.Enabled = false;
            //btnDelete.Enabled = false;
            //btnExit.Enabled = true;

            DataSet ds1 = new DataSet();
            ds1.ReadXml(Server.MapPath("XML/Button.xml"));
            btnNew.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[0].ToString();
            btnSave.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[1].ToString();
            btnQuery.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[3].ToString();
            btnModify.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[2].ToString();
            btnExecute.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[4].ToString();
            btnCancel.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[5].ToString();
            btnfirst.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[6].ToString();
            btnprevious.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[7].ToString();
            btnnext.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[8].ToString();
            btnlast.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[9].ToString();
            btnDelete.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[10].ToString();
            btnExit.ImageUrl = ds1.Tables[0].Rows[0].ItemArray[11].ToString();

            DataSet ds = new DataSet();
            ds.ReadXml(Server.MapPath("XML/Rate_Code_Master.xml"));


            lblratecode.Text = ds.Tables[0].Rows[0].ItemArray[0].ToString();
            lblratedesc.Text = ds.Tables[0].Rows[0].ItemArray[1].ToString();
            lblremarks.Text = ds.Tables[0].Rows[0].ItemArray[2].ToString();
            lblstatus.Text = ds.Tables[0].Rows[0].ItemArray[3].ToString();

          
            tblfields.Value = ds.Tables[0].Rows[0].ItemArray[4].ToString();
            hiddennochangecode.Value = ds.Tables[0].Rows[0].ItemArray[5].ToString();
            deltblfields.Value = ds.Tables[0].Rows[0].ItemArray[6].ToString();


            btnNew.Attributes.Add("onclick", "javascript:return Newclick();");
            btnSave.Attributes.Add("onclick", "javascript:return duplicacy_fordesc()");
            btnExit.Attributes.Add("onclick", "javascript:return Exit();");
            btnCancel.Attributes.Add("onclick", "javascript:return clear_all();");
            btnQuery.Attributes.Add("onclick", "javascript:return EnabledonQuery()");
            btnExecute.Attributes.Add("onclick", "javascript:return EnableExecute()");
            btnfirst.Attributes.Add("onclick", "javascript:return Find_FirstRecord()");
            btnprevious.Attributes.Add("onclick", "javascript:return Find_PreRecord()");
            btnnext.Attributes.Add("onclick", "javascript:return Find_NextRecord()");
            btnlast.Attributes.Add("onclick", "javascript:return Find_LastRecord()");
            btnDelete.Attributes.Add("onclick", "javascript:return Delete_Record()");
            btnModify.Attributes.Add("onclick", "javascript:return Modify_Records()");



            txtratedesc.Attributes.Add("onchange", "javascript:return autoornot();");


            status_bind(hdncompcode.Value);

        }

    }

    [Ajax.AjaxMethod]
    public DataSet chkratetype(string str)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.Roav_qbc chk = new NewAdbooking.Classes.Roav_qbc();

            ds = chk.rate_ecode(str);
            return ds;
        }
        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.Roav_qbc chk = new NewAdbooking.classesoracle.Roav_qbc();

                ds = chk.rate_ecode(str);
                return ds;
            }
            else
            {
                NewAdbooking.Classes.Roav_qbc chk = new NewAdbooking.Classes.Roav_qbc();

                ds = chk.rate_ecode(str);
                return ds;
            }
           

    }

    [Ajax.AjaxMethod]
    public string Savename(string fields, string finalval, string tablename, string insert, string dateformat, string extra2, string extra3)
    {
        string str = "";
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "sql")
        {
            NewAdbooking.Classes.Roav_qbc obj = new NewAdbooking.Classes.Roav_qbc();
            str = obj.Save_main(fields, finalval, tablename, insert, dateformat, extra2, extra3);
        }
        else
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.Roav_qbc obj = new NewAdbooking.classesoracle.Roav_qbc();
                str = obj.Save_main(fields, finalval, tablename, insert, dateformat, extra2, extra3);
            }
        return str;
    }

    [Ajax.AjaxMethod]
    public String tal_modify(string mod_tablefields, string mod_tablevalue, string mod_tablename, string mod_action, string wherefield, string date, string extra1, string extra2)
    {
        try
        {
            DataSet ds = new DataSet();
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.Roav_qbc obj = new NewAdbooking.classesoracle.Roav_qbc();
                ds = obj.Modify_tal(mod_tablefields, mod_tablevalue, mod_tablename, mod_action, wherefield, date, extra1, extra2);
            }
            else
            {
                NewAdbooking.Classes.Roav_qbc obj = new NewAdbooking.Classes.Roav_qbc();
                ds = obj.Modify_tal(mod_tablefields, mod_tablevalue, mod_tablename, mod_action, wherefield, date, extra1, extra2);
            }
            return "true";
        }

        catch (Exception ex)
        {
            return Convert.ToString(ex.Message);
        }
    }

    [Ajax.AjaxMethod]
    public DataSet clie_execute(string tablename, string ex_ficolname, string ex_finalval, string ex_pre, string date, string extra1, string extra2)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.Roav_qbc obj = new NewAdbooking.classesoracle.Roav_qbc();
            ds = obj.cli_execute(tablename, ex_ficolname, ex_finalval, ex_pre, date, extra1, extra2);
        }
        else
        {
            NewAdbooking.Classes.Roav_qbc obj = new NewAdbooking.Classes.Roav_qbc();
            ds = obj.cli_execute(tablename, ex_ficolname, ex_finalval, ex_pre, date, extra1, extra2);
        }

        return ds;
    }

    [Ajax.AjaxMethod]
    public String tal_delete(string del_tabname, string del_colname, string del_colval, string del_action, string date, string extra1, string extra2)
    {
        try
        {
            string result = "";
            if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
            {
                NewAdbooking.classesoracle.Roav_qbc obj = new NewAdbooking.classesoracle.Roav_qbc();
                result = obj.delete_tal(del_tabname, del_colname, del_colval, del_action, date, extra1, extra2);
            }
            else
            {
                NewAdbooking.Classes.Roav_qbc obj = new NewAdbooking.Classes.Roav_qbc();
                result = obj.delete_tal(del_tabname, del_colname, del_colval, del_action, date, extra1, extra2);

            }
            return result;
        }
        catch (Exception ex)
        {
            return Convert.ToString(ex.Message);
        }
    }

    [Ajax.AjaxMethod]
    public DataSet checkduplicacy(string ptbl_name, string pcol1, string pcol1_val, string pcol2, string pcol2_val, string pcol3, string pcol3_val, string pcol4, string pcol4_val, string pcol5, string pcol5_val, string pcol6, string pcol6_val, string pcol7, string pcol7_val, string pcol8, string pcol8_val, string pcol9, string pcol9_val, string pcol10, string pcol10_val, string date, string extra1, string extra2)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.Roav_qbc duplicacy = new NewAdbooking.classesoracle.Roav_qbc();
            ds = duplicacy.duplicacy_chk_ratecode(ptbl_name, pcol1, pcol1_val, pcol2, pcol2_val, pcol3, pcol3_val, pcol4, pcol4_val, pcol5, pcol5_val, pcol6, pcol6_val, pcol7, pcol7_val, pcol8, pcol8_val, pcol9, pcol9_val, pcol10, pcol10_val, date, extra1, extra2);
        }
        else
        {
            NewAdbooking.Classes.Roav_qbc duplicacy = new NewAdbooking.Classes.Roav_qbc();
            ds = duplicacy.duplicacy_chk_ratecode(ptbl_name, pcol1, pcol1_val, pcol2, pcol2_val, pcol3, pcol3_val, pcol4, pcol4_val, pcol5, pcol5_val, pcol6, pcol6_val, pcol7, pcol7_val, pcol8, pcol8_val, pcol9, pcol9_val, pcol10, pcol10_val, date, extra1, extra2);
        }
        return ds;
    }

    [Ajax.AjaxMethod]
    public DataSet rate_validate(string compcode, string ratecode, string extra1, string extra2)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.Roav_qbc obj = new NewAdbooking.classesoracle.Roav_qbc();
            ds = obj.validate_rate(compcode, ratecode, extra1, extra2);
        }
        else
        {
            NewAdbooking.Classes.Roav_qbc obj = new NewAdbooking.Classes.Roav_qbc();
            ds = obj.validate_rate(compcode, ratecode, extra1, extra2);
        }

        return ds;
    }

    [Ajax.AjaxMethod]
    public void status_bind(string compcode)
    {
        DataSet ds = new DataSet();
        if (ConfigurationSettings.AppSettings["ConnectionType"].ToString() == "orcl")
        {
            NewAdbooking.classesoracle.Roav_qbc obj = new NewAdbooking.classesoracle.Roav_qbc();
            ds = obj.bindstatus(compcode);
        }
        else
        {
            NewAdbooking.Classes.Roav_qbc obj = new NewAdbooking.Classes.Roav_qbc();
            ds = obj.bindstatus(compcode);
        }

       // return ds;

        int i;
        ListItem li1;
        li1 = new ListItem();
        drpstatus.Items.Clear();
        li1.Text = "ACTIVE";
        li1.Value = "AC0";
        li1.Selected = true;
        drpstatus.Items.Add(li1);

        if (ds.Tables.Count > 0)
        {
            for (i = 1; i < ds.Tables[0].Rows.Count; i++)
            {
                ListItem li;
                li = new ListItem();
                li.Value = ds.Tables[0].Rows[i].ItemArray[0].ToString();
                li.Text = ds.Tables[0].Rows[i].ItemArray[1].ToString();
                drpstatus.Items.Add(li);

            }
        }
    }
}
